import{r as u,j as t,u as ue}from"./index-DMLhsmgY.js";import{l as xe}from"./unitStructure-QC5qYuxv.js";import{w as be,c as pe,l as ve,e as he,u as F,f as fe}from"./db-DBTlAsno.js";import{R as Q}from"./RequestTable-BfQ9jnve.js";import{U as ge}from"./units-CaNgy_2U.js";import{a as X,D as ne}from"./DocumentListItem-DeXhs6Nx.js";const ye=({r:e,docsFor:q,expandedDocs:v,setExpandedDocs:y,setOpenDocsId:E,docsRef:k,comments:R,setComments:L,attach:N,setAttach:D,addFilesToRequest:h,selectedCommandSection:w,setSelectedCommandSection:j,commandSections:b,sendToCommandSection:A,commanderDecision:S,expandedLogs:C,setExpandedLogs:g})=>{const[$,I]=u.useState(null),m=w[e.id]&&w[e.id]!=="NONE",x=q(e.id),U=()=>{const l=!!v[e.id];y(f=>({...f,[e.id]:!l})),E(l?null:e.id)};return t.jsxs("div",{id:`details-cmd-${e.id}`,children:[t.jsx("div",{className:"mt-3",children:t.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!v[e.id],"aria-controls":`docs-cmd-${e.id}`,onClick:U,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),U())},children:[t.jsx("span",{children:"Show Documents"}),t.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${v[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:t.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),t.jsx("div",{id:`docs-cmd-${e.id}`,ref:v[e.id]?k:void 0,className:`${v[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:t.jsx(X,{documents:x.map(l=>({...l,fileUrl:l.fileUrl})),showIcons:!0,onPreview:l=>I(x.find(f=>f.id===l.id)||null)})}),t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),t.jsx("textarea",{rows:2,value:R[e.id]||"",onChange:l=>L(f=>({...f,[e.id]:l.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[t.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[t.jsx("input",{type:"file",multiple:!0,onChange:l=>D(f=>({...f,[e.id]:l.target.files?Array.from(l.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),t.jsx("span",{className:"text-xs text-[var(--muted)]",children:(N[e.id]||[]).length?`${(N[e.id]||[]).length} file(s) selected`:"No files selected"}),t.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>h(e),disabled:!N[e.id]||!(N[e.id]||[]).length,children:"Save Files"})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),t.jsxs("select",{value:w[e.id]||"NONE",onChange:l=>j(f=>({...f,[e.id]:l.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[t.jsx("option",{value:"NONE",children:"None - Make final decision below"}),b.map(l=>t.jsx("option",{value:l,children:l},l))]}),m?t.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',w[e.id],'" to route for their review']}):t.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),m&&t.jsx("div",{className:"mt-3 flex items-center justify-end",children:t.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>A(e),children:["Send to ",w[e.id]]})}),t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Approved"),children:"Approved"}),t.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Endorsed"),children:"Endorsed"}),t.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Rejected"),children:"Rejected"})]})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>g(l=>({...l,[e.id]:!l[e.id]})),"aria-expanded":!!C[e.id],"aria-controls":`logs-cmd-${e.id}`,children:[C[e.id]?"Hide":"Show"," Activity Log"]}),t.jsx("div",{id:`logs-cmd-${e.id}`,className:C[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((l,f)=>t.jsxs("div",{className:"text-xs text-gray-700",children:[t.jsxs("div",{className:"font-medium",children:[l.actor," • ",new Date(l.timestamp).toLocaleString()," • ",l.action]}),l.comment&&t.jsx("div",{className:"text-gray-600",children:l.comment})]},f)):t.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),$&&t.jsx(ne,{fileName:$.name,url:$.fileUrl||"",mimeType:$.type||"",fileSize:$.size||0,isOpen:!!$,onClose:()=>I(null)})]})},je=({r:e,docsFor:q,comments:v,setComments:y,attach:E,setAttach:k,addFilesToRequest:R,approveToCommander:L,commandSectionReturn:N,commandSections:D,selectedCommandSection:h,setSelectedCommandSection:w,routeToCommandSection:j})=>{const[b,A]=u.useState(!1),[S,C]=u.useState(!1),[g,$]=u.useState(null),I=q(e.id);return t.jsxs("div",{id:`details-csec-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[t.jsxs("div",{children:[t.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":b,"aria-controls":`docs-csec-${e.id}`,onClick:()=>A(!b),children:[t.jsxs("span",{children:[b?"Hide":"Show"," Documents (",I.length,")"]}),t.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${b?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:t.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),t.jsx("div",{id:`docs-csec-${e.id}`,className:`${b?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:t.jsx(X,{documents:I.map(m=>({...m,fileUrl:m.fileUrl})),showIcons:!0,onPreview:m=>$(I.find(x=>x.id===m.id)||null)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),t.jsx("textarea",{rows:2,value:v[e.id]||"",onChange:m=>y(x=>({...x,[e.id]:m.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 text-sm rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[t.jsx("input",{type:"file",multiple:!0,onChange:m=>k(x=>({...x,[e.id]:m.target.files?Array.from(m.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),t.jsx("span",{className:"text-xs text-[var(--muted)]",children:(E[e.id]||[]).length?`${(E[e.id]||[]).length} file(s) selected`:"No files selected"}),(E[e.id]||[]).length>0&&t.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>R(e),children:"Save Files"})]}),t.jsxs("div",{children:[t.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>C(!S),"aria-expanded":S,"aria-controls":`logs-csec-${e.id}`,children:[S?"Hide":"Show"," Activity Log"]}),t.jsx("div",{id:`logs-csec-${e.id}`,className:S?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((m,x)=>t.jsxs("div",{className:"text-xs text-gray-700",children:[t.jsxs("div",{className:"font-medium",children:[m.actor," • ",new Date(m.timestamp).toLocaleString()," • ",m.action]}),m.comment&&t.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:m.comment})]},x)):t.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),D.length>1&&t.jsxs("div",{className:"pt-2 border-t border-brand-navy/10",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Route to Another Section"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsxs("select",{value:h[e.id]||"",onChange:m=>w(x=>({...x,[e.id]:m.target.value})),className:"flex-1 px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold text-sm",children:[t.jsx("option",{value:"",children:"Select section..."}),D.filter(m=>m!==e.routeSection).map(m=>t.jsx("option",{value:m,children:m},m))]}),t.jsx("button",{className:"px-4 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>j(e,h[e.id]||""),disabled:!h[e.id],children:"Route"})]})]}),t.jsxs("div",{className:"pt-2 border-t border-brand-navy/10 flex items-center justify-end gap-2",children:[t.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>L(e),children:"Approve to Commander"}),t.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>N(e),children:"Return to Battalion"})]}),g&&t.jsx(ne,{fileName:g.name,url:g.fileUrl||"",mimeType:g.type||"",fileSize:g.size||0,isOpen:!!g,onClose:()=>$(null)})]})};function ke(){const[e,q]=u.useState(null),[v,y]=u.useState([]),[E,k]=u.useState([]),[R,L]=u.useState({}),[N,D]=u.useState({}),[h,w]=u.useState([]),[j,b]=u.useState({}),[A,S]=u.useState({}),[C,g]=u.useState({}),[$,I]=u.useState({}),[m,x]=u.useState(null),U=u.useRef(null),[l,f]=u.useState({}),[B,T]=u.useState({}),[Se,Y]=u.useState(null),O=ue();u.useEffect(()=>{const n=a=>{m&&U.current&&!U.current.contains(a.target)&&(g(o=>({...o,[m]:!1})),x(null))},i=a=>{a.key==="Escape"&&m&&(g(o=>({...o,[m]:!1})),x(null))};return document.addEventListener("mousedown",n),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("keydown",i)}},[m]);const[P,z]=u.useState({});u.useEffect(()=>{try{const n=localStorage.getItem("currentUser");if(n){const i=JSON.parse(n);q(i)}}catch{}},[]),u.useEffect(()=>{e!=null&&e.installationId&&be().then(n=>{const i=n.find(a=>a.id===e.installationId);Y(i||null)}).catch(()=>Y(null))},[e]),u.useEffect(()=>{pe().then(n=>{y(n)}).catch(()=>y([]))},[]),u.useEffect(()=>{ve().then(n=>{k(n)}).catch(()=>k([]))},[]),u.useEffect(()=>{he().then(n=>{const i={};for(const a of n)a!=null&&a.id&&(i[a.id]=a);L(i)}).catch(()=>L({}))},[]);const _=()=>{if(e!=null&&e.unitUic)return e.unitUic;if(e!=null&&e.unit){const n=ge.find(i=>i.unitName===e.unit);if(n)return n.uic}return""};u.useEffect(()=>{try{const n=localStorage.getItem("unit_structure"),i=_();if(!i)return;const a=[],o={};if(n){const s=JSON.parse(n),c=s==null?void 0:s[i];c&&Array.isArray(c._commandSections)&&a.push(...c._commandSections);for(const r of Object.keys(s||{})){const d=s[r];d&&d._platoonSectionMap&&typeof d._platoonSectionMap=="object"&&(o[r]=d._platoonSectionMap)}w(a),f(o)}else(async()=>{try{const s=await xe(),c=[],r={},d=s==null?void 0:s[i];d&&Array.isArray(d._commandSections)&&c.push(...d._commandSections);for(const p of Object.keys(s||{})){const M=s[p];M&&M._platoonSectionMap&&typeof M._platoonSectionMap=="object"&&(r[p]=M._platoonSectionMap)}w(c),f(r)}catch{}})()}catch{}},[e]);const V=n=>E.filter(i=>i.requestId===n),Z=n=>R[n.uploadedById]||null,ee=n=>{var c,r;if(n.routeSection)return n.routeSection;const i=n.unitUic||"",a=Z(n),o=a!=null&&a.company&&a.company!=="N/A"?a.company:"",s=a!=null&&a.unit&&a.unit!=="N/A"?a.unit:"";return((r=(c=l[i])==null?void 0:c[o])==null?void 0:r[s])||""},H=u.useMemo(()=>{const n=_();return v.filter(i=>{const a=i.currentStage||"",o=i.unitUic||"";return a==="COMMANDER_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(n?o===n:!0)})},[v,e,_]);u.useMemo(()=>{const n=(e==null?void 0:e.installationId)||"";return v.filter(i=>(i.currentStage||"")==="INSTALLATION_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(n?i.installationId===n:!0))},[v,e]);const W=u.useMemo(()=>{const n=_(),i={},a=s=>String(s||"").trim().toUpperCase(),o=h.map(s=>a(s));for(const s of h)i[s]=[];for(const s of v){const c=s.currentStage||"",r=s.unitUic||"",d=s.routeSection||"",p=a(d);if(c==="COMMANDER_REVIEW"&&d&&(!n||r===n)){const M=o.indexOf(p),G=M>=0?h[M]:d;i[G]||(i[G]=[]),i[G].push(s)}}return i},[v,h,e,_]),oe=n=>`"${String(n??"").replace(/"/g,'""')}"`,K=n=>{const a=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const o of n){const s=Z(o),c=s?`${s.rank} ${s.lastName}, ${s.firstName}${s.mi?` ${s.mi}`:""}`:"",r=V(o.id).map(d=>d.name).join(" | ");a.push([o.id,o.subject,o.currentStage||"",o.routeSection||"",c,o.unitUic||"",new Date(o.createdAt).toLocaleString(),r])}return a.map(o=>o.map(oe).join(",")).join(`\r
`)},J=(n,i)=>{const a=new Blob([i],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),s=document.createElement("a");s.href=o,s.download=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)},se=()=>J("commander.csv",K(H)),ie=n=>J(`${n}.csv`,K(W[n]||[])),ae=()=>J("command_all.csv",K([...H,...h.flatMap(n=>W[n]||[])])),de=async n=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",a=n.routeSection||"",o={actor:i,timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(j[n.id]||"").trim(),fromSection:a||void 0,toSection:"Commander"},s={...n,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:[...n.activity||[],o]};try{await F(s),y(c=>c.map(r=>r.id===s.id?s:r)),b(c=>({...c,[n.id]:""}))}catch(c){console.error("Failed to approve request to commander:",c),O.error("Failed to approve request to commander")}},ce=async n=>{const i=B[n.id]||"";if(!i||i==="NONE")return;const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=`Sent to ${i} for review by Commander`,s={...n,currentStage:"COMMANDER_REVIEW",routeSection:i,activity:[...n.activity||[],{actor:a,timestamp:new Date().toISOString(),action:o,comment:(j[n.id]||"").trim(),fromSection:"Commander",toSection:i}]};try{await F(s),y(c=>c.map(r=>r.id===s.id?s:r)),b(c=>({...c,[n.id]:""})),T(c=>({...c,[n.id]:""}))}catch(c){console.error("Failed to send to command section:",c),O.error("Failed to send to command section")}},re=async(n,i)=>{const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=ee(n),s=i==="Approved"?"Approved by Commander":i==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",c={...n,currentStage:"BATTALION_REVIEW",routeSection:o||n.routeSection||"",commanderApprovalDate:i==="Approved"?new Date().toISOString():n.commanderApprovalDate,activity:[...n.activity||[],{actor:a,timestamp:new Date().toISOString(),action:s,comment:(j[n.id]||"").trim(),fromSection:"Commander",toSection:o||n.routeSection||void 0}]};try{await F(c),y(r=>r.map(d=>d.id===c.id?c:d)),b(r=>({...r,[n.id]:""})),T(r=>({...r,[n.id]:""}))}catch(r){console.error("Failed to make commander decision:",r),O.error("Failed to record commander decision")}},le=async n=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",a=ee(n),o=n.routeSection||"",s=`Returned to ${a||"Battalion"} by ${o||"Command Section"}`,c={actor:i,timestamp:new Date().toISOString(),action:s,comment:(j[n.id]||"").trim(),fromSection:o||void 0,toSection:a||void 0},r={...n,currentStage:"BATTALION_REVIEW",routeSection:a||n.routeSection||"",activity:[...n.activity||[],c]};try{await F(r),y(d=>d.map(p=>p.id===r.id?r:p)),b(d=>({...d,[n.id]:""}))}catch(d){console.error("Failed to return from command section:",d),O.error("Failed to return from command section")}},me=async(n,i)=>{if(!i)return;const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",o=n.routeSection||"",s=`Routed to ${i} by ${o||"Command Section"}`,c={actor:a,timestamp:new Date().toISOString(),action:s,comment:(j[n.id]||"").trim(),fromSection:o||void 0,toSection:i},r={...n,currentStage:"COMMANDER_REVIEW",routeSection:i,activity:[...n.activity||[],c]};try{await F(r),y(d=>d.map(p=>p.id===r.id?r:p)),b(d=>({...d,[n.id]:""})),T(d=>({...d,[n.id]:""})),O.success(`Routed to ${i}`)}catch(d){console.error("Failed to route to command section:",d),O.error("Failed to route to command section")}},te=async n=>{const i=A[n.id]||[];if(!i.length||!(e!=null&&e.id))return;const a=Date.now(),o=i.map((d,p)=>({id:`${a}-${p}`,name:d.name,type:d.type,size:d.size,uploadedAt:new Date().toISOString(),subject:n.subject,requestId:n.id,fileUrl:URL.createObjectURL(d)})),c={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${o.length} document(s)`,comment:(j[n.id]||"").trim()},r={...n,documentIds:[...n.documentIds||[],...o.map(d=>d.id)],activity:[...n.activity||[],c]};try{await fe(o),await F(r),k(d=>[...d,...o]),y(d=>d.map(p=>p.id===r.id?r:p)),S(d=>({...d,[n.id]:[]})),b(d=>({...d,[n.id]:""}))}catch(d){console.error("Failed to add files to request:",d),O.error("Failed to add files to request")}};return t.jsx("div",{className:"max-w-7xl mx-auto p-6",children:t.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Unit Command Dashboard"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(e==null?void 0:e.unitUic)||""}),t.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ae,children:"Export All"})]})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),t.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:se,children:"Export Commander"})]}),t.jsx("div",{className:"mt-4",children:t.jsx(Q,{title:"Pending",requests:H.filter(n=>n.currentStage!=="ARCHIVED"),users:R,onRowClick:n=>z(i=>({...i,[n.id]:!i[n.id]})),expandedRows:P,platoonSectionMap:l,children:n=>t.jsx(ye,{r:n,docsFor:V,expandedDocs:C,setExpandedDocs:g,setOpenDocsId:x,docsRef:U,comments:j,setComments:b,attach:A,setAttach:S,addFilesToRequest:te,selectedCommandSection:B,setSelectedCommandSection:T,commandSections:h,sendToCommandSection:ce,commanderDecision:re,expandedLogs:N,setExpandedLogs:D})})})]}),h.map(n=>{const i=(W[n]||[]).filter(o=>o.currentStage!=="ARCHIVED"),a=(W[n]||[]).filter(o=>o.currentStage==="ARCHIVED");return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:n}),t.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>ie(n),children:["Export ",n]})]}),t.jsx("div",{className:"mt-4",children:t.jsx(Q,{title:"Pending",requests:i,users:R,onRowClick:o=>z(s=>({...s,[o.id]:!s[o.id]})),expandedRows:P,platoonSectionMap:l,children:o=>t.jsx(je,{r:o,docsFor:V,comments:j,setComments:b,attach:A,setAttach:S,addFilesToRequest:te,approveToCommander:de,commandSectionReturn:le,commandSections:h,selectedCommandSection:B,setSelectedCommandSection:T,routeToCommandSection:me})})}),a.length>0&&t.jsx("div",{className:"mt-4",children:t.jsx(Q,{title:"Archived",requests:a,users:R,onRowClick:o=>z(s=>({...s,[o.id]:!s[o.id]})),expandedRows:P,platoonSectionMap:l,children:o=>t.jsxs("div",{id:`details-csec-archived-${o.id}`,className:"p-4 bg-gray-50 space-y-3",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",o.finalStatus||"Archived"]}),t.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),t.jsxs("div",{children:[t.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!C[o.id],"aria-controls":`docs-csec-archived-${o.id}`,onClick:()=>{g(s=>({...s,[o.id]:!s[o.id]})),x(s=>C[o.id]?null:o.id)},children:"Show Documents"}),t.jsx("div",{id:`docs-csec-archived-${o.id}`,className:`${C[o.id]?"mt-2 space-y-2":"hidden"}`,children:t.jsx(X,{documents:V(o.id).map(s=>({...s,fileUrl:s.fileUrl}))})})]}),t.jsxs("div",{children:[t.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!N[o.id],"aria-controls":`logs-csec-archived-${o.id}`,onClick:()=>D(s=>({...s,[o.id]:!s[o.id]})),children:[N[o.id]?"Hide":"Show"," Full Activity Log"]}),t.jsx("div",{id:`logs-csec-archived-${o.id}`,className:N[o.id]?"mt-2 space-y-2":"hidden",children:o.activity&&o.activity.length?o.activity.map((s,c)=>t.jsxs("div",{className:"text-xs text-gray-700",children:[t.jsxs("div",{className:"font-medium",children:[s.actor," • ",new Date(s.timestamp).toLocaleString()," • ",s.action]}),s.comment&&t.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:s.comment})]},c)):t.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},n)})]})]})})}export{ke as default};
