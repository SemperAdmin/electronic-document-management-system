import{r as m,j as n,u as me}from"./index-oN6CZrtC.js";import{l as ue}from"./unitStructure-QC5qYuxv.js";import{w as xe,c as be,l as pe,e as ve,u as T,f as he}from"./db-KOj-SjFQ.js";import{R as G}from"./RequestTable-BgfMO7od.js";import{U as fe}from"./units-CaNgy_2U.js";import{a as Q,D as ne}from"./DocumentListItem-CgAJsPH3.js";const ge=({r:e,docsFor:U,expandedDocs:b,setExpandedDocs:g,setOpenDocsId:k,docsRef:R,comments:C,setComments:O,attach:y,setAttach:N,addFilesToRequest:w,selectedCommandSection:h,setSelectedCommandSection:j,commandSections:x,sendToCommandSection:$,commanderDecision:S,expandedLogs:u,setExpandedLogs:p})=>{const[D,V]=m.useState(null),E=h[e.id]&&h[e.id]!=="NONE",A=U(e.id),L=()=>{const r=!!b[e.id];g(v=>({...v,[e.id]:!r})),k(r?null:e.id)};return n.jsxs("div",{id:`details-cmd-${e.id}`,children:[n.jsx("div",{className:"mt-3",children:n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!b[e.id],"aria-controls":`docs-cmd-${e.id}`,onClick:L,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),L())},children:[n.jsx("span",{children:"Show Documents"}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${b[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),n.jsx("div",{id:`docs-cmd-${e.id}`,ref:b[e.id]?R:void 0,className:`${b[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Q,{documents:A.map(r=>({...r,fileUrl:r.fileUrl})),showIcons:!0,onPreview:r=>V(A.find(v=>v.id===r.id)||null)})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:C[e.id]||"",onChange:r=>O(v=>({...v,[e.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:r=>N(v=>({...v,[e.id]:r.target.files?Array.from(r.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(y[e.id]||[]).length?`${(y[e.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>w(e),disabled:!y[e.id]||!(y[e.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),n.jsxs("select",{value:h[e.id]||"NONE",onChange:r=>j(v=>({...v,[e.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[n.jsx("option",{value:"NONE",children:"None - Make final decision below"}),x.map(r=>n.jsx("option",{value:r,children:r},r))]}),E?n.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',h[e.id],'" to route for their review']}):n.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),E&&n.jsx("div",{className:"mt-3 flex items-center justify-end",children:n.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>$(e),children:["Send to ",h[e.id]]})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Rejected"),children:"Rejected"})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>p(r=>({...r,[e.id]:!r[e.id]})),"aria-expanded":!!u[e.id],"aria-controls":`logs-cmd-${e.id}`,children:[u[e.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-cmd-${e.id}`,className:u[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((r,v)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[r.actor," • ",new Date(r.timestamp).toLocaleString()," • ",r.action]}),r.comment&&n.jsx("div",{className:"text-gray-600",children:r.comment})]},v)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),D&&n.jsx(ne,{fileName:D.name,url:D.fileUrl||"",mimeType:D.type||"",fileSize:D.size||0,isOpen:!!D,onClose:()=>V(null)})]})},ye=({r:e,docsFor:U,comments:b,setComments:g,attach:k,setAttach:R,addFilesToRequest:C,approveToCommander:O,commandSectionReturn:y})=>{const[N,w]=m.useState(!1),[h,j]=m.useState(!1),[x,$]=m.useState(null),S=U(e.id);return n.jsxs("div",{id:`details-csec-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":N,"aria-controls":`docs-csec-${e.id}`,onClick:()=>w(!N),children:[n.jsxs("span",{children:[N?"Hide":"Show"," Documents (",S.length,")"]}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${N?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),n.jsx("div",{id:`docs-csec-${e.id}`,className:`${N?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Q,{documents:S.map(u=>({...u,fileUrl:u.fileUrl})),showIcons:!0,onPreview:u=>$(S.find(p=>p.id===u.id)||null)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:b[e.id]||"",onChange:u=>g(p=>({...p,[e.id]:u.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 text-sm rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:u=>R(p=>({...p,[e.id]:u.target.files?Array.from(u.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(k[e.id]||[]).length?`${(k[e.id]||[]).length} file(s) selected`:"No files selected"}),(k[e.id]||[]).length>0&&n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>C(e),children:"Save Files"})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>j(!h),"aria-expanded":h,"aria-controls":`logs-csec-${e.id}`,children:[h?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-csec-${e.id}`,className:h?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((u,p)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[u.actor," • ",new Date(u.timestamp).toLocaleString()," • ",u.action]}),u.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:u.comment})]},p)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"pt-2 border-t border-brand-navy/10 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>O(e),children:"Approve to Commander"}),n.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>y(e),children:"Return to Battalion"})]}),x&&n.jsx(ne,{fileName:x.name,url:x.fileUrl||"",mimeType:x.type||"",fileSize:x.size||0,isOpen:!!x,onClose:()=>$(null)})]})};function ke(){const[e,U]=m.useState(null),[b,g]=m.useState([]),[k,R]=m.useState([]),[C,O]=m.useState({}),[y,N]=m.useState({}),[w,h]=m.useState([]),[j,x]=m.useState({}),[$,S]=m.useState({}),[u,p]=m.useState({}),[D,V]=m.useState({}),[E,A]=m.useState(null),L=m.useRef(null),[r,v]=m.useState({}),[X,B]=m.useState({}),[je,Y]=m.useState(null),q=me();m.useEffect(()=>{const t=a=>{E&&L.current&&!L.current.contains(a.target)&&(p(o=>({...o,[E]:!1})),A(null))},i=a=>{a.key==="Escape"&&E&&(p(o=>({...o,[E]:!1})),A(null))};return document.addEventListener("mousedown",t),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",i)}},[E]);const[P,W]=m.useState({});m.useEffect(()=>{try{const t=localStorage.getItem("currentUser");if(t){const i=JSON.parse(t);U(i)}}catch{}},[]),m.useEffect(()=>{e!=null&&e.installationId&&xe().then(t=>{const i=t.find(a=>a.id===e.installationId);Y(i||null)}).catch(()=>Y(null))},[e]),m.useEffect(()=>{be().then(t=>{g(t)}).catch(()=>g([]))},[]),m.useEffect(()=>{pe().then(t=>{R(t)}).catch(()=>R([]))},[]),m.useEffect(()=>{ve().then(t=>{const i={};for(const a of t)a!=null&&a.id&&(i[a.id]=a);O(i)}).catch(()=>O({}))},[]);const F=()=>{if(e!=null&&e.unitUic)return e.unitUic;if(e!=null&&e.unit){const t=fe.find(i=>i.unitName===e.unit);if(t)return t.uic}return""};m.useEffect(()=>{try{const t=localStorage.getItem("unit_structure"),i=F();if(!i)return;const a=[],o={};if(t){const s=JSON.parse(t),c=s==null?void 0:s[i];c&&Array.isArray(c._commandSections)&&a.push(...c._commandSections);for(const l of Object.keys(s||{})){const d=s[l];d&&d._platoonSectionMap&&typeof d._platoonSectionMap=="object"&&(o[l]=d._platoonSectionMap)}h(a),v(o)}else(async()=>{try{const s=await ue(),c=[],l={},d=s==null?void 0:s[i];d&&Array.isArray(d._commandSections)&&c.push(...d._commandSections);for(const f of Object.keys(s||{})){const I=s[f];I&&I._platoonSectionMap&&typeof I._platoonSectionMap=="object"&&(l[f]=I._platoonSectionMap)}h(c),v(l)}catch{}})()}catch{}},[e]);const _=t=>k.filter(i=>i.requestId===t),Z=t=>C[t.uploadedById]||null,ee=t=>{var c,l;if(t.routeSection)return t.routeSection;const i=t.unitUic||"",a=Z(t),o=a!=null&&a.company&&a.company!=="N/A"?a.company:"",s=a!=null&&a.unit&&a.unit!=="N/A"?a.unit:"";return((l=(c=r[i])==null?void 0:c[o])==null?void 0:l[s])||""},z=m.useMemo(()=>{const t=F();return b.filter(i=>{const a=i.currentStage||"",o=i.unitUic||"";return a==="COMMANDER_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(t?o===t:!0)})},[b,e,F]);m.useMemo(()=>{const t=(e==null?void 0:e.installationId)||"";return b.filter(i=>(i.currentStage||"")==="INSTALLATION_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(t?i.installationId===t:!0))},[b,e]);const M=m.useMemo(()=>{const t=F(),i={},a=s=>String(s||"").trim().toUpperCase(),o=w.map(s=>a(s));for(const s of w)i[s]=[];for(const s of b){const c=s.currentStage||"",l=s.unitUic||"",d=s.routeSection||"",f=a(d);if(c==="COMMANDER_REVIEW"&&d&&(!t||l===t)){const I=o.indexOf(f),J=I>=0?w[I]:d;i[J]||(i[J]=[]),i[J].push(s)}}return i},[b,w,e,F]),oe=t=>`"${String(t??"").replace(/"/g,'""')}"`,H=t=>{const a=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const o of t){const s=Z(o),c=s?`${s.rank} ${s.lastName}, ${s.firstName}${s.mi?` ${s.mi}`:""}`:"",l=_(o.id).map(d=>d.name).join(" | ");a.push([o.id,o.subject,o.currentStage||"",o.routeSection||"",c,o.unitUic||"",new Date(o.createdAt).toLocaleString(),l])}return a.map(o=>o.map(oe).join(",")).join(`\r
`)},K=(t,i)=>{const a=new Blob([i],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)},se=()=>K("commander.csv",H(z)),ie=t=>K(`${t}.csv`,H(M[t]||[])),ae=()=>K("command_all.csv",H([...z,...w.flatMap(t=>M[t]||[])])),de=async t=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",a=t.routeSection||"",o={actor:i,timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(j[t.id]||"").trim(),fromSection:a||void 0,toSection:"Commander"},s={...t,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:[...t.activity||[],o]};try{await T(s),g(c=>c.map(l=>l.id===s.id?s:l)),x(c=>({...c,[t.id]:""}))}catch(c){console.error("Failed to approve request to commander:",c),q.error("Failed to approve request to commander")}},ce=async t=>{const i=X[t.id]||"";if(!i||i==="NONE")return;const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=`Sent to ${i} for review by Commander`,s={...t,currentStage:"COMMANDER_REVIEW",routeSection:i,activity:[...t.activity||[],{actor:a,timestamp:new Date().toISOString(),action:o,comment:(j[t.id]||"").trim(),fromSection:"Commander",toSection:i}]};try{await T(s),g(c=>c.map(l=>l.id===s.id?s:l)),x(c=>({...c,[t.id]:""})),B(c=>({...c,[t.id]:""}))}catch(c){console.error("Failed to send to command section:",c),q.error("Failed to send to command section")}},re=async(t,i)=>{const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=ee(t),s=i==="Approved"?"Approved by Commander":i==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",c={...t,currentStage:"BATTALION_REVIEW",routeSection:o||t.routeSection||"",commanderApprovalDate:i==="Approved"?new Date().toISOString():t.commanderApprovalDate,activity:[...t.activity||[],{actor:a,timestamp:new Date().toISOString(),action:s,comment:(j[t.id]||"").trim(),fromSection:"Commander",toSection:o||t.routeSection||void 0}]};try{await T(c),g(l=>l.map(d=>d.id===c.id?c:d)),x(l=>({...l,[t.id]:""})),B(l=>({...l,[t.id]:""}))}catch(l){console.error("Failed to make commander decision:",l),q.error("Failed to record commander decision")}},le=async t=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",a=ee(t),o=t.routeSection||"",s=`Returned to ${a||"Battalion"} by ${o||"Command Section"}`,c={actor:i,timestamp:new Date().toISOString(),action:s,comment:(j[t.id]||"").trim(),fromSection:o||void 0,toSection:a||void 0},l={...t,currentStage:"BATTALION_REVIEW",routeSection:a||t.routeSection||"",activity:[...t.activity||[],c]};try{await T(l),g(d=>d.map(f=>f.id===l.id?l:f)),x(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to return from command section:",d),q.error("Failed to return from command section")}},te=async t=>{const i=$[t.id]||[];if(!i.length||!(e!=null&&e.id))return;const a=Date.now(),o=i.map((d,f)=>({id:`${a}-${f}`,name:d.name,type:d.type,size:d.size,uploadedAt:new Date().toISOString(),subject:t.subject,requestId:t.id,fileUrl:URL.createObjectURL(d)})),c={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${o.length} document(s)`,comment:(j[t.id]||"").trim()},l={...t,documentIds:[...t.documentIds||[],...o.map(d=>d.id)],activity:[...t.activity||[],c]};try{await he(o),await T(l),R(d=>[...d,...o]),g(d=>d.map(f=>f.id===l.id?l:f)),S(d=>({...d,[t.id]:[]})),x(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to add files to request:",d),q.error("Failed to add files to request")}};return n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Command Sections Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(e==null?void 0:e.unitUic)||""}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ae,children:"Export All"})]})]}),n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:se,children:"Export Commander"})]}),n.jsx("div",{className:"mt-4",children:n.jsx(G,{title:"Pending",requests:z.filter(t=>t.currentStage!=="ARCHIVED"),users:C,onRowClick:t=>W(i=>({...i,[t.id]:!i[t.id]})),expandedRows:P,platoonSectionMap:r,children:t=>n.jsx(ge,{r:t,docsFor:_,expandedDocs:u,setExpandedDocs:p,setOpenDocsId:A,docsRef:L,comments:j,setComments:x,attach:$,setAttach:S,addFilesToRequest:te,selectedCommandSection:X,setSelectedCommandSection:B,commandSections:w,sendToCommandSection:ce,commanderDecision:re,expandedLogs:y,setExpandedLogs:N})})})]}),Object.keys(M).filter(t=>(M[t]||[]).length>0).map(t=>{const i=(M[t]||[]).filter(o=>o.currentStage!=="ARCHIVED"),a=(M[t]||[]).filter(o=>o.currentStage==="ARCHIVED");return n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:t}),n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>ie(t),children:["Export ",t]})]}),i.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(G,{title:"Pending",requests:i,users:C,onRowClick:o=>W(s=>({...s,[o.id]:!s[o.id]})),expandedRows:P,platoonSectionMap:r,children:o=>n.jsx(ye,{r:o,docsFor:_,comments:j,setComments:x,attach:$,setAttach:S,addFilesToRequest:te,approveToCommander:de,commandSectionReturn:le})})}),a.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(G,{title:"Archived",requests:a,users:C,onRowClick:o=>W(s=>({...s,[o.id]:!s[o.id]})),expandedRows:P,platoonSectionMap:r,children:o=>n.jsxs("div",{id:`details-csec-archived-${o.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",o.finalStatus||"Archived"]}),n.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),n.jsxs("div",{children:[n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!u[o.id],"aria-controls":`docs-csec-archived-${o.id}`,onClick:()=>{p(s=>({...s,[o.id]:!s[o.id]})),A(s=>u[o.id]?null:o.id)},children:"Show Documents"}),n.jsx("div",{id:`docs-csec-archived-${o.id}`,className:`${u[o.id]?"mt-2 space-y-2":"hidden"}`,children:n.jsx(Q,{documents:_(o.id).map(s=>({...s,fileUrl:s.fileUrl}))})})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!y[o.id],"aria-controls":`logs-csec-archived-${o.id}`,onClick:()=>N(s=>({...s,[o.id]:!s[o.id]})),children:[y[o.id]?"Hide":"Show"," Full Activity Log"]}),n.jsx("div",{id:`logs-csec-archived-${o.id}`,className:y[o.id]?"mt-2 space-y-2":"hidden",children:o.activity&&o.activity.length?o.activity.map((s,c)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[s.actor," • ",new Date(s.timestamp).toLocaleString()," • ",s.action]}),s.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:s.comment})]},c)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},t)})]})]})})}export{ke as default};
