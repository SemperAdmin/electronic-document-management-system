import{r as u,j as n,u as pe}from"./index-l_G8gL6a.js";import{l as ve}from"./unitStructure-QC5qYuxv.js";import{x as he,c as fe,l as ge,e as ye,u as q,f as Se}from"./db-BtncR-UB.js";import{R as X}from"./RequestTable-1bVWKNCH.js";import{U as je}from"./units-CaNgy_2U.js";import{a as Y,D as se}from"./DocumentListItem-CqPEtXbE.js";const Ne=({r:e,docsFor:T,expandedDocs:h,setExpandedDocs:y,setOpenDocsId:k,docsRef:D,comments:E,setComments:L,attach:N,setAttach:A,addFilesToRequest:v,selectedCommandSection:w,setSelectedCommandSection:S,commandSections:p,sendToCommandSection:I,commanderDecision:j,expandedLogs:$,setExpandedLogs:g})=>{const[R,O]=u.useState(null),m=w[e.id]&&w[e.id]!=="NONE",b=T(e.id),F=()=>{const l=!!h[e.id];y(f=>({...f,[e.id]:!l})),k(l?null:e.id)};return n.jsxs("div",{id:`details-cmd-${e.id}`,children:[n.jsx("div",{className:"mt-3",children:n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!h[e.id],"aria-controls":`docs-cmd-${e.id}`,onClick:F,onKeyDown:l=>{(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),F())},children:[n.jsx("span",{children:"Show Documents"}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${h[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),n.jsx("div",{id:`docs-cmd-${e.id}`,ref:h[e.id]?D:void 0,className:`${h[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Y,{documents:b.map(l=>({...l,fileUrl:l.fileUrl})),showIcons:!0,onPreview:l=>O(b.find(f=>f.id===l.id)||null)})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:E[e.id]||"",onChange:l=>L(f=>({...f,[e.id]:l.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:l=>A(f=>({...f,[e.id]:l.target.files?Array.from(l.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(N[e.id]||[]).length?`${(N[e.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>v(e),disabled:!N[e.id]||!(N[e.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),n.jsxs("select",{value:w[e.id]||"NONE",onChange:l=>S(f=>({...f,[e.id]:l.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[n.jsx("option",{value:"NONE",children:"None - Make final decision below"}),p.map(l=>n.jsx("option",{value:l,children:l},l))]}),m?n.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',w[e.id],'" to route for their review']}):n.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),m&&n.jsx("div",{className:"mt-3 flex items-center justify-end",children:n.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>I(e),children:["Send to ",w[e.id]]})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>j(e,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>j(e,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>j(e,"Rejected"),children:"Rejected"})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>g(l=>({...l,[e.id]:!l[e.id]})),"aria-expanded":!!$[e.id],"aria-controls":`logs-cmd-${e.id}`,children:[$[e.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-cmd-${e.id}`,className:$[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((l,f)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[l.actor," • ",new Date(l.timestamp).toLocaleString()," • ",l.action]}),l.comment&&n.jsx("div",{className:"text-gray-600",children:l.comment})]},f)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),R&&n.jsx(se,{fileName:R.name,url:R.fileUrl||"",mimeType:R.type||"",fileSize:R.size||0,isOpen:!!R,onClose:()=>O(null)})]})},Ce=({r:e,docsFor:T,comments:h,setComments:y,attach:k,setAttach:D,addFilesToRequest:E,approveToCommander:L,commandSectionReturn:N,commandSections:A,selectedCommandSection:v,setSelectedCommandSection:w,routeToCommandSection:S})=>{const[p,I]=u.useState(!1),[j,$]=u.useState(!1),[g,R]=u.useState(null),O=T(e.id);return n.jsxs("div",{id:`details-csec-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":p,"aria-controls":`docs-csec-${e.id}`,onClick:()=>I(!p),children:[n.jsxs("span",{children:[p?"Hide":"Show"," Documents (",O.length,")"]}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${p?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),n.jsx("div",{id:`docs-csec-${e.id}`,className:`${p?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Y,{documents:O.map(m=>({...m,fileUrl:m.fileUrl})),showIcons:!0,onPreview:m=>R(O.find(b=>b.id===m.id)||null)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:h[e.id]||"",onChange:m=>y(b=>({...b,[e.id]:m.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 text-sm rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:m=>D(b=>({...b,[e.id]:m.target.files?Array.from(m.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(k[e.id]||[]).length?`${(k[e.id]||[]).length} file(s) selected`:"No files selected"}),(k[e.id]||[]).length>0&&n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>E(e),children:"Save Files"})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>$(!j),"aria-expanded":j,"aria-controls":`logs-csec-${e.id}`,children:[j?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-csec-${e.id}`,className:j?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((m,b)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[m.actor," • ",new Date(m.timestamp).toLocaleString()," • ",m.action]}),m.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:m.comment})]},b)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),A.length>1&&n.jsxs("div",{className:"pt-2 border-t border-brand-navy/10",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Route to Another Section"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{value:v[e.id]||"",onChange:m=>w(b=>({...b,[e.id]:m.target.value})),className:"flex-1 px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold text-sm",children:[n.jsx("option",{value:"",children:"Select section..."}),A.filter(m=>m!==e.routeSection).map(m=>n.jsx("option",{value:m,children:m},m))]}),n.jsx("button",{className:"px-4 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>S(e,v[e.id]||""),disabled:!v[e.id],children:"Route"})]})]}),n.jsxs("div",{className:"pt-2 border-t border-brand-navy/10 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>L(e),children:"Approve to Commander"}),n.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>N(e),children:"Return to Battalion"})]}),g&&n.jsx(se,{fileName:g.name,url:g.fileUrl||"",mimeType:g.type||"",fileSize:g.size||0,isOpen:!!g,onClose:()=>R(null)})]})};function Ie(){const[e,T]=u.useState(null),[h,y]=u.useState([]),[k,D]=u.useState([]),[E,L]=u.useState({}),[N,A]=u.useState({}),[v,w]=u.useState([]),[S,p]=u.useState({}),[I,j]=u.useState({}),[$,g]=u.useState({}),[R,O]=u.useState({}),[m,b]=u.useState(null),F=u.useRef(null),[l,f]=u.useState({}),[P,_]=u.useState({}),[we,Z]=u.useState(null),M=pe();u.useEffect(()=>{const t=c=>{m&&F.current&&!F.current.contains(c.target)&&(g(o=>({...o,[m]:!1})),b(null))},s=c=>{c.key==="Escape"&&m&&(g(o=>({...o,[m]:!1})),b(null))};return document.addEventListener("mousedown",t),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",s)}},[m]);const[z,H]=u.useState({});u.useEffect(()=>{try{const t=localStorage.getItem("currentUser");if(t){const s=JSON.parse(t);T(s)}}catch{}},[]),u.useEffect(()=>{e!=null&&e.installationId&&he().then(t=>{const s=t.find(c=>c.id===e.installationId);Z(s||null)}).catch(()=>Z(null))},[e]),u.useEffect(()=>{fe().then(t=>{y(t)}).catch(()=>y([]))},[]),u.useEffect(()=>{ge().then(t=>{D(t)}).catch(()=>D([]))},[]),u.useEffect(()=>{ye().then(t=>{const s={};for(const c of t)c!=null&&c.id&&(s[c.id]=c);L(s)}).catch(()=>L({}))},[]);const V=()=>{if(e!=null&&e.unitUic)return e.unitUic;if(e!=null&&e.unit){const t=je.find(s=>s.unitName===e.unit);if(t)return t.uic}return""};u.useEffect(()=>{try{const t=localStorage.getItem("unit_structure"),s=V();if(!s)return;const c=[],o={};if(t){const i=JSON.parse(t),d=i==null?void 0:i[s];d&&Array.isArray(d._commandSections)&&c.push(...d._commandSections);for(const r of Object.keys(i||{})){const a=i[r];a&&a._platoonSectionMap&&typeof a._platoonSectionMap=="object"&&(o[r]=a._platoonSectionMap)}w(c),f(o)}else(async()=>{try{const i=await ve(),d=[],r={},a=i==null?void 0:i[s];a&&Array.isArray(a._commandSections)&&d.push(...a._commandSections);for(const x of Object.keys(i||{})){const C=i[x];C&&C._platoonSectionMap&&typeof C._platoonSectionMap=="object"&&(r[x]=C._platoonSectionMap)}w(d),f(r)}catch{}})()}catch{}},[e]);const W=t=>k.filter(s=>s.requestId===t),ee=t=>E[t.uploadedById]||null,te=t=>{var r,a;const s=v.map(x=>String(x||"").trim().toUpperCase());if(t.activity&&t.activity.length)for(let x=t.activity.length-1;x>=0;x--){const C=t.activity[x],U=String(C.fromSection||"").trim(),oe=U.toUpperCase();if(U&&!s.includes(oe)&&oe!=="COMMANDER")return U;const Q=String(C.toSection||"").trim(),ie=Q.toUpperCase();if(Q&&!s.includes(ie)&&ie!=="COMMANDER"&&/battalion|section/i.test(String(C.action||"")))return Q}if(t.routeSection){const x=String(t.routeSection||"").trim().toUpperCase();if(!s.includes(x))return t.routeSection}const c=t.unitUic||"",o=ee(t),i=o!=null&&o.company&&o.company!=="N/A"?o.company:"",d=o!=null&&o.unit&&o.unit!=="N/A"?o.unit:"";return((a=(r=l[c])==null?void 0:r[i])==null?void 0:a[d])||""},K=u.useMemo(()=>{const t=V();return h.filter(s=>{const c=s.currentStage||"",o=s.unitUic||"";return c==="COMMANDER_REVIEW"&&(!s.routeSection||s.routeSection==="")&&(t?o===t:!0)})},[h,e,V]);u.useMemo(()=>{const t=(e==null?void 0:e.installationId)||"";return h.filter(s=>(s.currentStage||"")==="INSTALLATION_REVIEW"&&(!s.routeSection||s.routeSection==="")&&(t?s.installationId===t:!0))},[h,e]);const B=u.useMemo(()=>{const t=V(),s={},c=i=>String(i||"").trim().toUpperCase(),o=v.map(i=>c(i));for(const i of v)s[i]=[];for(const i of h){const d=i.currentStage||"",r=i.unitUic||"",a=i.routeSection||"",x=c(a);if(d==="COMMANDER_REVIEW"&&a&&(!t||r===t)){const C=o.indexOf(x),U=C>=0?v[C]:a;s[U]||(s[U]=[]),s[U].push(i)}}return s},[h,v,e,V]),ae=t=>`"${String(t??"").replace(/"/g,'""')}"`,J=t=>{const c=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const o of t){const i=ee(o),d=i?`${i.rank} ${i.lastName}, ${i.firstName}${i.mi?` ${i.mi}`:""}`:"",r=W(o.id).map(a=>a.name).join(" | ");c.push([o.id,o.subject,o.currentStage||"",o.routeSection||"",d,o.unitUic||"",new Date(o.createdAt).toLocaleString(),r])}return c.map(o=>o.map(ae).join(",")).join(`\r
`)},G=(t,s)=>{const c=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(c),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)},ce=()=>G("commander.csv",J(K)),de=t=>G(`${t}.csv`,J(B[t]||[])),re=()=>G("command_all.csv",J([...K,...v.flatMap(t=>B[t]||[])])),le=async t=>{const s=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",c=t.routeSection||"",o={actor:s,timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(S[t.id]||"").trim(),fromSection:c||void 0,toSection:"Commander"},i={...t,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:[...t.activity||[],o]};try{await q(i),y(d=>d.map(r=>r.id===i.id?i:r)),p(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to approve request to commander:",d),M.error("Failed to approve request to commander")}},me=async t=>{const s=P[t.id]||"";if(!s||s==="NONE")return;const c=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=`Sent to ${s} for review by Commander`,i={...t,currentStage:"COMMANDER_REVIEW",routeSection:s,activity:[...t.activity||[],{actor:c,timestamp:new Date().toISOString(),action:o,comment:(S[t.id]||"").trim(),fromSection:"Commander",toSection:s}]};try{await q(i),y(d=>d.map(r=>r.id===i.id?i:r)),p(d=>({...d,[t.id]:""})),_(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to send to command section:",d),M.error("Failed to send to command section")}},ue=async(t,s)=>{const c=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=te(t),i=s==="Approved"?"Approved by Commander":s==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",d={...t,currentStage:"BATTALION_REVIEW",routeSection:o||t.routeSection||"",commanderApprovalDate:s==="Approved"?new Date().toISOString():t.commanderApprovalDate,activity:[...t.activity||[],{actor:c,timestamp:new Date().toISOString(),action:i,comment:(S[t.id]||"").trim(),fromSection:"Commander",toSection:o||t.routeSection||void 0}]};try{await q(d),y(r=>r.map(a=>a.id===d.id?d:a)),p(r=>({...r,[t.id]:""})),_(r=>({...r,[t.id]:""}))}catch(r){console.error("Failed to make commander decision:",r),M.error("Failed to record commander decision")}},xe=async t=>{const s=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",c=te(t),o=t.routeSection||"",i=`Returned to ${c||"Battalion"} by ${o||"Command Section"}`,d={actor:s,timestamp:new Date().toISOString(),action:i,comment:(S[t.id]||"").trim(),fromSection:o||void 0,toSection:c||void 0},r={...t,currentStage:"BATTALION_REVIEW",routeSection:c||t.routeSection||"",activity:[...t.activity||[],d]};try{await q(r),y(a=>a.map(x=>x.id===r.id?r:x)),p(a=>({...a,[t.id]:""}))}catch(a){console.error("Failed to return from command section:",a),M.error("Failed to return from command section")}},be=async(t,s)=>{if(!s)return;const c=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",o=t.routeSection||"",i=`Routed to ${s} by ${o||"Command Section"}`,d={actor:c,timestamp:new Date().toISOString(),action:i,comment:(S[t.id]||"").trim(),fromSection:o||void 0,toSection:s},r={...t,currentStage:"COMMANDER_REVIEW",routeSection:s,activity:[...t.activity||[],d]};try{await q(r),y(a=>a.map(x=>x.id===r.id?r:x)),p(a=>({...a,[t.id]:""})),_(a=>({...a,[t.id]:""})),M.success(`Routed to ${s}`)}catch(a){console.error("Failed to route to command section:",a),M.error("Failed to route to command section")}},ne=async t=>{const s=I[t.id]||[];if(!s.length||!(e!=null&&e.id))return;const c=Date.now(),o=s.map((a,x)=>({id:`${c}-${x}`,name:a.name,type:a.type,size:a.size,uploadedAt:new Date().toISOString(),subject:t.subject,requestId:t.id,fileUrl:URL.createObjectURL(a)})),d={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${o.length} document(s)`,comment:(S[t.id]||"").trim()},r={...t,documentIds:[...t.documentIds||[],...o.map(a=>a.id)],activity:[...t.activity||[],d]};try{await Se(o),await q(r),D(a=>[...a,...o]),y(a=>a.map(x=>x.id===r.id?r:x)),j(a=>({...a,[t.id]:[]})),p(a=>({...a,[t.id]:""}))}catch(a){console.error("Failed to add files to request:",a),M.error("Failed to add files to request")}};return n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Unit Command Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(e==null?void 0:e.unitUic)||""}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:re,children:"Export All"})]})]}),n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ce,children:"Export Commander"})]}),n.jsx("div",{className:"mt-4",children:n.jsx(X,{title:"Pending",requests:K.filter(t=>t.currentStage!=="ARCHIVED"),users:E,onRowClick:t=>H(s=>({...s,[t.id]:!s[t.id]})),expandedRows:z,platoonSectionMap:l,children:t=>n.jsx(Ne,{r:t,docsFor:W,expandedDocs:$,setExpandedDocs:g,setOpenDocsId:b,docsRef:F,comments:S,setComments:p,attach:I,setAttach:j,addFilesToRequest:ne,selectedCommandSection:P,setSelectedCommandSection:_,commandSections:v,sendToCommandSection:me,commanderDecision:ue,expandedLogs:N,setExpandedLogs:A})})})]}),v.map(t=>{const s=(B[t]||[]).filter(o=>o.currentStage!=="ARCHIVED"),c=(B[t]||[]).filter(o=>o.currentStage==="ARCHIVED");return n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:t}),n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>de(t),children:["Export ",t]})]}),n.jsx("div",{className:"mt-4",children:n.jsx(X,{title:"Pending",requests:s,users:E,onRowClick:o=>H(i=>({...i,[o.id]:!i[o.id]})),expandedRows:z,platoonSectionMap:l,children:o=>n.jsx(Ce,{r:o,docsFor:W,comments:S,setComments:p,attach:I,setAttach:j,addFilesToRequest:ne,approveToCommander:le,commandSectionReturn:xe,commandSections:v,selectedCommandSection:P,setSelectedCommandSection:_,routeToCommandSection:be})})}),c.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(X,{title:"Archived",requests:c,users:E,onRowClick:o=>H(i=>({...i,[o.id]:!i[o.id]})),expandedRows:z,platoonSectionMap:l,children:o=>n.jsxs("div",{id:`details-csec-archived-${o.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",o.finalStatus||"Archived"]}),n.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),n.jsxs("div",{children:[n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!$[o.id],"aria-controls":`docs-csec-archived-${o.id}`,onClick:()=>{g(i=>({...i,[o.id]:!i[o.id]})),b(i=>$[o.id]?null:o.id)},children:"Show Documents"}),n.jsx("div",{id:`docs-csec-archived-${o.id}`,className:`${$[o.id]?"mt-2 space-y-2":"hidden"}`,children:n.jsx(Y,{documents:W(o.id).map(i=>({...i,fileUrl:i.fileUrl}))})})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!N[o.id],"aria-controls":`logs-csec-archived-${o.id}`,onClick:()=>A(i=>({...i,[o.id]:!i[o.id]})),children:[N[o.id]?"Hide":"Show"," Full Activity Log"]}),n.jsx("div",{id:`logs-csec-archived-${o.id}`,className:N[o.id]?"mt-2 space-y-2":"hidden",children:o.activity&&o.activity.length?o.activity.map((i,d)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[i.actor," • ",new Date(i.timestamp).toLocaleString()," • ",i.action]}),i.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:i.comment})]},d)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},t)})]})]})})}export{Ie as default};
