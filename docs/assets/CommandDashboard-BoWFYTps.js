import{j as n,r as m}from"./index-UUCbtA12.js";import{l as ue}from"./unitStructure-QC5qYuxv.js";import{w as be,c as xe,l as he,e as ge,u as D,f as pe}from"./db-Y4g5ldnd.js";import{R as K}from"./RequestTable-0q-w1zkb.js";import{U as ve}from"./units-CaNgy_2U.js";const fe=({r:t,docsFor:R,expandedDocs:u,setExpandedDocs:h,setOpenDocsId:I,docsRef:C,comments:y,setComments:M,attach:p,setAttach:_,addFilesToRequest:v,selectedCommandSection:S,setSelectedCommandSection:b,commandSections:g,sendToCommandSection:L,commanderDecision:A,commanderArchive:E,commanderReturn:$,expandedLogs:q,setExpandedLogs:J})=>{const j=S[t.id]&&S[t.id]!=="NONE",w=()=>{const r=!!u[t.id];h(x=>({...x,[t.id]:!r})),I(r?null:t.id)};return n.jsxs("div",{id:`details-cmd-${t.id}`,children:[n.jsx("div",{className:"mt-3",children:n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!u[t.id],"aria-controls":`docs-cmd-${t.id}`,onClick:w,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),w())},children:[n.jsx("span",{children:"Show Documents"}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${u[t.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),n.jsxs("div",{id:`docs-cmd-${t.id}`,ref:u[t.id]?C:void 0,className:`${u[t.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:[R(t.id).map(r=>n.jsxs("div",{className:"flex items-center justify-between p-3 border border-brand-navy/20 rounded-lg bg-[var(--surface)]",children:[n.jsxs("div",{className:"text-sm text-[var(--muted)]",children:[n.jsx("div",{className:"font-medium text-[var(--text)]",children:r.name}),n.jsx("div",{children:new Date(r.uploadedAt).toLocaleDateString()})]}),n.jsx("div",{className:"flex items-center gap-2",children:r.fileUrl?n.jsx("a",{href:r.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",children:"Open"}):n.jsx("span",{className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded opacity-60","aria-disabled":"true",children:"Open"})})]},r.id)),R(t.id).length===0&&n.jsx("div",{className:"text-sm text-[var(--muted)]",children:"No documents"})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:y[t.id]||"",onChange:r=>M(x=>({...x,[t.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:r=>_(x=>({...x,[t.id]:r.target.files?Array.from(r.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(p[t.id]||[]).length?`${(p[t.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>v(t),disabled:!p[t.id]||!(p[t.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),n.jsxs("select",{value:S[t.id]||"NONE",onChange:r=>b(x=>({...x,[t.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[n.jsx("option",{value:"NONE",children:"None - Make final decision below"}),g.map(r=>n.jsx("option",{value:r,children:r},r))]}),j?n.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',S[t.id],'" to route for their review']}):n.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),j&&n.jsx("div",{className:"mt-3 flex items-center justify-end",children:n.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>L(t),children:["Send to ",S[t.id]]})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>A(t,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>A(t,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>A(t,"Rejected"),children:"Rejected"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>$(t),children:"Return to Battalion"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>E(t),children:"Archive"})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>J(r=>({...r,[t.id]:!r[t.id]})),"aria-expanded":!!q[t.id],"aria-controls":`logs-cmd-${t.id}`,children:[q[t.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-cmd-${t.id}`,className:q[t.id]?"mt-2 space-y-2":"hidden",children:t.activity&&t.activity.length?t.activity.map((r,x)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[r.actor," • ",new Date(r.timestamp).toLocaleString()," • ",r.action]}),r.comment&&n.jsx("div",{className:"text-gray-600",children:r.comment})]},x)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]})]})},ye=({r:t,comments:R,setComments:u,approveToCommander:h,commandSectionReturn:I})=>n.jsxs("div",{id:`details-csec-${t.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:R[t.id]||"",onChange:C=>u(y=>({...y,[t.id]:C.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2",onClick:()=>h(t),children:"Approve to Commander"}),n.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>I(t),children:"Return to Battalion"})]})]});function Re(){const[t,R]=m.useState(null),[u,h]=m.useState([]),[I,C]=m.useState([]),[y,M]=m.useState({}),[p,_]=m.useState({}),[v,S]=m.useState([]),[b,g]=m.useState({}),[L,A]=m.useState({}),[E,$]=m.useState({}),[q,J]=m.useState({}),[j,w]=m.useState(null),r=m.useRef(null),[x,G]=m.useState({}),[Q,O]=m.useState({}),[Se,X]=m.useState(null);m.useEffect(()=>{const e=i=>{j&&r.current&&!r.current.contains(i.target)&&($(a=>({...a,[j]:!1})),w(null))},s=i=>{i.key==="Escape"&&j&&($(a=>({...a,[j]:!1})),w(null))};return document.addEventListener("mousedown",e),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",s)}},[j]);const[F,V]=m.useState({});m.useEffect(()=>{try{const e=localStorage.getItem("currentUser");if(e){const s=JSON.parse(e);console.log("CommandDashboard - loaded currentUser from localStorage:",s),R(s)}}catch(e){console.error("CommandDashboard - failed to load currentUser:",e)}},[]),m.useEffect(()=>{t!=null&&t.installationId&&be().then(e=>{const s=e.find(i=>i.id===t.installationId);X(s||null)}).catch(()=>X(null))},[t]),m.useEffect(()=>{xe().then(e=>{h(e)}).catch(()=>h([]))},[]),m.useEffect(()=>{he().then(e=>{C(e)}).catch(()=>C([]))},[]),m.useEffect(()=>{ge().then(e=>{const s={};for(const i of e)i!=null&&i.id&&(s[i.id]=i);M(s)}).catch(()=>M({}))},[]);const U=()=>{if(t!=null&&t.unitUic)return t.unitUic;if(t!=null&&t.unit){const e=ve.find(s=>s.unitName===t.unit);if(e)return e.uic}return""};m.useEffect(()=>{try{const e=localStorage.getItem("unit_structure");console.log("CommandDashboard - localStorage has unit_structure:",!!e),console.log("CommandDashboard - currentUser:",t);const s=U();if(console.log("CommandDashboard - currentUser UIC (with fallback):",s),!s){console.log("CommandDashboard - skipping section load: no UIC available");return}const i=[],a={};if(e){const o=JSON.parse(e);console.log("CommandDashboard - parsed unit_structure keys:",Object.keys(o));const d=o==null?void 0:o[s];console.log(`CommandDashboard - unit data for UIC ${s}:`,d),console.log(`CommandDashboard - _commandSections for ${s}:`,d==null?void 0:d._commandSections),d&&Array.isArray(d._commandSections)&&i.push(...d._commandSections);for(const c of Object.keys(o||{})){const l=o[c];l&&l._platoonSectionMap&&typeof l._platoonSectionMap=="object"&&(a[c]=l._platoonSectionMap)}console.log("CommandDashboard - loaded sections:",i),S(i),G(a)}else console.log("CommandDashboard - loading from bundle (async)"),(async()=>{try{const o=await ue(),d=[],c={},l=o==null?void 0:o[s];l&&Array.isArray(l._commandSections)&&d.push(...l._commandSections);for(const f of Object.keys(o||{})){const N=o[f];N&&N._platoonSectionMap&&typeof N._platoonSectionMap=="object"&&(c[f]=N._platoonSectionMap)}console.log("CommandDashboard - loaded from bundle:",d),S(d),G(c)}catch(o){console.error("CommandDashboard - failed to load from bundle:",o)}})()}catch(e){console.error("CommandDashboard - error in useEffect:",e)}},[t]);const T=e=>I.filter(s=>s.requestId===e),Y=e=>y[e.uploadedById]||null,B=e=>{var d,c;if(e.routeSection)return e.routeSection;const s=e.unitUic||"",i=Y(e),a=i!=null&&i.company&&i.company!=="N/A"?i.company:"",o=i!=null&&i.unit&&i.unit!=="N/A"?i.unit:"";return((c=(d=x[s])==null?void 0:d[a])==null?void 0:c[o])||""},W=m.useMemo(()=>{const e=U();return u.filter(s=>{const i=s.currentStage||"",a=s.unitUic||"";return i==="COMMANDER_REVIEW"&&(!s.routeSection||s.routeSection==="")&&(e?a===e:!0)})},[u,t,U]);m.useMemo(()=>{const e=(t==null?void 0:t.installationId)||"";return u.filter(s=>(s.currentStage||"")==="INSTALLATION_REVIEW"&&(!s.routeSection||s.routeSection==="")&&(e?s.installationId===e:!0))},[u,t]);const k=m.useMemo(()=>{var d;const e=U(),s={},i=c=>String(c||"").trim().toUpperCase(),a=v.map(c=>i(c));console.log("CommandDashboard - byCommandSection START"),console.log("CommandDashboard - commandSections:",v),console.log("CommandDashboard - normalized sections:",a),console.log("CommandDashboard - filtering by UIC:",e);for(const c of v)s[c]=[];const o=u.filter(c=>c.currentStage==="COMMANDER_REVIEW");console.log("CommandDashboard - Total COMMANDER_REVIEW requests:",o.length);for(const c of o)console.log("CommandDashboard - Processing request:",{id:c.id,subject:(d=c.subject)==null?void 0:d.substring(0,30),routeSection:c.routeSection,hasRouteSection:!!c.routeSection,unitUic:c.unitUic});for(const c of u){const l=c.currentStage||"",f=c.unitUic||"",N=c.routeSection||"",me=i(N);if(l==="COMMANDER_REVIEW"&&N&&(!e||f===e)){const Z=a.indexOf(me),z=Z>=0?v[Z]:N;s[z]||(s[z]=[]),s[z].push(c)}}return console.log("CommandDashboard - byCommandSection FINAL result:",s),s},[u,v,t,U]),ee=e=>`"${String(e??"").replace(/"/g,'""')}"`,H=e=>{const i=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const a of e){const o=Y(a),d=o?`${o.rank} ${o.lastName}, ${o.firstName}${o.mi?` ${o.mi}`:""}`:"",c=T(a.id).map(l=>l.name).join(" | ");i.push([a.id,a.subject,a.currentStage||"",a.routeSection||"",d,a.unitUic||"",new Date(a.createdAt).toLocaleString(),c])}return i.map(a=>a.map(ee).join(",")).join(`\r
`)},P=(e,s)=>{const i=new Blob([s],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(i),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},te=()=>P("commander.csv",H(W)),ne=e=>P(`${e}.csv`,H(k[e]||[])),oe=()=>P("command_all.csv",H([...W,...v.flatMap(e=>k[e]||[])])),ae=async e=>{const i={actor:t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(b[e.id]||"").trim()},a={...e,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:Array.isArray(e.activity)?[...e.activity,i]:[i]};try{await D(a),h(o=>o.map(d=>d.id===a.id?a:d)),g(o=>({...o,[e.id]:""}))}catch(o){console.error("Failed to approve request to commander:",o)}},se=async e=>{const s=Q[e.id]||"";if(!s||s==="NONE")return;const i=t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Commander",a=`Sent to ${s} for review by Commander`,o={...e,currentStage:"COMMANDER_REVIEW",routeSection:s,activity:Array.isArray(e.activity)?[...e.activity,{actor:i,timestamp:new Date().toISOString(),action:a,comment:(b[e.id]||"").trim()}]:[{actor:i,timestamp:new Date().toISOString(),action:a,comment:(b[e.id]||"").trim()}]};console.log("CommandDashboard - sendToCommandSection BEFORE SAVE:",{requestId:e.id,cmdSection:s,updatedRouteSec:o.routeSection,updatedStage:o.currentStage,actionText:a});try{await D(o),h(d=>d.map(c=>c.id===o.id?o:c)),g(d=>({...d,[e.id]:""})),O(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to send to command section:",d)}},ie=async(e,s)=>{const i=t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Commander",a=B(e),o=s==="Approved"?"Approved by Commander":s==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",d={...e,currentStage:s==="Rejected"?"ARCHIVED":"BATTALION_REVIEW",finalStatus:s==="Rejected"?"Rejected":e.finalStatus,routeSection:a||e.routeSection||"",commanderApprovalDate:s==="Approved"?new Date().toISOString():e.commanderApprovalDate,activity:Array.isArray(e.activity)?[...e.activity,{actor:i,timestamp:new Date().toISOString(),action:o,comment:(b[e.id]||"").trim()}]:[{actor:i,timestamp:new Date().toISOString(),action:o,comment:(b[e.id]||"").trim()}]};console.log("CommandDashboard - commander decision:",{type:s,stage:d.currentStage,routeSec:d.routeSection,actionText:o});try{await D(d),h(c=>c.map(l=>l.id===d.id?d:l)),g(c=>({...c,[e.id]:""})),O(c=>({...c,[e.id]:""}))}catch(c){console.error("Failed to make commander decision:",c)}},de=async e=>{const i={actor:t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Commander",timestamp:new Date().toISOString(),action:"Archived by Commander",comment:(b[e.id]||"").trim()},a={...e,currentStage:"ARCHIVED",finalStatus:"Archived",activity:Array.isArray(e.activity)?[...e.activity,i]:[i]};try{await D(a),h(o=>o.map(d=>d.id===a.id?a:d)),g(o=>({...o,[e.id]:""})),O(o=>({...o,[e.id]:""}))}catch(o){console.error("Failed to archive request:",o)}},ce=async e=>{const s=t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Commander",i=B(e),a={actor:s,timestamp:new Date().toISOString(),action:`Returned to ${i||"Battalion"} by Commander`,comment:(b[e.id]||"").trim()},o={...e,currentStage:"BATTALION_REVIEW",routeSection:i||e.routeSection||"",activity:Array.isArray(e.activity)?[...e.activity,a]:[a]};try{await D(o),h(d=>d.map(c=>c.id===o.id?o:c)),g(d=>({...d,[e.id]:""})),O(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to return request:",d)}},re=async e=>{const s=t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Command Section",i=B(e),a=`Returned to ${i||"Battalion"} by ${e.routeSection||"Command Section"}`,o={...e,currentStage:"BATTALION_REVIEW",routeSection:i||e.routeSection||"",activity:Array.isArray(e.activity)?[...e.activity,{actor:s,timestamp:new Date().toISOString(),action:a,comment:(b[e.id]||"").trim()}]:[{actor:s,timestamp:new Date().toISOString(),action:a,comment:(b[e.id]||"").trim()}]};console.log("CommandDashboard - command section return:",{stage:o.currentStage,routeSec:o.routeSection,actionText:a});try{await D(o),h(d=>d.map(c=>c.id===o.id?o:c)),g(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to return from command section:",d)}},le=async e=>{const s=L[e.id]||[];if(!s.length||!(t!=null&&t.id))return;const i=Date.now(),a=s.map((l,f)=>({id:`${i}-${f}`,name:l.name,type:l.type,size:l.size,uploadedAt:new Date().toISOString(),subject:e.subject,requestId:e.id,fileUrl:URL.createObjectURL(l)})),d={actor:t?`${t.rank} ${t.lastName}, ${t.firstName}${t.mi?` ${t.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${a.length} document(s)`,comment:(b[e.id]||"").trim()},c={...e,documentIds:[...e.documentIds||[],...a.map(l=>l.id)],activity:Array.isArray(e.activity)?[...e.activity,d]:[d]};try{await pe(a),await D(c),C(l=>[...l,...a]),h(l=>l.map(f=>f.id===c.id?c:f)),A(l=>({...l,[e.id]:[]})),g(l=>({...l,[e.id]:""}))}catch(l){console.error("Failed to add files to request:",l)}};return n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Command Sections Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(t==null?void 0:t.unitUic)||""}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:oe,children:"Export All"})]})]}),n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:te,children:"Export Commander"})]}),n.jsx("div",{className:"mt-4",children:n.jsx(K,{title:"Pending",requests:W.filter(e=>e.currentStage!=="ARCHIVED"),users:y,onRowClick:e=>V(s=>({...s,[e.id]:!s[e.id]})),expandedRows:F,platoonSectionMap:x,children:e=>n.jsx(fe,{r:e,docsFor:T,expandedDocs:E,setExpandedDocs:$,setOpenDocsId:w,docsRef:r,comments:b,setComments:g,attach:L,setAttach:A,addFilesToRequest:le,selectedCommandSection:Q,setSelectedCommandSection:O,commandSections:v,sendToCommandSection:se,commanderDecision:ie,commanderArchive:de,commanderReturn:ce,expandedLogs:p,setExpandedLogs:_})})})]}),Object.keys(k).filter(e=>(k[e]||[]).length>0).map(e=>{const s=(k[e]||[]).filter(a=>a.currentStage!=="ARCHIVED"),i=(k[e]||[]).filter(a=>a.currentStage==="ARCHIVED");return n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:e}),n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>ne(e),children:["Export ",e]})]}),s.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(K,{title:"Pending",requests:s,users:y,onRowClick:a=>V(o=>({...o,[a.id]:!o[a.id]})),expandedRows:F,platoonSectionMap:x,children:a=>n.jsx(ye,{r:a,comments:b,setComments:g,approveToCommander:ae,commandSectionReturn:re})})}),i.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(K,{title:"Archived",requests:i,users:y,onRowClick:a=>V(o=>({...o,[a.id]:!o[a.id]})),expandedRows:F,platoonSectionMap:x,children:a=>n.jsxs("div",{id:`details-csec-archived-${a.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",a.finalStatus||"Archived"]}),n.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),n.jsxs("div",{children:[n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!E[a.id],"aria-controls":`docs-csec-archived-${a.id}`,onClick:()=>{$(o=>({...o,[a.id]:!o[a.id]})),w(o=>E[a.id]?null:a.id)},children:"Show Documents"}),n.jsxs("div",{id:`docs-csec-archived-${a.id}`,className:`${E[a.id]?"mt-2 space-y-2":"hidden"}`,children:[T(a.id).map(o=>n.jsxs("div",{className:"flex items-center justify-between p-3 border border-brand-navy/20 rounded-lg bg-[var(--surface)]",children:[n.jsxs("div",{className:"text-sm",children:[n.jsx("div",{className:"font-medium",children:o.name}),n.jsx("div",{className:"text-gray-500",children:new Date(o.uploadedAt).toLocaleDateString()})]}),o.fileUrl&&n.jsx("a",{href:o.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded hover:bg-brand-gold-2",children:"Open"})]},o.id)),T(a.id).length===0&&n.jsx("div",{className:"text-sm text-gray-500",children:"No documents"})]})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!p[a.id],"aria-controls":`logs-csec-archived-${a.id}`,onClick:()=>_(o=>({...o,[a.id]:!o[a.id]})),children:[p[a.id]?"Hide":"Show"," Full Activity Log"]}),n.jsx("div",{id:`logs-csec-archived-${a.id}`,className:p[a.id]?"mt-2 space-y-2":"hidden",children:a.activity&&a.activity.length?a.activity.map((o,d)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[o.actor," • ",new Date(o.timestamp).toLocaleString()," • ",o.action]}),o.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:o.comment})]},d)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},e)})]})]})})}export{Re as default};
