import{r as m,j as n,u as me}from"./index-D18638q3.js";import{l as ue}from"./unitStructure-QC5qYuxv.js";import{w as xe,c as be,l as pe,e as ve,u as T,f as he}from"./db-COH8mKmS.js";import{R as G}from"./RequestTable-CD7Rg_HK.js";import{U as fe}from"./units-CaNgy_2U.js";import{a as Q,D as ne}from"./DocumentListItem-RgOoLLbb.js";const ge=({r:e,docsFor:U,expandedDocs:b,setExpandedDocs:g,setOpenDocsId:k,docsRef:R,comments:C,setComments:O,attach:y,setAttach:j,addFilesToRequest:N,selectedCommandSection:f,setSelectedCommandSection:p,commandSections:x,sendToCommandSection:$,commanderDecision:S,expandedLogs:u,setExpandedLogs:v})=>{const[A,V]=m.useState(null),E=f[e.id]&&f[e.id]!=="NONE",D=U(e.id),L=()=>{const r=!!b[e.id];g(h=>({...h,[e.id]:!r})),k(r?null:e.id)};return n.jsxs("div",{id:`details-cmd-${e.id}`,children:[n.jsx("div",{className:"mt-3",children:n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!b[e.id],"aria-controls":`docs-cmd-${e.id}`,onClick:L,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),L())},children:[n.jsx("span",{children:"Show Documents"}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${b[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),n.jsx("div",{id:`docs-cmd-${e.id}`,ref:b[e.id]?R:void 0,className:`${b[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Q,{documents:D.map(r=>({...r,fileUrl:r.fileUrl})),showIcons:!0,onPreview:r=>V(D.find(h=>h.id===r.id)||null)})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:C[e.id]||"",onChange:r=>O(h=>({...h,[e.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:r=>j(h=>({...h,[e.id]:r.target.files?Array.from(r.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(y[e.id]||[]).length?`${(y[e.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>N(e),disabled:!y[e.id]||!(y[e.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),n.jsxs("select",{value:f[e.id]||"NONE",onChange:r=>p(h=>({...h,[e.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[n.jsx("option",{value:"NONE",children:"None - Make final decision below"}),x.map(r=>n.jsx("option",{value:r,children:r},r))]}),E?n.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',f[e.id],'" to route for their review']}):n.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),E&&n.jsx("div",{className:"mt-3 flex items-center justify-end",children:n.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>$(e),children:["Send to ",f[e.id]]})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>S(e,"Rejected"),children:"Rejected"})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>v(r=>({...r,[e.id]:!r[e.id]})),"aria-expanded":!!u[e.id],"aria-controls":`logs-cmd-${e.id}`,children:[u[e.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-cmd-${e.id}`,className:u[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((r,h)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[r.actor," • ",new Date(r.timestamp).toLocaleString()," • ",r.action]}),r.comment&&n.jsx("div",{className:"text-gray-600",children:r.comment})]},h)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),A&&n.jsx(ne,{fileName:A.name,url:A.fileUrl||"",mimeType:A.type||"",fileSize:A.size||0,isOpen:!!A,onClose:()=>V(null)})]})},ye=({r:e,docsFor:U,comments:b,setComments:g,attach:k,setAttach:R,addFilesToRequest:C,approveToCommander:O,commandSectionReturn:y})=>{const[j,N]=m.useState(!1),[f,p]=m.useState(!1),[x,$]=m.useState(null),S=U(e.id);return n.jsxs("div",{id:`details-csec-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":j,"aria-controls":`docs-csec-${e.id}`,onClick:()=>N(!j),children:[n.jsxs("span",{children:[j?"Hide":"Show"," Documents (",S.length,")"]}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${j?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),n.jsx("div",{id:`docs-csec-${e.id}`,className:`${j?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Q,{documents:S.map(u=>({...u,fileUrl:u.fileUrl})),showIcons:!0,onPreview:u=>$(S.find(v=>v.id===u.id)||null)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:b[e.id]||"",onChange:u=>g(v=>({...v,[e.id]:u.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 text-sm rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:u=>R(v=>({...v,[e.id]:u.target.files?Array.from(u.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(k[e.id]||[]).length?`${(k[e.id]||[]).length} file(s) selected`:"No files selected"}),(k[e.id]||[]).length>0&&n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>C(e),children:"Save Files"})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>p(!f),"aria-expanded":f,"aria-controls":`logs-csec-${e.id}`,children:[f?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-csec-${e.id}`,className:f?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((u,v)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[u.actor," • ",new Date(u.timestamp).toLocaleString()," • ",u.action]}),u.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:u.comment})]},v)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"pt-2 border-t border-brand-navy/10 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>O(e),children:"Approve to Commander"}),n.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>y(e),children:"Return to Battalion"})]}),x&&n.jsx(ne,{fileName:x.name,url:x.fileUrl||"",mimeType:x.type||"",fileSize:x.size||0,isOpen:!!x,onClose:()=>$(null)})]})};function ke(){const[e,U]=m.useState(null),[b,g]=m.useState([]),[k,R]=m.useState([]),[C,O]=m.useState({}),[y,j]=m.useState({}),[N,f]=m.useState([]),[p,x]=m.useState({}),[$,S]=m.useState({}),[u,v]=m.useState({}),[A,V]=m.useState({}),[E,D]=m.useState(null),L=m.useRef(null),[r,h]=m.useState({}),[X,B]=m.useState({}),[Se,Y]=m.useState(null),q=me();m.useEffect(()=>{const t=a=>{E&&L.current&&!L.current.contains(a.target)&&(v(o=>({...o,[E]:!1})),D(null))},s=a=>{a.key==="Escape"&&E&&(v(o=>({...o,[E]:!1})),D(null))};return document.addEventListener("mousedown",t),document.addEventListener("keydown",s),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",s)}},[E]);const[P,W]=m.useState({});m.useEffect(()=>{try{const t=localStorage.getItem("currentUser");if(t){const s=JSON.parse(t);U(s)}}catch{}},[]),m.useEffect(()=>{e!=null&&e.installationId&&xe().then(t=>{const s=t.find(a=>a.id===e.installationId);Y(s||null)}).catch(()=>Y(null))},[e]),m.useEffect(()=>{be().then(t=>{g(t)}).catch(()=>g([]))},[]),m.useEffect(()=>{pe().then(t=>{R(t)}).catch(()=>R([]))},[]),m.useEffect(()=>{ve().then(t=>{const s={};for(const a of t)a!=null&&a.id&&(s[a.id]=a);O(s)}).catch(()=>O({}))},[]);const F=()=>{if(e!=null&&e.unitUic)return e.unitUic;if(e!=null&&e.unit){const t=fe.find(s=>s.unitName===e.unit);if(t)return t.uic}return""};m.useEffect(()=>{try{const t=localStorage.getItem("unit_structure"),s=F();if(!s)return;const a=[],o={};if(t){const i=JSON.parse(t),d=i==null?void 0:i[s];d&&Array.isArray(d._commandSections)&&a.push(...d._commandSections);for(const l of Object.keys(i||{})){const c=i[l];c&&c._platoonSectionMap&&typeof c._platoonSectionMap=="object"&&(o[l]=c._platoonSectionMap)}f(a),h(o)}else(async()=>{try{const i=await ue(),d=[],l={},c=i==null?void 0:i[s];c&&Array.isArray(c._commandSections)&&d.push(...c._commandSections);for(const w of Object.keys(i||{})){const I=i[w];I&&I._platoonSectionMap&&typeof I._platoonSectionMap=="object"&&(l[w]=I._platoonSectionMap)}f(d),h(l)}catch{}})()}catch{}},[e]);const _=t=>k.filter(s=>s.requestId===t),Z=t=>C[t.uploadedById]||null,ee=t=>{var d,l;if(t.routeSection)return t.routeSection;const s=t.unitUic||"",a=Z(t),o=a!=null&&a.company&&a.company!=="N/A"?a.company:"",i=a!=null&&a.unit&&a.unit!=="N/A"?a.unit:"";return((l=(d=r[s])==null?void 0:d[o])==null?void 0:l[i])||""},z=m.useMemo(()=>{const t=F();return b.filter(s=>{const a=s.currentStage||"",o=s.unitUic||"";return a==="COMMANDER_REVIEW"&&(!s.routeSection||s.routeSection==="")&&(t?o===t:!0)})},[b,e,F]);m.useMemo(()=>{const t=(e==null?void 0:e.installationId)||"";return b.filter(s=>(s.currentStage||"")==="INSTALLATION_REVIEW"&&(!s.routeSection||s.routeSection==="")&&(t?s.installationId===t:!0))},[b,e]);const M=m.useMemo(()=>{const t=F(),s={},a=i=>String(i||"").trim().toUpperCase(),o=N.map(i=>a(i));for(const i of N)s[i]=[];for(const i of b){const d=i.currentStage||"",l=i.unitUic||"",c=i.routeSection||"",w=a(c);if(d==="COMMANDER_REVIEW"&&c&&(!t||l===t)){const I=o.indexOf(w),J=I>=0?N[I]:c;s[J]||(s[J]=[]),s[J].push(i)}}return s},[b,N,e,F]),oe=t=>`"${String(t??"").replace(/"/g,'""')}"`,H=t=>{const a=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const o of t){const i=Z(o),d=i?`${i.rank} ${i.lastName}, ${i.firstName}${i.mi?` ${i.mi}`:""}`:"",l=_(o.id).map(c=>c.name).join(" | ");a.push([o.id,o.subject,o.currentStage||"",o.routeSection||"",d,o.unitUic||"",new Date(o.createdAt).toLocaleString(),l])}return a.map(o=>o.map(oe).join(",")).join(`\r
`)},K=(t,s)=>{const a=new Blob([s],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),i=document.createElement("a");i.href=o,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o)},ie=()=>K("commander.csv",H(z)),se=t=>K(`${t}.csv`,H(M[t]||[])),ae=()=>K("command_all.csv",H([...z,...N.flatMap(t=>M[t]||[])])),de=async t=>{const s=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",a=t.routeSection||"",o={actor:s,timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(p[t.id]||"").trim(),fromSection:a||void 0,toSection:"Commander"},i={...t,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:Array.isArray(t.activity)?[...t.activity,o]:[o]};try{await T(i),g(d=>d.map(l=>l.id===i.id?i:l)),x(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to approve request to commander:",d),q.error("Failed to approve request to commander")}},ce=async t=>{const s=X[t.id]||"";if(!s||s==="NONE")return;const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=`Sent to ${s} for review by Commander`,i={...t,currentStage:"COMMANDER_REVIEW",routeSection:s,activity:Array.isArray(t.activity)?[...t.activity,{actor:a,timestamp:new Date().toISOString(),action:o,comment:(p[t.id]||"").trim(),fromSection:"Commander",toSection:s}]:[{actor:a,timestamp:new Date().toISOString(),action:o,comment:(p[t.id]||"").trim(),fromSection:"Commander",toSection:s}]};try{await T(i),g(d=>d.map(l=>l.id===i.id?i:l)),x(d=>({...d,[t.id]:""})),B(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to send to command section:",d),q.error("Failed to send to command section")}},re=async(t,s)=>{const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=ee(t),i=s==="Approved"?"Approved by Commander":s==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",d={...t,currentStage:"BATTALION_REVIEW",routeSection:o||t.routeSection||"",commanderApprovalDate:s==="Approved"?new Date().toISOString():t.commanderApprovalDate,activity:Array.isArray(t.activity)?[...t.activity,{actor:a,timestamp:new Date().toISOString(),action:i,comment:(p[t.id]||"").trim(),fromSection:"Commander",toSection:o||t.routeSection||void 0}]:[{actor:a,timestamp:new Date().toISOString(),action:i,comment:(p[t.id]||"").trim(),fromSection:"Commander",toSection:o||t.routeSection||void 0}]};try{await T(d),g(l=>l.map(c=>c.id===d.id?d:c)),x(l=>({...l,[t.id]:""})),B(l=>({...l,[t.id]:""}))}catch(l){console.error("Failed to make commander decision:",l),q.error("Failed to record commander decision")}},le=async t=>{const s=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",a=ee(t),o=t.routeSection||"",i=`Returned to ${a||"Battalion"} by ${o||"Command Section"}`,d={...t,currentStage:"BATTALION_REVIEW",routeSection:a||t.routeSection||"",activity:Array.isArray(t.activity)?[...t.activity,{actor:s,timestamp:new Date().toISOString(),action:i,comment:(p[t.id]||"").trim(),fromSection:o||void 0,toSection:a||void 0}]:[{actor:s,timestamp:new Date().toISOString(),action:i,comment:(p[t.id]||"").trim(),fromSection:o||void 0,toSection:a||void 0}]};try{await T(d),g(l=>l.map(c=>c.id===d.id?d:c)),x(l=>({...l,[t.id]:""}))}catch(l){console.error("Failed to return from command section:",l),q.error("Failed to return from command section")}},te=async t=>{const s=$[t.id]||[];if(!s.length||!(e!=null&&e.id))return;const a=Date.now(),o=s.map((c,w)=>({id:`${a}-${w}`,name:c.name,type:c.type,size:c.size,uploadedAt:new Date().toISOString(),subject:t.subject,requestId:t.id,fileUrl:URL.createObjectURL(c)})),d={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${o.length} document(s)`,comment:(p[t.id]||"").trim()},l={...t,documentIds:[...t.documentIds||[],...o.map(c=>c.id)],activity:Array.isArray(t.activity)?[...t.activity,d]:[d]};try{await he(o),await T(l),R(c=>[...c,...o]),g(c=>c.map(w=>w.id===l.id?l:w)),S(c=>({...c,[t.id]:[]})),x(c=>({...c,[t.id]:""}))}catch(c){console.error("Failed to add files to request:",c),q.error("Failed to add files to request")}};return n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Command Sections Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(e==null?void 0:e.unitUic)||""}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ae,children:"Export All"})]})]}),n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ie,children:"Export Commander"})]}),n.jsx("div",{className:"mt-4",children:n.jsx(G,{title:"Pending",requests:z.filter(t=>t.currentStage!=="ARCHIVED"),users:C,onRowClick:t=>W(s=>({...s,[t.id]:!s[t.id]})),expandedRows:P,platoonSectionMap:r,children:t=>n.jsx(ge,{r:t,docsFor:_,expandedDocs:u,setExpandedDocs:v,setOpenDocsId:D,docsRef:L,comments:p,setComments:x,attach:$,setAttach:S,addFilesToRequest:te,selectedCommandSection:X,setSelectedCommandSection:B,commandSections:N,sendToCommandSection:ce,commanderDecision:re,expandedLogs:y,setExpandedLogs:j})})})]}),Object.keys(M).filter(t=>(M[t]||[]).length>0).map(t=>{const s=(M[t]||[]).filter(o=>o.currentStage!=="ARCHIVED"),a=(M[t]||[]).filter(o=>o.currentStage==="ARCHIVED");return n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:t}),n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>se(t),children:["Export ",t]})]}),s.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(G,{title:"Pending",requests:s,users:C,onRowClick:o=>W(i=>({...i,[o.id]:!i[o.id]})),expandedRows:P,platoonSectionMap:r,children:o=>n.jsx(ye,{r:o,docsFor:_,comments:p,setComments:x,attach:$,setAttach:S,addFilesToRequest:te,approveToCommander:de,commandSectionReturn:le})})}),a.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(G,{title:"Archived",requests:a,users:C,onRowClick:o=>W(i=>({...i,[o.id]:!i[o.id]})),expandedRows:P,platoonSectionMap:r,children:o=>n.jsxs("div",{id:`details-csec-archived-${o.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",o.finalStatus||"Archived"]}),n.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),n.jsxs("div",{children:[n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!u[o.id],"aria-controls":`docs-csec-archived-${o.id}`,onClick:()=>{v(i=>({...i,[o.id]:!i[o.id]})),D(i=>u[o.id]?null:o.id)},children:"Show Documents"}),n.jsx("div",{id:`docs-csec-archived-${o.id}`,className:`${u[o.id]?"mt-2 space-y-2":"hidden"}`,children:n.jsx(Q,{documents:_(o.id).map(i=>({...i,fileUrl:i.fileUrl}))})})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!y[o.id],"aria-controls":`logs-csec-archived-${o.id}`,onClick:()=>j(i=>({...i,[o.id]:!i[o.id]})),children:[y[o.id]?"Hide":"Show"," Full Activity Log"]}),n.jsx("div",{id:`logs-csec-archived-${o.id}`,className:y[o.id]?"mt-2 space-y-2":"hidden",children:o.activity&&o.activity.length?o.activity.map((i,d)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[i.actor," • ",new Date(i.timestamp).toLocaleString()," • ",i.action]}),i.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:i.comment})]},d)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},t)})]})]})})}export{ke as default};
