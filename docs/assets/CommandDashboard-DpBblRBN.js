import{r as m,j as n}from"./index-CWnyyP5W.js";import{l as le}from"./unitStructure-QC5qYuxv.js";import{w as me,c as ue,l as xe,e as be,u as F,f as pe}from"./db-CQ7ObEd-.js";import{R as J}from"./RequestTable-B1rDEPMu.js";import{U as ve}from"./units-CaNgy_2U.js";import{a as G,D as te}from"./DocumentListItem-B77xmDTw.js";const he=({r:e,docsFor:U,expandedDocs:b,setExpandedDocs:f,setOpenDocsId:k,docsRef:R,comments:C,setComments:O,attach:y,setAttach:S,addFilesToRequest:N,selectedCommandSection:g,setSelectedCommandSection:p,commandSections:x,sendToCommandSection:$,commanderDecision:j,expandedLogs:u,setExpandedLogs:v})=>{const[A,T]=m.useState(null),E=g[e.id]&&g[e.id]!=="NONE",D=U(e.id),L=()=>{const c=!!b[e.id];f(h=>({...h,[e.id]:!c})),k(c?null:e.id)};return n.jsxs("div",{id:`details-cmd-${e.id}`,children:[n.jsx("div",{className:"mt-3",children:n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!b[e.id],"aria-controls":`docs-cmd-${e.id}`,onClick:L,onKeyDown:c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),L())},children:[n.jsx("span",{children:"Show Documents"}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${b[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),n.jsx("div",{id:`docs-cmd-${e.id}`,ref:b[e.id]?R:void 0,className:`${b[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(G,{documents:D.map(c=>({...c,fileUrl:c.fileUrl})),showIcons:!0,onPreview:c=>T(D.find(h=>h.id===c.id)||null)})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:C[e.id]||"",onChange:c=>O(h=>({...h,[e.id]:c.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:c=>S(h=>({...h,[e.id]:c.target.files?Array.from(c.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(y[e.id]||[]).length?`${(y[e.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>N(e),disabled:!y[e.id]||!(y[e.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),n.jsxs("select",{value:g[e.id]||"NONE",onChange:c=>p(h=>({...h,[e.id]:c.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[n.jsx("option",{value:"NONE",children:"None - Make final decision below"}),x.map(c=>n.jsx("option",{value:c,children:c},c))]}),E?n.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',g[e.id],'" to route for their review']}):n.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),E&&n.jsx("div",{className:"mt-3 flex items-center justify-end",children:n.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>$(e),children:["Send to ",g[e.id]]})}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>j(e,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>j(e,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>j(e,"Rejected"),children:"Rejected"})]})]}),n.jsxs("div",{className:"mt-3",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>v(c=>({...c,[e.id]:!c[e.id]})),"aria-expanded":!!u[e.id],"aria-controls":`logs-cmd-${e.id}`,children:[u[e.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-cmd-${e.id}`,className:u[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((c,h)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[c.actor," • ",new Date(c.timestamp).toLocaleString()," • ",c.action]}),c.comment&&n.jsx("div",{className:"text-gray-600",children:c.comment})]},h)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),A&&n.jsx(te,{fileName:A.name,url:A.fileUrl||"",mimeType:A.type||"",fileSize:A.size||0,isOpen:!!A,onClose:()=>T(null)})]})},ge=({r:e,docsFor:U,comments:b,setComments:f,attach:k,setAttach:R,addFilesToRequest:C,approveToCommander:O,commandSectionReturn:y})=>{const[S,N]=m.useState(!1),[g,p]=m.useState(!1),[x,$]=m.useState(null),j=U(e.id);return n.jsxs("div",{id:`details-csec-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":S,"aria-controls":`docs-csec-${e.id}`,onClick:()=>N(!S),children:[n.jsxs("span",{children:[S?"Hide":"Show"," Documents (",j.length,")"]}),n.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${S?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:n.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),n.jsx("div",{id:`docs-csec-${e.id}`,className:`${S?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(G,{documents:j.map(u=>({...u,fileUrl:u.fileUrl})),showIcons:!0,onPreview:u=>$(j.find(v=>v.id===u.id)||null)})})]}),n.jsxs("div",{children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:b[e.id]||"",onChange:u=>f(v=>({...v,[e.id]:u.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 text-sm rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:u=>R(v=>({...v,[e.id]:u.target.files?Array.from(u.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(k[e.id]||[]).length?`${(k[e.id]||[]).length} file(s) selected`:"No files selected"}),(k[e.id]||[]).length>0&&n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>C(e),children:"Save Files"})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>p(!g),"aria-expanded":g,"aria-controls":`logs-csec-${e.id}`,children:[g?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-csec-${e.id}`,className:g?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((u,v)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[u.actor," • ",new Date(u.timestamp).toLocaleString()," • ",u.action]}),u.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:u.comment})]},v)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"pt-2 border-t border-brand-navy/10 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>O(e),children:"Approve to Commander"}),n.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>y(e),children:"Return to Battalion"})]}),x&&n.jsx(te,{fileName:x.name,url:x.fileUrl||"",mimeType:x.type||"",fileSize:x.size||0,isOpen:!!x,onClose:()=>$(null)})]})};function $e(){const[e,U]=m.useState(null),[b,f]=m.useState([]),[k,R]=m.useState([]),[C,O]=m.useState({}),[y,S]=m.useState({}),[N,g]=m.useState([]),[p,x]=m.useState({}),[$,j]=m.useState({}),[u,v]=m.useState({}),[A,T]=m.useState({}),[E,D]=m.useState(null),L=m.useRef(null),[c,h]=m.useState({}),[Q,V]=m.useState({}),[fe,X]=m.useState(null);m.useEffect(()=>{const t=a=>{E&&L.current&&!L.current.contains(a.target)&&(v(s=>({...s,[E]:!1})),D(null))},i=a=>{a.key==="Escape"&&E&&(v(s=>({...s,[E]:!1})),D(null))};return document.addEventListener("mousedown",t),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("keydown",i)}},[E]);const[B,P]=m.useState({});m.useEffect(()=>{try{const t=localStorage.getItem("currentUser");if(t){const i=JSON.parse(t);U(i)}}catch{}},[]),m.useEffect(()=>{e!=null&&e.installationId&&me().then(t=>{const i=t.find(a=>a.id===e.installationId);X(i||null)}).catch(()=>X(null))},[e]),m.useEffect(()=>{ue().then(t=>{f(t)}).catch(()=>f([]))},[]),m.useEffect(()=>{xe().then(t=>{R(t)}).catch(()=>R([]))},[]),m.useEffect(()=>{be().then(t=>{const i={};for(const a of t)a!=null&&a.id&&(i[a.id]=a);O(i)}).catch(()=>O({}))},[]);const q=()=>{if(e!=null&&e.unitUic)return e.unitUic;if(e!=null&&e.unit){const t=ve.find(i=>i.unitName===e.unit);if(t)return t.uic}return""};m.useEffect(()=>{try{const t=localStorage.getItem("unit_structure"),i=q();if(!i)return;const a=[],s={};if(t){const o=JSON.parse(t),d=o==null?void 0:o[i];d&&Array.isArray(d._commandSections)&&a.push(...d._commandSections);for(const l of Object.keys(o||{})){const r=o[l];r&&r._platoonSectionMap&&typeof r._platoonSectionMap=="object"&&(s[l]=r._platoonSectionMap)}g(a),h(s)}else(async()=>{try{const o=await le(),d=[],l={},r=o==null?void 0:o[i];r&&Array.isArray(r._commandSections)&&d.push(...r._commandSections);for(const w of Object.keys(o||{})){const I=o[w];I&&I._platoonSectionMap&&typeof I._platoonSectionMap=="object"&&(l[w]=I._platoonSectionMap)}g(d),h(l)}catch{}})()}catch{}},[e]);const _=t=>k.filter(i=>i.requestId===t),Y=t=>C[t.uploadedById]||null,Z=t=>{var d,l;if(t.routeSection)return t.routeSection;const i=t.unitUic||"",a=Y(t),s=a!=null&&a.company&&a.company!=="N/A"?a.company:"",o=a!=null&&a.unit&&a.unit!=="N/A"?a.unit:"";return((l=(d=c[i])==null?void 0:d[s])==null?void 0:l[o])||""},W=m.useMemo(()=>{const t=q();return b.filter(i=>{const a=i.currentStage||"",s=i.unitUic||"";return a==="COMMANDER_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(t?s===t:!0)})},[b,e,q]);m.useMemo(()=>{const t=(e==null?void 0:e.installationId)||"";return b.filter(i=>(i.currentStage||"")==="INSTALLATION_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(t?i.installationId===t:!0))},[b,e]);const M=m.useMemo(()=>{const t=q(),i={},a=o=>String(o||"").trim().toUpperCase(),s=N.map(o=>a(o));for(const o of N)i[o]=[];for(const o of b){const d=o.currentStage||"",l=o.unitUic||"",r=o.routeSection||"",w=a(r);if(d==="COMMANDER_REVIEW"&&r&&(!t||l===t)){const I=s.indexOf(w),K=I>=0?N[I]:r;i[K]||(i[K]=[]),i[K].push(o)}}return i},[b,N,e,q]),ne=t=>`"${String(t??"").replace(/"/g,'""')}"`,z=t=>{const a=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const s of t){const o=Y(s),d=o?`${o.rank} ${o.lastName}, ${o.firstName}${o.mi?` ${o.mi}`:""}`:"",l=_(s.id).map(r=>r.name).join(" | ");a.push([s.id,s.subject,s.currentStage||"",s.routeSection||"",d,s.unitUic||"",new Date(s.createdAt).toLocaleString(),l])}return a.map(s=>s.map(ne).join(",")).join(`\r
`)},H=(t,i)=>{const a=new Blob([i],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=t,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)},se=()=>H("commander.csv",z(W)),oe=t=>H(`${t}.csv`,z(M[t]||[])),ie=()=>H("command_all.csv",z([...W,...N.flatMap(t=>M[t]||[])])),ae=async t=>{const a={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(p[t.id]||"").trim()},s={...t,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:Array.isArray(t.activity)?[...t.activity,a]:[a]};try{await F(s),f(o=>o.map(d=>d.id===s.id?s:d)),x(o=>({...o,[t.id]:""}))}catch(o){console.error("Failed to approve request to commander:",o),alert("Failed to approve request to commander")}},de=async t=>{const i=Q[t.id]||"";if(!i||i==="NONE")return;const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",s=`Sent to ${i} for review by Commander`,o={...t,currentStage:"COMMANDER_REVIEW",routeSection:i,activity:Array.isArray(t.activity)?[...t.activity,{actor:a,timestamp:new Date().toISOString(),action:s,comment:(p[t.id]||"").trim()}]:[{actor:a,timestamp:new Date().toISOString(),action:s,comment:(p[t.id]||"").trim()}]};try{await F(o),f(d=>d.map(l=>l.id===o.id?o:l)),x(d=>({...d,[t.id]:""})),V(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to send to command section:",d),alert("Failed to send to command section")}},ce=async(t,i)=>{const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",s=Z(t),o=i==="Approved"?"Approved by Commander":i==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",d={...t,currentStage:"BATTALION_REVIEW",routeSection:s||t.routeSection||"",commanderApprovalDate:i==="Approved"?new Date().toISOString():t.commanderApprovalDate,activity:Array.isArray(t.activity)?[...t.activity,{actor:a,timestamp:new Date().toISOString(),action:o,comment:(p[t.id]||"").trim()}]:[{actor:a,timestamp:new Date().toISOString(),action:o,comment:(p[t.id]||"").trim()}]};try{await F(d),f(l=>l.map(r=>r.id===d.id?d:r)),x(l=>({...l,[t.id]:""})),V(l=>({...l,[t.id]:""}))}catch(l){console.error("Failed to make commander decision:",l),alert("Failed to record commander decision")}},re=async t=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",a=Z(t),s=`Returned to ${a||"Battalion"} by ${t.routeSection||"Command Section"}`,o={...t,currentStage:"BATTALION_REVIEW",routeSection:a||t.routeSection||"",activity:Array.isArray(t.activity)?[...t.activity,{actor:i,timestamp:new Date().toISOString(),action:s,comment:(p[t.id]||"").trim()}]:[{actor:i,timestamp:new Date().toISOString(),action:s,comment:(p[t.id]||"").trim()}]};try{await F(o),f(d=>d.map(l=>l.id===o.id?o:l)),x(d=>({...d,[t.id]:""}))}catch(d){console.error("Failed to return from command section:",d),alert("Failed to return from command section")}},ee=async t=>{const i=$[t.id]||[];if(!i.length||!(e!=null&&e.id))return;const a=Date.now(),s=i.map((r,w)=>({id:`${a}-${w}`,name:r.name,type:r.type,size:r.size,uploadedAt:new Date().toISOString(),subject:t.subject,requestId:t.id,fileUrl:URL.createObjectURL(r)})),d={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${s.length} document(s)`,comment:(p[t.id]||"").trim()},l={...t,documentIds:[...t.documentIds||[],...s.map(r=>r.id)],activity:Array.isArray(t.activity)?[...t.activity,d]:[d]};try{await pe(s),await F(l),R(r=>[...r,...s]),f(r=>r.map(w=>w.id===l.id?l:w)),j(r=>({...r,[t.id]:[]})),x(r=>({...r,[t.id]:""}))}catch(r){console.error("Failed to add files to request:",r),alert("Failed to add files to request")}};return n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Command Sections Dashboard"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(e==null?void 0:e.unitUic)||""}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ie,children:"Export All"})]})]}),n.jsxs("div",{className:"space-y-8",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:se,children:"Export Commander"})]}),n.jsx("div",{className:"mt-4",children:n.jsx(J,{title:"Pending",requests:W.filter(t=>t.currentStage!=="ARCHIVED"),users:C,onRowClick:t=>P(i=>({...i,[t.id]:!i[t.id]})),expandedRows:B,platoonSectionMap:c,children:t=>n.jsx(he,{r:t,docsFor:_,expandedDocs:u,setExpandedDocs:v,setOpenDocsId:D,docsRef:L,comments:p,setComments:x,attach:$,setAttach:j,addFilesToRequest:ee,selectedCommandSection:Q,setSelectedCommandSection:V,commandSections:N,sendToCommandSection:de,commanderDecision:ce,expandedLogs:y,setExpandedLogs:S})})})]}),Object.keys(M).filter(t=>(M[t]||[]).length>0).map(t=>{const i=(M[t]||[]).filter(s=>s.currentStage!=="ARCHIVED"),a=(M[t]||[]).filter(s=>s.currentStage==="ARCHIVED");return n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:t}),n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>oe(t),children:["Export ",t]})]}),i.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(J,{title:"Pending",requests:i,users:C,onRowClick:s=>P(o=>({...o,[s.id]:!o[s.id]})),expandedRows:B,platoonSectionMap:c,children:s=>n.jsx(ge,{r:s,docsFor:_,comments:p,setComments:x,attach:$,setAttach:j,addFilesToRequest:ee,approveToCommander:ae,commandSectionReturn:re})})}),a.length>0&&n.jsx("div",{className:"mt-4",children:n.jsx(J,{title:"Archived",requests:a,users:C,onRowClick:s=>P(o=>({...o,[s.id]:!o[s.id]})),expandedRows:B,platoonSectionMap:c,children:s=>n.jsxs("div",{id:`details-csec-archived-${s.id}`,className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{children:[n.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",s.finalStatus||"Archived"]}),n.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),n.jsxs("div",{children:[n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!u[s.id],"aria-controls":`docs-csec-archived-${s.id}`,onClick:()=>{v(o=>({...o,[s.id]:!o[s.id]})),D(o=>u[s.id]?null:s.id)},children:"Show Documents"}),n.jsx("div",{id:`docs-csec-archived-${s.id}`,className:`${u[s.id]?"mt-2 space-y-2":"hidden"}`,children:n.jsx(G,{documents:_(s.id).map(o=>({...o,fileUrl:o.fileUrl}))})})]}),n.jsxs("div",{children:[n.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!y[s.id],"aria-controls":`logs-csec-archived-${s.id}`,onClick:()=>S(o=>({...o,[s.id]:!o[s.id]})),children:[y[s.id]?"Hide":"Show"," Full Activity Log"]}),n.jsx("div",{id:`logs-csec-archived-${s.id}`,className:y[s.id]?"mt-2 space-y-2":"hidden",children:s.activity&&s.activity.length?s.activity.map((o,d)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[o.actor," • ",new Date(o.timestamp).toLocaleString()," • ",o.action]}),o.comment&&n.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:o.comment})]},d)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},t)})]})]})})}export{$e as default};
