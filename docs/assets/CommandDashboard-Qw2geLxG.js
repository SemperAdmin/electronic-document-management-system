import{r as m,j as t,u as me}from"./index-C0bR5ZwG.js";import{l as ue}from"./unitStructure-QC5qYuxv.js";import{w as xe,c as be,l as pe,e as ve,u as F,f as he}from"./db-CufQrlyf.js";import{R as G}from"./RequestTable-C-C4uZke.js";import{U as fe}from"./units-CaNgy_2U.js";import{a as Q,D as ne}from"./DocumentListItem-BBb5HwkD.js";const ge=({r:e,docsFor:U,expandedDocs:b,setExpandedDocs:g,setOpenDocsId:R,docsRef:k,comments:C,setComments:O,attach:y,setAttach:w,addFilesToRequest:j,selectedCommandSection:h,setSelectedCommandSection:S,commandSections:x,sendToCommandSection:$,commanderDecision:N,expandedLogs:u,setExpandedLogs:p})=>{const[D,V]=m.useState(null),E=h[e.id]&&h[e.id]!=="NONE",A=U(e.id),L=()=>{const r=!!b[e.id];g(v=>({...v,[e.id]:!r})),R(r?null:e.id)};return t.jsxs("div",{id:`details-cmd-${e.id}`,children:[t.jsx("div",{className:"mt-3",children:t.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!b[e.id],"aria-controls":`docs-cmd-${e.id}`,onClick:L,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),L())},children:[t.jsx("span",{children:"Show Documents"}),t.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${b[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:t.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),t.jsx("div",{id:`docs-cmd-${e.id}`,ref:b[e.id]?k:void 0,className:`${b[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:t.jsx(Q,{documents:A.map(r=>({...r,fileUrl:r.fileUrl})),showIcons:!0,onPreview:r=>V(A.find(v=>v.id===r.id)||null)})}),t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),t.jsx("textarea",{rows:2,value:C[e.id]||"",onChange:r=>O(v=>({...v,[e.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),t.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[t.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[t.jsx("input",{type:"file",multiple:!0,onChange:r=>w(v=>({...v,[e.id]:r.target.files?Array.from(r.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),t.jsx("span",{className:"text-xs text-[var(--muted)]",children:(y[e.id]||[]).length?`${(y[e.id]||[]).length} file(s) selected`:"No files selected"}),t.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>j(e),disabled:!y[e.id]||!(y[e.id]||[]).length,children:"Save Files"})]}),t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Route to Command Section for Review"}),t.jsxs("select",{value:h[e.id]||"NONE",onChange:r=>S(v=>({...v,[e.id]:r.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg",children:[t.jsx("option",{value:"NONE",children:"None - Make final decision below"}),x.map(r=>t.jsx("option",{value:r,children:r},r))]}),E?t.jsxs("p",{className:"text-xs text-[var(--muted)] mt-1",children:['Click "Send to ',h[e.id],'" to route for their review']}):t.jsx("p",{className:"text-xs text-[var(--muted)] mt-1",children:"Select a command section to get their input first, or make your final decision below"})]}),E&&t.jsx("div",{className:"mt-3 flex items-center justify-end",children:t.jsxs("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>$(e),children:["Send to ",h[e.id]]})}),t.jsxs("div",{className:"mt-3",children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),t.jsxs("div",{className:"flex items-center justify-end gap-2",children:[t.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>N(e,"Approved"),children:"Approved"}),t.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>N(e,"Endorsed"),children:"Endorsed"}),t.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>N(e,"Rejected"),children:"Rejected"})]})]}),t.jsxs("div",{className:"mt-3",children:[t.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>p(r=>({...r,[e.id]:!r[e.id]})),"aria-expanded":!!u[e.id],"aria-controls":`logs-cmd-${e.id}`,children:[u[e.id]?"Hide":"Show"," Activity Log"]}),t.jsx("div",{id:`logs-cmd-${e.id}`,className:u[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((r,v)=>t.jsxs("div",{className:"text-xs text-gray-700",children:[t.jsxs("div",{className:"font-medium",children:[r.actor," • ",new Date(r.timestamp).toLocaleString()," • ",r.action]}),r.comment&&t.jsx("div",{className:"text-gray-600",children:r.comment})]},v)):t.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),D&&t.jsx(ne,{fileName:D.name,url:D.fileUrl||"",mimeType:D.type||"",fileSize:D.size||0,isOpen:!!D,onClose:()=>V(null)})]})},ye=({r:e,docsFor:U,comments:b,setComments:g,attach:R,setAttach:k,addFilesToRequest:C,approveToCommander:O,commandSectionReturn:y})=>{const[w,j]=m.useState(!1),[h,S]=m.useState(!1),[x,$]=m.useState(null),N=U(e.id);return t.jsxs("div",{id:`details-csec-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[t.jsxs("div",{children:[t.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":w,"aria-controls":`docs-csec-${e.id}`,onClick:()=>j(!w),children:[t.jsxs("span",{children:[w?"Hide":"Show"," Documents (",N.length,")"]}),t.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${w?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:t.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]}),t.jsx("div",{id:`docs-csec-${e.id}`,className:`${w?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:t.jsx(Q,{documents:N.map(u=>({...u,fileUrl:u.fileUrl})),showIcons:!0,onPreview:u=>$(N.find(p=>p.id===u.id)||null)})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),t.jsx("textarea",{rows:2,value:b[e.id]||"",onChange:u=>g(p=>({...p,[e.id]:u.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 text-sm rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[t.jsx("input",{type:"file",multiple:!0,onChange:u=>k(p=>({...p,[e.id]:u.target.files?Array.from(u.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),t.jsx("span",{className:"text-xs text-[var(--muted)]",children:(R[e.id]||[]).length?`${(R[e.id]||[]).length} file(s) selected`:"No files selected"}),(R[e.id]||[]).length>0&&t.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>C(e),children:"Save Files"})]}),t.jsxs("div",{children:[t.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>S(!h),"aria-expanded":h,"aria-controls":`logs-csec-${e.id}`,children:[h?"Hide":"Show"," Activity Log"]}),t.jsx("div",{id:`logs-csec-${e.id}`,className:h?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((u,p)=>t.jsxs("div",{className:"text-xs text-gray-700",children:[t.jsxs("div",{className:"font-medium",children:[u.actor," • ",new Date(u.timestamp).toLocaleString()," • ",u.action]}),u.comment&&t.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:u.comment})]},p)):t.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),t.jsxs("div",{className:"pt-2 border-t border-brand-navy/10 flex items-center justify-end gap-2",children:[t.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>O(e),children:"Approve to Commander"}),t.jsx("button",{className:"px-4 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>y(e),children:"Return to Battalion"})]}),x&&t.jsx(ne,{fileName:x.name,url:x.fileUrl||"",mimeType:x.type||"",fileSize:x.size||0,isOpen:!!x,onClose:()=>$(null)})]})};function Re(){const[e,U]=m.useState(null),[b,g]=m.useState([]),[R,k]=m.useState([]),[C,O]=m.useState({}),[y,w]=m.useState({}),[j,h]=m.useState([]),[S,x]=m.useState({}),[$,N]=m.useState({}),[u,p]=m.useState({}),[D,V]=m.useState({}),[E,A]=m.useState(null),L=m.useRef(null),[r,v]=m.useState({}),[X,B]=m.useState({}),[je,Y]=m.useState(null),M=me();m.useEffect(()=>{const n=a=>{E&&L.current&&!L.current.contains(a.target)&&(p(o=>({...o,[E]:!1})),A(null))},i=a=>{a.key==="Escape"&&E&&(p(o=>({...o,[E]:!1})),A(null))};return document.addEventListener("mousedown",n),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",n),document.removeEventListener("keydown",i)}},[E]);const[P,W]=m.useState({});m.useEffect(()=>{try{const n=localStorage.getItem("currentUser");if(n){const i=JSON.parse(n);U(i)}}catch{}},[]),m.useEffect(()=>{e!=null&&e.installationId&&xe().then(n=>{const i=n.find(a=>a.id===e.installationId);Y(i||null)}).catch(()=>Y(null))},[e]),m.useEffect(()=>{be().then(n=>{g(n)}).catch(()=>g([]))},[]),m.useEffect(()=>{pe().then(n=>{k(n)}).catch(()=>k([]))},[]),m.useEffect(()=>{ve().then(n=>{const i={};for(const a of n)a!=null&&a.id&&(i[a.id]=a);O(i)}).catch(()=>O({}))},[]);const q=()=>{if(e!=null&&e.unitUic)return e.unitUic;if(e!=null&&e.unit){const n=fe.find(i=>i.unitName===e.unit);if(n)return n.uic}return""};m.useEffect(()=>{try{const n=localStorage.getItem("unit_structure"),i=q();if(!i)return;const a=[],o={};if(n){const s=JSON.parse(n),c=s==null?void 0:s[i];c&&Array.isArray(c._commandSections)&&a.push(...c._commandSections);for(const l of Object.keys(s||{})){const d=s[l];d&&d._platoonSectionMap&&typeof d._platoonSectionMap=="object"&&(o[l]=d._platoonSectionMap)}h(a),v(o)}else(async()=>{try{const s=await ue(),c=[],l={},d=s==null?void 0:s[i];d&&Array.isArray(d._commandSections)&&c.push(...d._commandSections);for(const f of Object.keys(s||{})){const I=s[f];I&&I._platoonSectionMap&&typeof I._platoonSectionMap=="object"&&(l[f]=I._platoonSectionMap)}h(c),v(l)}catch{}})()}catch{}},[e]);const T=n=>R.filter(i=>i.requestId===n),Z=n=>C[n.uploadedById]||null,ee=n=>{var c,l;if(n.routeSection)return n.routeSection;const i=n.unitUic||"",a=Z(n),o=a!=null&&a.company&&a.company!=="N/A"?a.company:"",s=a!=null&&a.unit&&a.unit!=="N/A"?a.unit:"";return((l=(c=r[i])==null?void 0:c[o])==null?void 0:l[s])||""},z=m.useMemo(()=>{const n=q();return b.filter(i=>{const a=i.currentStage||"",o=i.unitUic||"";return a==="COMMANDER_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(n?o===n:!0)})},[b,e,q]);m.useMemo(()=>{const n=(e==null?void 0:e.installationId)||"";return b.filter(i=>(i.currentStage||"")==="INSTALLATION_REVIEW"&&(!i.routeSection||i.routeSection==="")&&(n?i.installationId===n:!0))},[b,e]);const _=m.useMemo(()=>{const n=q(),i={},a=s=>String(s||"").trim().toUpperCase(),o=j.map(s=>a(s));for(const s of j)i[s]=[];for(const s of b){const c=s.currentStage||"",l=s.unitUic||"",d=s.routeSection||"",f=a(d);if(c==="COMMANDER_REVIEW"&&d&&(!n||l===n)){const I=o.indexOf(f),J=I>=0?j[I]:d;i[J]||(i[J]=[]),i[J].push(s)}}return i},[b,j,e,q]),oe=n=>`"${String(n??"").replace(/"/g,'""')}"`,H=n=>{const a=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const o of n){const s=Z(o),c=s?`${s.rank} ${s.lastName}, ${s.firstName}${s.mi?` ${s.mi}`:""}`:"",l=T(o.id).map(d=>d.name).join(" | ");a.push([o.id,o.subject,o.currentStage||"",o.routeSection||"",c,o.unitUic||"",new Date(o.createdAt).toLocaleString(),l])}return a.map(o=>o.map(oe).join(",")).join(`\r
`)},K=(n,i)=>{const a=new Blob([i],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(a),s=document.createElement("a");s.href=o,s.download=n,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)},se=()=>K("commander.csv",H(z)),ie=n=>K(`${n}.csv`,H(_[n]||[])),ae=()=>K("command_all.csv",H([...z,...j.flatMap(n=>_[n]||[])])),de=async n=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",a=n.routeSection||"",o={actor:i,timestamp:new Date().toISOString(),action:"Approved and routed to COMMANDER",comment:(S[n.id]||"").trim(),fromSection:a||void 0,toSection:"Commander"},s={...n,currentStage:"COMMANDER_REVIEW",routeSection:"",activity:[...n.activity||[],o]};try{await F(s),g(c=>c.map(l=>l.id===s.id?s:l)),x(c=>({...c,[n.id]:""}))}catch(c){console.error("Failed to approve request to commander:",c),M.error("Failed to approve request to commander")}},ce=async n=>{const i=X[n.id]||"";if(!i||i==="NONE")return;const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=`Sent to ${i} for review by Commander`,s={...n,currentStage:"COMMANDER_REVIEW",routeSection:i,activity:[...n.activity||[],{actor:a,timestamp:new Date().toISOString(),action:o,comment:(S[n.id]||"").trim(),fromSection:"Commander",toSection:i}]};try{await F(s),g(c=>c.map(l=>l.id===s.id?s:l)),x(c=>({...c,[n.id]:""})),B(c=>({...c,[n.id]:""}))}catch(c){console.error("Failed to send to command section:",c),M.error("Failed to send to command section")}},re=async(n,i)=>{const a=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Commander",o=ee(n),s=i==="Approved"?"Approved by Commander":i==="Endorsed"?"Endorsed by Commander":"Rejected by Commander — requires action",c={...n,currentStage:"BATTALION_REVIEW",routeSection:o||n.routeSection||"",commanderApprovalDate:i==="Approved"?new Date().toISOString():n.commanderApprovalDate,activity:[...n.activity||[],{actor:a,timestamp:new Date().toISOString(),action:s,comment:(S[n.id]||"").trim(),fromSection:"Commander",toSection:o||n.routeSection||void 0}]};try{await F(c),g(l=>l.map(d=>d.id===c.id?c:d)),x(l=>({...l,[n.id]:""})),B(l=>({...l,[n.id]:""}))}catch(l){console.error("Failed to make commander decision:",l),M.error("Failed to record commander decision")}},le=async n=>{const i=e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Command Section",a=ee(n),o=n.routeSection||"",s=`Returned to ${a||"Battalion"} by ${o||"Command Section"}`,c={actor:i,timestamp:new Date().toISOString(),action:s,comment:(S[n.id]||"").trim(),fromSection:o||void 0,toSection:a||void 0},l={...n,currentStage:"BATTALION_REVIEW",routeSection:a||n.routeSection||"",activity:[...n.activity||[],c]};try{await F(l),g(d=>d.map(f=>f.id===l.id?l:f)),x(d=>({...d,[n.id]:""}))}catch(d){console.error("Failed to return from command section:",d),M.error("Failed to return from command section")}},te=async n=>{const i=$[n.id]||[];if(!i.length||!(e!=null&&e.id))return;const a=Date.now(),o=i.map((d,f)=>({id:`${a}-${f}`,name:d.name,type:d.type,size:d.size,uploadedAt:new Date().toISOString(),subject:n.subject,requestId:n.id,fileUrl:URL.createObjectURL(d)})),c={actor:e?`${e.rank} ${e.lastName}, ${e.firstName}${e.mi?` ${e.mi}`:""}`:"Reviewer",timestamp:new Date().toISOString(),action:`Reviewer added ${o.length} document(s)`,comment:(S[n.id]||"").trim()},l={...n,documentIds:[...n.documentIds||[],...o.map(d=>d.id)],activity:[...n.activity||[],c]};try{await he(o),await F(l),k(d=>[...d,...o]),g(d=>d.map(f=>f.id===l.id?l:f)),N(d=>({...d,[n.id]:[]})),x(d=>({...d,[n.id]:""}))}catch(d){console.error("Failed to add files to request:",d),M.error("Failed to add files to request")}};return t.jsx("div",{className:"max-w-7xl mx-auto p-6",children:t.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Unit Command Dashboard"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:(e==null?void 0:e.unitUic)||""}),t.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ae,children:"Export All"})]})]}),t.jsxs("div",{className:"space-y-8",children:[t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Commander"}),t.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:se,children:"Export Commander"})]}),t.jsx("div",{className:"mt-4",children:t.jsx(G,{title:"Pending",requests:z.filter(n=>n.currentStage!=="ARCHIVED"),users:C,onRowClick:n=>W(i=>({...i,[n.id]:!i[n.id]})),expandedRows:P,platoonSectionMap:r,children:n=>t.jsx(ge,{r:n,docsFor:T,expandedDocs:u,setExpandedDocs:p,setOpenDocsId:A,docsRef:L,comments:S,setComments:x,attach:$,setAttach:N,addFilesToRequest:te,selectedCommandSection:X,setSelectedCommandSection:B,commandSections:j,sendToCommandSection:ce,commanderDecision:re,expandedLogs:y,setExpandedLogs:w})})})]}),j.map(n=>{const i=(_[n]||[]).filter(o=>o.currentStage!=="ARCHIVED"),a=(_[n]||[]).filter(o=>o.currentStage==="ARCHIVED");return t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-3",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:n}),t.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>ie(n),children:["Export ",n]})]}),t.jsx("div",{className:"mt-4",children:t.jsx(G,{title:"Pending",requests:i,users:C,onRowClick:o=>W(s=>({...s,[o.id]:!s[o.id]})),expandedRows:P,platoonSectionMap:r,children:o=>t.jsx(ye,{r:o,docsFor:T,comments:S,setComments:x,attach:$,setAttach:N,addFilesToRequest:te,approveToCommander:de,commandSectionReturn:le})})}),a.length>0&&t.jsx("div",{className:"mt-4",children:t.jsx(G,{title:"Archived",requests:a,users:C,onRowClick:o=>W(s=>({...s,[o.id]:!s[o.id]})),expandedRows:P,platoonSectionMap:r,children:o=>t.jsxs("div",{id:`details-csec-archived-${o.id}`,className:"p-4 bg-gray-50 space-y-3",children:[t.jsxs("div",{children:[t.jsxs("h4",{className:"font-medium text-gray-800",children:["Final Status: ",o.finalStatus||"Archived"]}),t.jsx("p",{className:"text-sm text-gray-600",children:"This request is archived and cannot be modified."})]}),t.jsxs("div",{children:[t.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!u[o.id],"aria-controls":`docs-csec-archived-${o.id}`,onClick:()=>{p(s=>({...s,[o.id]:!s[o.id]})),A(s=>u[o.id]?null:o.id)},children:"Show Documents"}),t.jsx("div",{id:`docs-csec-archived-${o.id}`,className:`${u[o.id]?"mt-2 space-y-2":"hidden"}`,children:t.jsx(Q,{documents:T(o.id).map(s=>({...s,fileUrl:s.fileUrl}))})})]}),t.jsxs("div",{children:[t.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!y[o.id],"aria-controls":`logs-csec-archived-${o.id}`,onClick:()=>w(s=>({...s,[o.id]:!s[o.id]})),children:[y[o.id]?"Hide":"Show"," Full Activity Log"]}),t.jsx("div",{id:`logs-csec-archived-${o.id}`,className:y[o.id]?"mt-2 space-y-2":"hidden",children:o.activity&&o.activity.length?o.activity.map((s,c)=>t.jsxs("div",{className:"text-xs text-gray-700",children:[t.jsxs("div",{className:"font-medium",children:[s.actor," • ",new Date(s.timestamp).toLocaleString()," • ",s.action]}),s.comment&&t.jsx("div",{className:"text-gray-600 pl-4 border-l-2 border-gray-300 ml-2",children:s.comment})]},c)):t.jsx("div",{className:"text-xs text-gray-500",children:"No activity to display."})})]})]})})})]},n)})]})]})})}export{Re as default};
