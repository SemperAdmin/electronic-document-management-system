import{r as i,j as a}from"./index-CQswcNA1.js";import{c as y,e as I,u as j}from"./db-KPPcCXsa.js";import{R}from"./RequestTable-DDxm-W0Q.js";function C(){const[t,m]=i.useState(null),[p,l]=i.useState([]),[f,d]=i.useState({}),[b,x]=i.useState({}),[r,c]=i.useState({});i.useEffect(()=>{try{const e=localStorage.getItem("currentUser");e&&m(JSON.parse(e))}catch{}},[]),i.useEffect(()=>{t!=null&&t.is_installation_admin&&(t!=null&&t.installationId)&&y().then(e=>{const s=e.filter(n=>n.installationId===t.installationId&&n.currentStage==="INSTALLATION_REVIEW");l(s)}).catch(()=>l([]))},[t]),i.useEffect(()=>{I().then(e=>{const s={};for(const n of e)s[n.id]=n;d(s)}).catch(()=>d({}))},[]);const u=async(e,s)=>{if(!t)return;const n=`${t.rank} ${t.lastName}, ${t.firstName}`,g=s==="Approved"?`Approved by Installation Admin at ${t.installationId}`:`Rejected by Installation Admin at ${t.installationId}`,h={...e,currentStage:"ARCHIVED",finalStatus:s,installationId:"",activity:[...e.activity||[],{actor:n,timestamp:new Date().toISOString(),action:g,comment:r[e.id]||""}]};try{await j(h),l(o=>o.filter(v=>v.id!==e.id)),c(o=>({...o,[e.id]:""}))}catch(o){console.error(`Failed to ${s.toLowerCase()} request:`,o)}};return a.jsx("div",{className:"max-w-7xl mx-auto p-6",children:a.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[a.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Installation Dashboard"}),a.jsx(R,{title:"Pending Installation Review",requests:p,users:f,onRowClick:e=>x(s=>({...s,[e.id]:!s[e.id]})),expandedRows:b,platoonSectionMap:{},children:e=>a.jsxs("div",{id:`details-iapp-${e.id}`,className:"p-4 bg-gray-50 space-y-3",children:[a.jsxs("div",{children:[a.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reviewer Comment"}),a.jsx("textarea",{rows:2,value:r[e.id]||"",onChange:s=>c(n=>({...n,[e.id]:s.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes for your decision"})]}),a.jsxs("div",{className:"flex items-center justify-end gap-2",children:[a.jsx("button",{className:"px-4 py-2 rounded bg-brand-red text-white font-medium hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-red",onClick:()=>u(e,"Rejected"),children:"Reject"}),a.jsx("button",{className:"px-4 py-2 rounded bg-brand-gold text-brand-charcoal font-medium hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>u(e,"Approved"),children:"Approve"})]})]})})]})})}export{C as default};
