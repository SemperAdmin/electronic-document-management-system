import{r as d,R as Ie,u as ke,j as n}from"./index-Cz_Ig0ZE.js";import{f as Re,l as De,z as Ae,h as Le,i as Ee,u as D}from"./db-DAOBmWXI.js";import{R as M}from"./RequestTable-Bj16YpMh.js";import{a as $e,D as Fe}from"./DocumentListItem-9Legh3iQ.js";import{f as A}from"./utils-CLmukD0c.js";function Ve(){const[l,oe]=d.useState(null),[b,h]=d.useState([]),[E,$]=d.useState({}),[m,U]=d.useState(null),[B,V]=d.useState([]),[y,F]=d.useState("Pending"),[ie,T]=d.useState([]),[j,_]=d.useState(""),[re,ce]=d.useState({}),[de,le]=d.useState({}),[f,S]=d.useState({}),[x,O]=d.useState({}),[g,W]=d.useState({}),[N,z]=d.useState({}),[Te,H]=d.useState(null),K=Ie.useRef(null),[Oe,me]=d.useState({}),[Q,ue]=d.useState({}),[P,J]=d.useState({}),[w,G]=d.useState(null),C=ke();d.useEffect(()=>{try{const e=localStorage.getItem("currentUser");e&&oe(JSON.parse(e))}catch{}},[]),d.useEffect(()=>{Re().then(e=>h(e)).catch(()=>h([])),De().then(e=>T(e)).catch(()=>T([]))},[]),d.useEffect(()=>{l!=null&&l.installationId&&(Ae().then(e=>{const t=e.find(s=>s.id===l.installationId);U(t||null)}).catch(()=>U(null)),Le().then(e=>V(e)).catch(()=>V([])))},[l]);const L=d.useMemo(()=>{const e={};for(const t of B)e[t.id]=t;return e},[B]),I=e=>ie.filter(t=>String(t.requestId||"")===String(e)),xe=e=>L[e.uploadedById],pe=e=>`"${String(e??"").replace(/"/g,'""')}"`,X=e=>{const s=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const a of e){const o=xe(a),r=o?`${o.rank||""} ${o.lastName||""}, ${o.firstName||""}${o.mi?` ${o.mi}`:""}`.trim():"",i=I(a.id).map(c=>c.name).join(" | ");s.push([a.id,a.subject,a.currentStage||"",a.routeSection||"",r,a.unitUic||"",new Date(a.createdAt).toLocaleString(),i])}return s.map(a=>a.map(pe).join(",")).join(`\r
`)},Z=(e,t)=>{const s=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(a)},be=()=>Z("installation_commander.csv",X(te)),ge=e=>Z(`installation_${e}.csv`,X(ee[e]||[])),q=async e=>{const t=x[e.id]||[];if(!t.length)return;const s=(l==null?void 0:l.id)||"",a=e.unitUic||"",o=t.map(i=>({id:`doc-${Date.now()}-${Math.random().toString(16).slice(2)}`,name:i.name,type:i.type||"application/octet-stream",size:i.size,uploadedAt:new Date,category:"ATTACHMENT",tags:[],unitUic:a,subject:e.subject,notes:f[e.id]||void 0,uploadedById:s,currentStage:e.currentStage,requestId:e.id,fileUrl:void 0})),{ok:r}=await Ee(o);r?(T(i=>[...o,...i]),O(i=>({...i,[e.id]:[]}))):C.error("Failed to save files")},he=async e=>{const t=A(l,"Installation Command Section"),s=e.routeSection||"",a={actor:t,timestamp:new Date().toISOString(),action:"Sent to Installation Commander",comment:(f[e.id]||"").trim(),fromSection:s||void 0,toSection:"Commander"},o={...e,routeSection:"",activity:[...e.activity||[],a]};try{await D(o),h(r=>r.map(i=>i.id===e.id?o:i)),S(r=>({...r,[e.id]:""}))}catch(r){console.error("Failed to send to installation commander:",r),C.error("Failed to send to installation commander")}},fe=async e=>{const t=A(l,"Installation Command Section"),s=(e.activity||[]).slice().reverse().find(i=>/Routed to installation command section/i.test(String(i.action||"")));let a="";if(s){const i=String(s.action||"").match(/\(from\s+(.+?)\)/i);i&&(a=i[1])}const o={actor:t,timestamp:new Date().toISOString(),action:`Returned to installation section${a?`: ${a}`:""}`,comment:(f[e.id]||"").trim(),fromSection:e.routeSection||void 0,toSection:a||void 0},r={...e,routeSection:a,activity:[...e.activity||[],o]};try{await D(r),h(i=>i.map(c=>c.id===e.id?r:c)),S(i=>({...i,[e.id]:""}))}catch(i){console.error("Failed to return to installation section:",i),C.error("Failed to return to installation section")}},Y=async(e,t)=>{const s=A(l,"Installation Commander"),a=t==="Approved"?"Approved by Installation Commander":t==="Endorsed"?"Endorsed by Installation Commander":"Rejected by Installation Commander — requires action",o=we(e);let r={...e};const i={actor:s,actorRole:"Installation Commander",timestamp:new Date().toISOString(),action:a,comment:(f[e.id]||"").trim(),fromSection:"Commander",toSection:o||void 0};if(t==="Rejected")r={...e,currentStage:"INSTALLATION_REVIEW",finalStatus:void 0,routeSection:o,activity:[...e.activity||[],i,{actor:s,actorRole:"Installation Commander",timestamp:new Date().toISOString(),action:o?`Returned to installation section: ${o}`:"Returned for review",fromSection:"Commander",toSection:o||void 0}]};else if(t==="Approved"){const c=o;r={...e,currentStage:"INSTALLATION_REVIEW",routeSection:c,activity:[...e.activity||[],i,{actor:s,actorRole:"Installation Commander",timestamp:new Date().toISOString(),action:c?`Sent to installation section: ${c}`:"Sent for further routing",fromSection:"Commander",toSection:c||void 0}]}}else r={...e,currentStage:"INSTALLATION_REVIEW",routeSection:o,activity:[...e.activity||[],i,{actor:s,actorRole:"Installation Commander",timestamp:new Date().toISOString(),action:o?`Sent to installation section: ${o}`:"Sent for further routing",fromSection:"Commander",toSection:o||void 0}]};try{await D(r),h(c=>c.map(v=>v.id===e.id?r:v)),S(c=>({...c,[e.id]:""})),me(c=>({...c,[e.id]:""}))}catch(c){console.error("Failed to record installation commander decision:",c),C.error("Failed to record decision")}},ve=async e=>{const t=P[e.id]||"";if(!t.trim())return;const s=A(l,"Installation Command Section"),a=e.routeSection||"",o={actor:s,actorRole:"Installation Command Section",timestamp:new Date().toISOString(),action:`Reassigned to command section: ${t}${a?` (from ${a})`:""}`,comment:(f[e.id]||"").trim(),fromSection:a||void 0,toSection:t},r={...e,routeSection:t,activity:[...e.activity||[],o]};try{await D(r),h(i=>i.map(c=>c.id===e.id?r:c)),S(i=>({...i,[e.id]:""})),J(i=>({...i,[e.id]:""}))}catch(i){console.error("Failed to reassign to command section:",i),C.error("Failed to reassign to command section")}},k=d.useMemo(()=>Array.isArray(m==null?void 0:m.commandSections)?m.commandSections:[],[m]),p=(l==null?void 0:l.installationId)||"",ee=d.useMemo(()=>{const e={},t=b.filter(s=>s.currentStage==="INSTALLATION_REVIEW"&&s.installationId===p);for(const s of k)e[s]=[];for(const s of t){const a=String(s.routeSection||"");a&&e.hasOwnProperty(a)&&e[a].push(s)}return e},[b,k,p]),te=d.useMemo(()=>b.filter(e=>e.currentStage==="INSTALLATION_REVIEW"&&e.installationId===p&&(!e.routeSection||e.routeSection==="")),[b,p]),ye=d.useMemo(()=>b.filter(e=>e.installationId===p&&e.currentStage!=="INSTALLATION_REVIEW"),[b,p]),ne=d.useCallback(e=>{if(e.isPermanent)return"Permanent";if(!e.retentionValue||!e.cutoffTrigger||!e.filedAt)return"Unknown";const t=new Date(e.filedAt);let s;switch(e.cutoffTrigger){case"CALENDAR_YEAR":s=new Date(t.getFullYear(),11,31);break;case"FISCAL_YEAR":s=t.getMonth()>=9?new Date(t.getFullYear()+1,8,30):new Date(t.getFullYear(),8,30);break;default:s=t}const a=new Date(s),o=(e.retentionUnit||"").toLowerCase();return o==="years"?a.setFullYear(a.getFullYear()+e.retentionValue):o==="months"?a.setMonth(a.getMonth()+e.retentionValue):o==="days"&&a.setDate(a.getDate()+e.retentionValue),a.getFullYear().toString()},[]),je=d.useCallback(e=>{if(!e.retentionValue||!e.cutoffTrigger||!e.filedAt)return"N/A";if(e.isPermanent)return"Permanent";const t=new Date(e.filedAt);let s;switch(e.cutoffTrigger){case"CALENDAR_YEAR":s=new Date(t.getFullYear(),11,31);break;case"FISCAL_YEAR":s=t.getMonth()>=9?new Date(t.getFullYear()+1,8,30):new Date(t.getFullYear(),8,30);break;default:s=t}const a=new Date(s),o=(e.retentionUnit||"").toLowerCase();return o==="years"?a.setFullYear(a.getFullYear()+e.retentionValue):o==="months"?a.setMonth(a.getMonth()+e.retentionValue):o==="days"&&a.setDate(a.getDate()+e.retentionValue),a.toLocaleDateString()},[]),R=d.useMemo(()=>{let e=b.filter(s=>!(!s.filedAt||p&&s.installationId!==p));if(j.trim()){const s=j.toLowerCase().trim();e=e.filter(a=>{var o,r,i,c;return((o=a.subject)==null?void 0:o.toLowerCase().includes(s))||((r=a.ssic)==null?void 0:r.toLowerCase().includes(s))||((i=a.ssicNomenclature)==null?void 0:i.toLowerCase().includes(s))||((c=a.ssicBucketTitle)==null?void 0:c.toLowerCase().includes(s))})}const t={};for(const s of e){const a=ne(s),o=s.ssicBucketTitle||s.ssicBucket||"Uncategorized";t[a]||(t[a]={}),t[a][o]||(t[a][o]=[]),t[a][o].push(s)}for(const s of Object.keys(t))for(const a of Object.keys(t[s]))t[s][a].sort((o,r)=>new Date(r.createdAt).getTime()-new Date(o.createdAt).getTime());return t},[b,p,j,ne]),se=d.useMemo(()=>Object.keys(R).sort((e,t)=>e==="Permanent"?1:t==="Permanent"?-1:e==="Unknown"?1:t==="Unknown"?-1:parseInt(e)-parseInt(t)),[R]),Se=d.useMemo(()=>Object.values(R).reduce((e,t)=>e+Object.values(t).reduce((s,a)=>s+a.length,0),0),[R]),Ne=e=>{const t=(e.activity||[]).slice().reverse();for(const s of t){const a=String(s.action||""),o=a.match(/Sent to installation section:\s*(.+)/i)||a.match(/Restored to installation section:\s*(.+)/i)||a.match(/Returned to installation section:\s*(.+)/i);if(o)return o[1].trim()}return""},we=e=>{const t=(e.activity||[]).slice().reverse();for(const s of t){const a=String(s.action||""),o=a.match(/Approved and routed to Installation Command:[^(]+\(from\s+([^)]+)\)/i);if(o)return o[1].trim();const r=a.match(/Reassigned to installation section:\s*([^\(]+)/i);if(r)return r[1].trim();const i=a.match(/Sent to command section:[^(]+\(from\s+([^)]+)\)/i);if(i)return i[1].trim()}for(const s of t){const a=String(s.action||""),o=a.match(/Routed to installation section:\s*(.+)/i);if(o)return o[1].trim();const r=a.match(/Sent to installation section:\s*(.+)/i);if(r)return r[1].trim();const i=a.match(/Restored to installation section:\s*(.+)/i);if(i)return i[1].trim()}return""},Ce=async(e,t)=>{const s=A(l,"Installation Commander"),a=(t||"").trim()||Ne(e),o={actor:s,timestamp:new Date().toISOString(),action:`Restored to installation section${a?`: ${a}`:""}`},r={...e,currentStage:"INSTALLATION_REVIEW",finalStatus:void 0,routeSection:a,activity:[...e.activity||[],o]};try{await D(r),h(i=>i.map(c=>c.id===e.id?r:c))}catch(i){console.error("Failed to restore to installation section:",i),C.error("Failed to restore to installation section")}};return n.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Installation Command Dashboard"}),n.jsx("div",{className:"text-sm text-[var(--muted)]",children:(m==null?void 0:m.name)||""})]}),n.jsx("div",{className:"border-b border-gray-200 mb-4",children:n.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[n.jsx("button",{onClick:()=>F("Pending"),className:`${y==="Pending"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm`,children:"Pending"}),n.jsx("button",{onClick:()=>F("Previously in Command Section"),className:`${y==="Previously in Command Section"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm`,children:"Previously in Command Section"}),n.jsxs("button",{onClick:()=>F("Files"),className:`${y==="Files"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm`,children:["Files (",Se,")"]})]})}),y==="Pending"&&n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{children:n.jsx(M,{title:"Pending in Commander",titleActions:n.jsx(n.Fragment,{children:n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:be,children:"Export Commander"})}),requests:te,users:L,variant:"installation",onRowClick:e=>$(t=>({...t,[e.id]:!t[e.id]})),expandedRows:E,children:e=>n.jsxs("div",{className:"p-4 bg-gray-50 space-y-3",children:[n.jsx("div",{className:"mt-2",children:n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!g[e.id],"aria-controls":`docs-instcmd-comm-${e.id}`,onClick:()=>{W(t=>({...t,[e.id]:!t[e.id]})),H(t=>g[e.id]?null:e.id)},children:n.jsx("span",{children:"Show Documents"})})}),n.jsx("div",{id:`docs-instcmd-comm-${e.id}`,ref:g[e.id]?K:void 0,className:`${g[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx($e,{documents:I(e.id),showIcons:!0,onPreview:t=>G(I(e.id).find(s=>s.id===t.id)||null)})}),n.jsxs("div",{className:"mt-2",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>z(t=>({...t,[e.id]:!t[e.id]})),"aria-expanded":!!N[e.id],"aria-controls":`logs-instcmd-comm-${e.id}`,children:[N[e.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-instcmd-comm-${e.id}`,className:N[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((t,s)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[t.actor," • ",new Date(t.timestamp).toLocaleString()," • ",t.action]}),t.comment&&n.jsx("div",{className:"text-gray-600",children:t.comment})]},s)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:f[e.id]||"",onChange:t=>S(s=>({...s,[e.id]:t.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:t=>O(s=>({...s,[e.id]:t.target.files?Array.from(t.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(x[e.id]||[]).length?`${(x[e.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>q(e),disabled:!x[e.id]||!(x[e.id]||[]).length,children:"Save Files"})]}),n.jsx("div",{className:"mt-3"}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>Y(e,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>Y(e,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>Y(e,"Rejected"),children:"Rejected"})]})]})]})})}),k.map(e=>n.jsxs("div",{children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] flex items-center justify-between w-full",children:[e,n.jsx("span",{className:"inline-flex items-center gap-2 align-middle",children:n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>ge(e),children:["Export ",e]})})]})}),n.jsx(M,{title:`Pending in ${e}`,requests:ee[e]||[],users:L,variant:"installation",onRowClick:t=>$(s=>({...s,[t.id]:!s[t.id]})),expandedRows:E,children:t=>n.jsxs("div",{className:"p-4 bg-gray-50 space-y-3",children:[n.jsx("div",{className:"mt-2",children:n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!g[t.id],"aria-controls":`docs-instcmd-${t.id}`,onClick:()=>{W(s=>({...s,[t.id]:!s[t.id]})),H(s=>g[t.id]?null:t.id)},children:n.jsx("span",{children:"Show Documents"})})}),n.jsxs("div",{id:`docs-instcmd-${t.id}`,ref:g[t.id]?K:void 0,className:`${g[t.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:[I(t.id).map(s=>n.jsxs("div",{className:"flex items-center justify-between p-3 border border-brand-navy/20 rounded-lg bg-[var(--surface)]",children:[n.jsxs("div",{className:"text-sm text-[var(--muted)]",children:[n.jsx("div",{className:"font-medium text-[var(--text)]",children:s.name}),n.jsx("div",{children:new Date(s.uploadedAt).toLocaleDateString()})]}),n.jsx("div",{className:"flex items-center gap-2",children:s.fileUrl?n.jsx("a",{href:s.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",children:"Open"}):n.jsx("span",{className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded opacity-60","aria-disabled":"true",children:"Open"})})]},s.id)),I(t.id).length===0&&n.jsx("div",{className:"text-sm text-[var(--muted)]",children:"No documents"})]}),n.jsxs("div",{className:"mt-2",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>z(s=>({...s,[t.id]:!s[t.id]})),"aria-expanded":!!N[t.id],"aria-controls":`logs-instcmd-${t.id}`,children:[N[t.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-instcmd-${t.id}`,className:N[t.id]?"mt-2 space-y-2":"hidden",children:t.activity&&t.activity.length?t.activity.map((s,a)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[s.actor," • ",new Date(s.timestamp).toLocaleString()," • ",s.action]}),s.comment&&n.jsx("div",{className:"text-gray-600",children:s.comment})]},a)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:f[t.id]||"",onChange:s=>S(a=>({...a,[t.id]:s.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),k.filter(s=>s!==e).length>0&&n.jsxs("div",{className:"mt-3 p-3 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Reassign to Another Command Section"}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("select",{className:"px-3 py-2 border border-brand-navy/30 rounded-lg flex-1",value:P[t.id]||"",onChange:s=>J(a=>({...a,[t.id]:s.target.value})),children:[n.jsx("option",{value:"",children:"Select command section"}),k.filter(s=>s!==e).map(s=>n.jsx("option",{value:s,children:s},s))]}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>ve(t),disabled:!(P[t.id]||"").trim(),children:"Reassign"})]})]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:s=>O(a=>({...a,[t.id]:s.target.files?Array.from(s.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(x[t.id]||[]).length?`${(x[t.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>q(t),disabled:!x[t.id]||!(x[t.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>he(t),children:"Send to Commander"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>fe(t),children:"Return to Section"})]})]})})]},e))]}),y==="Previously in Command Section"&&n.jsx(M,{title:"Previously in Command Section",requests:ye,users:L,variant:"installation",onRowClick:e=>$(t=>({...t,[e.id]:!t[e.id]})),expandedRows:E,children:e=>n.jsxs("div",{className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{className:"text-xs text-gray-600",children:["Last Status: ",new Date(e.activity&&e.activity.length?e.activity[e.activity.length-1].timestamp:e.createdAt).toLocaleString()]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("select",{className:"px-3 py-2 border border-brand-navy/30 rounded-lg",value:Q[e.id]||"",onChange:t=>ue(s=>({...s,[e.id]:t.target.value})),children:[n.jsx("option",{value:"",children:"Select installation section"}),((m==null?void 0:m.sections)||[]).map(t=>n.jsx("option",{value:t,children:t},t))]}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2",onClick:()=>Ce(e,Q[e.id]),children:"Restore to Section"})]})]})}),y==="Files"&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx("input",{type:"text",placeholder:"Search files by subject, SSIC, category...",value:j,onChange:e=>_(e.target.value),className:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold focus:border-transparent"}),n.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),j&&n.jsx("button",{onClick:()=>_(""),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600",children:n.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),se.length===0?n.jsx("div",{className:"text-center py-8 text-gray-500",children:j?"No records match your search.":"No filed records."}):n.jsx("div",{className:"space-y-2",children:se.map(e=>{const t=R[e],s=Object.keys(t).sort(),a=e==="Permanent",o=Object.values(t).reduce((i,c)=>i+c.length,0),r=re[e]||!1;return n.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden",children:[n.jsxs("button",{onClick:()=>ce(i=>({...i,[e]:!i[e]})),className:`w-full ${a?"bg-blue-800 hover:bg-blue-700":"bg-brand-navy hover:bg-brand-navy/90"} text-brand-cream px-4 py-3 font-medium flex items-center justify-between transition-colors`,children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("svg",{className:`w-4 h-4 transition-transform flex-shrink-0 ${r?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),n.jsx("span",{className:"truncate",children:a?"Permanent Records":`Disposal Year: ${e}`})]}),n.jsxs("span",{className:"text-xs bg-white/20 px-2 py-0.5 rounded flex-shrink-0 ml-2",children:[o," record",o!==1?"s":""]})]}),r&&n.jsx("div",{className:"bg-gray-50 p-2 space-y-2",children:s.map(i=>{const c=t[i],v=`${e}-${i}`,ae=de[v]||!1;return n.jsxs("div",{className:"border border-gray-200 rounded-lg overflow-hidden bg-white",children:[n.jsxs("button",{onClick:()=>le(u=>({...u,[v]:!u[v]})),className:"w-full bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 font-medium text-sm flex items-center justify-between transition-colors",children:[n.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[n.jsx("svg",{className:`w-3 h-3 transition-transform flex-shrink-0 ${ae?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:n.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),n.jsx("span",{className:"truncate",children:i})]}),n.jsxs("span",{className:"text-xs text-gray-500 flex-shrink-0 ml-2",children:[c.length," item",c.length!==1?"s":""]})]}),ae&&n.jsx("div",{className:"overflow-x-auto",children:n.jsxs("table",{className:"min-w-full divide-y divide-gray-200 text-sm",children:[n.jsx("thead",{className:"bg-gray-50",children:n.jsxs("tr",{children:[n.jsx("th",{className:"px-2 sm:px-3 py-2 text-left font-medium text-gray-500 text-xs sm:text-sm",children:"Name"}),n.jsx("th",{className:"px-2 sm:px-3 py-2 text-left font-medium text-gray-500 text-xs sm:text-sm",children:"SSIC"}),n.jsx("th",{className:"px-2 sm:px-3 py-2 text-left font-medium text-gray-500 text-xs sm:text-sm",children:"Retention"}),n.jsx("th",{className:"px-2 sm:px-3 py-2 text-left font-medium text-gray-500 text-xs sm:text-sm hidden sm:table-cell",children:"Disposal Date"})]})}),n.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:c.map(u=>n.jsxs("tr",{className:"hover:bg-gray-50",children:[n.jsx("td",{className:"px-2 sm:px-3 py-2 font-medium text-brand-navy text-xs sm:text-sm max-w-[120px] sm:max-w-none truncate",children:u.subject}),n.jsx("td",{className:"px-2 sm:px-3 py-2 text-xs sm:text-sm",children:u.ssic}),n.jsx("td",{className:"px-2 sm:px-3 py-2",children:u.isPermanent?n.jsx("span",{className:"inline-flex px-1.5 sm:px-2 py-0.5 text-xs font-medium bg-blue-100 text-blue-800 rounded whitespace-nowrap",children:"Perm"}):n.jsxs("span",{className:"inline-flex px-1.5 sm:px-2 py-0.5 text-xs font-medium bg-amber-100 text-amber-800 rounded whitespace-nowrap",children:[u.retentionValue," ",(u.retentionUnit||"").replace("S","")]})}),n.jsx("td",{className:"px-2 sm:px-3 py-2 text-xs sm:text-sm hidden sm:table-cell",children:je(u)})]},u.id))})]})})]},v)})})]},e)})})]})]}),w&&n.jsx(Fe,{fileName:w.name,url:w.fileUrl||"",mimeType:w.type||"",fileSize:w.size||0,isOpen:!!w,onClose:()=>G(null)})]})}export{Ve as default};
