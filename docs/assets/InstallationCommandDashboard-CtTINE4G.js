import{r as c,R as $e,j as n}from"./index-MTHe0j9m.js";import{c as Re,l as Ee,w as ke,e as Ae,k as De,p as Le,f as Te,u as N}from"./db-CTrWqmZ5.js";import{S as Oe}from"./SearchableUnitSelector-XgY2Hjyk.js";import{R as H}from"./RequestTable-DHDltpGF.js";import{a as Fe}from"./DocumentListItem-Dq6WnYYr.js";import"./units-CaNgy_2U.js";function Be(){const[o,le]=c.useState(null),[h,p]=c.useState([]),[$,R]=c.useState({}),[m,P]=c.useState(null),[q,V]=c.useState([]),[C,Q]=c.useState("Pending"),[re,E]=c.useState([]),[u,g]=c.useState({}),[x,k]=c.useState({}),[b,W]=c.useState({}),[v,B]=c.useState({}),[_e,U]=c.useState(null),z=$e.useRef(null),[me,Me]=c.useState({}),[J,xe]=c.useState({}),[A,X]=c.useState({}),[G,K]=c.useState({}),[Y,Z]=c.useState({}),[ee,D]=c.useState({}),[S,L]=c.useState({}),[f,T]=c.useState({}),[ue,te]=c.useState([]),[be,ne]=c.useState([]),[j,pe]=c.useState({}),[O,ae]=c.useState({});c.useEffect(()=>{try{const e=localStorage.getItem("currentUser");e&&le(JSON.parse(e))}catch{}},[]),c.useEffect(()=>{Re().then(e=>p(e)).catch(()=>p([])),Ee().then(e=>E(e)).catch(()=>E([]))},[]),c.useEffect(()=>{o!=null&&o.installationId&&(ke().then(e=>{const t=e.find(a=>a.id===o.installationId);P(t||null)}).catch(()=>P(null)),Ae().then(e=>V(e)).catch(()=>V([])))},[o]),c.useEffect(()=>{De().then(te).catch(()=>te([])),Le().then(ne).catch(()=>ne([]))},[]);const w=c.useMemo(()=>{const e={};for(const t of q)e[t.id]=t;return e},[q]),I=e=>re.filter(t=>String(t.requestId||"")===String(e)),he=e=>w[e.uploadedById],ge=e=>`"${String(e??"").replace(/"/g,'""')}"`,ie=e=>{const a=[["Request ID","Subject","Stage","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const i of e){const s=he(i),l=s?`${s.rank||""} ${s.lastName||""}, ${s.firstName||""}${s.mi?` ${s.mi}`:""}`.trim():"",d=I(i.id).map(r=>r.name).join(" | ");a.push([i.id,i.subject,i.currentStage||"",i.routeSection||"",l,i.unitUic||"",new Date(i.createdAt).toLocaleString(),d])}return a.map(i=>i.map(ge).join(",")).join(`\r
`)},se=(e,t)=>{const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(a),s=document.createElement("a");s.href=i,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(i)},ve=()=>se("installation_commander.csv",ie(ce)),ye=e=>se(`installation_${e}.csv`,ie(de[e]||[])),oe=async e=>{const t=x[e.id]||[];if(!t.length)return;const a=(o==null?void 0:o.id)||"",i=e.unitUic||"",s=t.map(d=>({id:`doc-${Date.now()}-${Math.random().toString(16).slice(2)}`,name:d.name,type:d.type||"application/octet-stream",size:d.size,uploadedAt:new Date,category:"ATTACHMENT",tags:[],unitUic:i,subject:e.subject,notes:u[e.id]||void 0,uploadedById:a,currentStage:e.currentStage,requestId:e.id,fileUrl:void 0})),{ok:l}=await Te(s);l?(E(d=>[...s,...d]),k(d=>({...d,[e.id]:[]}))):alert("Failed to save files")},Se=async e=>{const a={actor:`${(o==null?void 0:o.rank)||""} ${(o==null?void 0:o.lastName)||""}, ${(o==null?void 0:o.firstName)||""}`.trim()||"Installation Command Section",timestamp:new Date().toISOString(),action:"Sent to Installation Commander",comment:(u[e.id]||"").trim()},i={...e,routeSection:"",activity:[...e.activity||[],a]};try{await N(i),p(s=>s.map(l=>l.id===e.id?i:l)),g(s=>({...s,[e.id]:""}))}catch(s){console.error("Failed to send to installation commander:",s),alert("Failed to send to installation commander")}},fe=async e=>{const t=`${(o==null?void 0:o.rank)||""} ${(o==null?void 0:o.lastName)||""}, ${(o==null?void 0:o.firstName)||""}`.trim()||"Installation Command Section",a=(e.activity||[]).slice().reverse().find(d=>/Routed to installation command section/i.test(String(d.action||"")));let i="";if(a){const d=String(a.action||"").match(/\(from\s+(.+?)\)/i);d&&(i=d[1])}const s={actor:t,timestamp:new Date().toISOString(),action:`Returned to installation section${i?`: ${i}`:""}`,comment:(u[e.id]||"").trim()},l={...e,routeSection:i,activity:[...e.activity||[],s]};try{await N(l),p(d=>d.map(r=>r.id===e.id?l:r)),g(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to return to installation section:",d),alert("Failed to return to installation section")}},F=async(e,t)=>{const a=`${(o==null?void 0:o.rank)||""} ${(o==null?void 0:o.lastName)||""}, ${(o==null?void 0:o.firstName)||""}`.trim()||"Installation Commander",i=t==="Approved"?"Approved by Installation Commander":t==="Endorsed"?"Endorsed by Installation Commander":"Rejected by Installation Commander — requires action";let s={...e};const l={actor:a,timestamp:new Date().toISOString(),action:i,comment:(u[e.id]||"").trim()};if(t==="Rejected"){const d=M(e);s={...e,currentStage:"INSTALLATION_REVIEW",finalStatus:void 0,routeSection:d,activity:[...e.activity||[],l,{actor:a,timestamp:new Date().toISOString(),action:d?`Returned to installation section: ${d}`:"Returned to installation commander"}]}}else if(t==="Approved"){const d=me[e.id]||"";if(!d.trim()){alert("Select a command section to send to");return}s={...e,currentStage:"INSTALLATION_REVIEW",routeSection:d,activity:[...e.activity||[],l,{actor:a,timestamp:new Date().toISOString(),action:`Sent to installation section: ${d}`}]}}else{const d=M(e);s={...e,currentStage:"INSTALLATION_REVIEW",routeSection:d,activity:[...e.activity||[],l,{actor:a,timestamp:new Date().toISOString(),action:d?`Sent to installation section: ${d}`:"Returned to installation commander"}]}}try{await N(s),p(d=>d.map(r=>r.id===e.id?s:r)),g(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to record installation commander decision:",d),alert("Failed to record decision")}},je=(e,t)=>{if(!t){X(s=>({...s,[e]:""})),K(s=>({...s,[e]:""})),Z(s=>({...s,[e]:[]})),D(s=>({...s,[e]:""}));return}const a=t.uic;X(s=>({...s,[e]:a})),K(s=>({...s,[e]:t.unitName}));let i=[];try{const s=localStorage.getItem("unit_structure");if(s){const d=JSON.parse(s)[a],r=d!=null&&d._sections&&Array.isArray(d._sections)?d._sections:[],Ie=d!=null&&d._commandSections&&Array.isArray(d._commandSections)?d._commandSections:[];i=[...r,...Ie]}}catch(s){console.error("InstallationCommandDashboard - Failed to load unit sections from localStorage:",s)}Z(s=>({...s,[e]:i})),D(s=>({...s,[e]:""}))},_=c.useMemo(()=>Array.isArray(m==null?void 0:m.commandSections)?m.commandSections:[],[m]),y=(o==null?void 0:o.installationId)||"",de=c.useMemo(()=>{const e={},t=h.filter(a=>a.currentStage==="INSTALLATION_REVIEW"&&a.installationId===y);for(const a of _)e[a]=[];for(const a of t){const i=String(a.routeSection||"");i&&e.hasOwnProperty(i)&&e[i].push(a)}return e},[h,_,y]),ce=c.useMemo(()=>h.filter(e=>e.currentStage==="INSTALLATION_REVIEW"&&e.installationId===y&&(!e.routeSection||e.routeSection==="")),[h,y]),Ne=c.useMemo(()=>h.filter(e=>e.installationId===y&&e.currentStage!=="INSTALLATION_REVIEW"),[h,y]),M=e=>{const t=(e.activity||[]).slice().reverse();for(const a of t){const i=String(a.action||""),s=i.match(/Sent to installation section:\s*(.+)/i)||i.match(/Restored to installation section:\s*(.+)/i)||i.match(/Returned to installation section:\s*(.+)/i);if(s)return s[1].trim()}return""},Ce=async(e,t)=>{const a=`${(o==null?void 0:o.rank)||""} ${(o==null?void 0:o.lastName)||""}, ${(o==null?void 0:o.firstName)||""}`.trim()||"Installation Commander",i=(t||"").trim()||M(e),s={actor:a,timestamp:new Date().toISOString(),action:`Restored to installation section${i?`: ${i}`:""}`},l={...e,currentStage:"INSTALLATION_REVIEW",finalStatus:void 0,routeSection:i,activity:[...e.activity||[],s]};try{await N(l),p(d=>d.map(r=>r.id===e.id?l:r))}catch(d){console.error("Failed to restore to installation section:",d),alert("Failed to restore to installation section")}},we=async e=>{const t=`${(o==null?void 0:o.rank)||""} ${(o==null?void 0:o.lastName)||""}, ${(o==null?void 0:o.firstName)||""}`.trim()||"Installation Command Section";let a={...e};if(f[e.id]){const i=j[e.id]||"",s=O[e.id]||"";if(!i||!s){alert("Select HQMC division and section");return}const l={actor:t,timestamp:new Date().toISOString(),action:`Sent to HQMC: ${i} - ${s}`,comment:(u[e.id]||"").trim()};a={...e,currentStage:"HQMC_REVIEW",routeSection:s,activity:[...e.activity||[],l]}}else if(S[e.id]){const i=A[e.id]||"",s=G[e.id]||"",l=ee[e.id]||"";if(!i.trim()){alert("Please select an external unit");return}const d={actor:t,timestamp:new Date().toISOString(),action:l?`Sent to external unit: ${s} - ${l}`:`Sent to external unit: ${s}`,comment:(u[e.id]||"").trim()};a={...e,currentStage:"EXTERNAL_REVIEW",externalPendingUnitName:s,externalPendingUnitUic:i,externalPendingStage:l||void 0,routeSection:l||"",activity:[...e.activity||[],d]}}else{alert("Select an option: External Unit or Submit to HQMC");return}try{await N(a),p(i=>i.map(s=>s.id===e.id?a:s)),g(i=>({...i,[e.id]:""})),L(i=>({...i,[e.id]:!1})),T(i=>({...i,[e.id]:!1}))}catch(i){console.error("Failed to route from command section:",i),alert("Failed to route from command section")}};return n.jsx("div",{className:"max-w-7xl mx-auto p-6",children:n.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Installation Command Dashboard"}),n.jsx("div",{className:"text-sm text-[var(--muted)]",children:(m==null?void 0:m.name)||""})]}),n.jsx("div",{className:"border-b border-gray-200 mb-4",children:n.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[n.jsx("button",{onClick:()=>Q("Pending"),className:`${C==="Pending"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm`,children:"Pending"}),n.jsx("button",{onClick:()=>Q("Previously in Command Section"),className:`${C==="Previously in Command Section"?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-2 px-1 border-b-2 font-medium text-sm`,children:"Previously in Command Section"})]})}),C==="Pending"&&n.jsxs("div",{className:"space-y-8",children:[n.jsx("div",{children:n.jsx(H,{title:"Pending in Commander",titleActions:n.jsx(n.Fragment,{children:n.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:ve,children:"Export Commander"})}),requests:ce,users:w,variant:"installation",onRowClick:e=>R(t=>({...t,[e.id]:!t[e.id]})),expandedRows:$,children:e=>n.jsxs("div",{className:"p-4 bg-gray-50 space-y-3",children:[n.jsx("div",{className:"mt-2",children:n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!b[e.id],"aria-controls":`docs-instcmd-comm-${e.id}`,onClick:()=>{W(t=>({...t,[e.id]:!t[e.id]})),U(t=>b[e.id]?null:e.id)},children:n.jsx("span",{children:"Show Documents"})})}),n.jsx("div",{id:`docs-instcmd-comm-${e.id}`,ref:b[e.id]?z:void 0,className:`${b[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:n.jsx(Fe,{documents:I(e.id)})}),n.jsxs("div",{className:"mt-2",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>B(t=>({...t,[e.id]:!t[e.id]})),"aria-expanded":!!v[e.id],"aria-controls":`logs-instcmd-comm-${e.id}`,children:[v[e.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-instcmd-comm-${e.id}`,className:v[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((t,a)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[t.actor," • ",new Date(t.timestamp).toLocaleString()," • ",t.action]}),t.comment&&n.jsx("div",{className:"text-gray-600",children:t.comment})]},a)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:u[e.id]||"",onChange:t=>g(a=>({...a,[e.id]:t.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:t=>k(a=>({...a,[e.id]:t.target.files?Array.from(t.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(x[e.id]||[]).length?`${(x[e.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>oe(e),disabled:!x[e.id]||!(x[e.id]||[]).length,children:"Save Files"})]}),n.jsx("div",{className:"mt-3"}),n.jsxs("div",{className:"mt-3",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Final Decision"}),n.jsxs("div",{className:"flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>F(e,"Approved"),children:"Approved"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>F(e,"Endorsed"),children:"Endorsed"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>F(e,"Rejected"),children:"Rejected"})]})]})]})})}),_.map(e=>n.jsxs("div",{children:[n.jsx("div",{className:"flex items-center justify-between mb-3",children:n.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] flex items-center justify-between w-full",children:[e,n.jsx("span",{className:"inline-flex items-center gap-2 align-middle",children:n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 hidden md:block",onClick:()=>ye(e),children:["Export ",e]})})]})}),n.jsx(H,{title:`Pending in ${e}`,requests:de[e]||[],users:w,variant:"installation",onRowClick:t=>R(a=>({...a,[t.id]:!a[t.id]})),expandedRows:$,children:t=>n.jsxs("div",{className:"p-4 bg-gray-50 space-y-3",children:[n.jsx("div",{className:"mt-2",children:n.jsx("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!b[t.id],"aria-controls":`docs-instcmd-${t.id}`,onClick:()=>{W(a=>({...a,[t.id]:!a[t.id]})),U(a=>b[t.id]?null:t.id)},children:n.jsx("span",{children:"Show Documents"})})}),n.jsxs("div",{id:`docs-instcmd-${t.id}`,ref:b[t.id]?z:void 0,className:`${b[t.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:[I(t.id).map(a=>n.jsxs("div",{className:"flex items-center justify-between p-3 border border-brand-navy/20 rounded-lg bg-[var(--surface)]",children:[n.jsxs("div",{className:"text-sm text-[var(--muted)]",children:[n.jsx("div",{className:"font-medium text-[var(--text)]",children:a.name}),n.jsx("div",{children:new Date(a.uploadedAt).toLocaleDateString()})]}),n.jsx("div",{className:"flex items-center gap-2",children:a.fileUrl?n.jsx("a",{href:a.fileUrl,target:"_blank",rel:"noopener noreferrer",className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",children:"Open"}):n.jsx("span",{className:"px-3 py-1 text-xs bg-brand-cream text-brand-navy rounded opacity-60","aria-disabled":"true",children:"Open"})})]},a.id)),I(t.id).length===0&&n.jsx("div",{className:"text-sm text-[var(--muted)]",children:"No documents"})]}),n.jsxs("div",{className:"mt-2",children:[n.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>B(a=>({...a,[t.id]:!a[t.id]})),"aria-expanded":!!v[t.id],"aria-controls":`logs-instcmd-${t.id}`,children:[v[t.id]?"Hide":"Show"," Activity Log"]}),n.jsx("div",{id:`logs-instcmd-${t.id}`,className:v[t.id]?"mt-2 space-y-2":"hidden",children:t.activity&&t.activity.length?t.activity.map((a,i)=>n.jsxs("div",{className:"text-xs text-gray-700",children:[n.jsxs("div",{className:"font-medium",children:[a.actor," • ",new Date(a.timestamp).toLocaleString()," • ",a.action]}),a.comment&&n.jsx("div",{className:"text-gray-600",children:a.comment})]},i)):n.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),n.jsxs("div",{className:"mt-2",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),n.jsx("textarea",{rows:2,value:u[t.id]||"",onChange:a=>g(i=>({...i,[t.id]:a.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),n.jsxs("div",{className:"mt-3 p-3 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:[n.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Send Options"}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("input",{type:"checkbox",id:`send-ext-cmd-${t.id}`,checked:S[t.id]||!1,onChange:()=>{const a=!S[t.id];L(i=>({...i,[t.id]:a})),a&&T(i=>({...i,[t.id]:!1}))}}),n.jsx("label",{htmlFor:`send-ext-cmd-${t.id}`,children:"Send to External Unit"}),n.jsx("input",{type:"checkbox",id:`submit-hqmc-cmd-${t.id}`,checked:f[t.id]||!1,onChange:()=>{const a=!f[t.id];T(i=>({...i,[t.id]:a})),a&&L(i=>({...i,[t.id]:!1}))}}),n.jsx("label",{htmlFor:`submit-hqmc-cmd-${t.id}`,children:"Submit to HQMC"})]}),S[t.id]&&n.jsxs("div",{className:"mt-2 space-y-2",children:[n.jsx(Oe,{onUnitSelect:a=>je(t.id,a),selectedUnit:{uic:A[t.id]||"",unitName:G[t.id]||""},placeholder:"Search by UIC, RUC, MCC, or Unit Name"}),n.jsxs("select",{className:"px-3 py-2 border border-brand-navy/30 rounded-lg",value:ee[t.id]||"",onChange:a=>D(i=>({...i,[t.id]:a.target.value})),disabled:!(Y[t.id]||[]).length,children:[n.jsx("option",{value:"",children:"Select Section/Office (optional)"}),(Y[t.id]||[]).map(a=>n.jsx("option",{value:a,children:a},a))]})]}),f[t.id]&&n.jsxs("div",{className:"mt-2 grid grid-cols-1 md:grid-cols-2 gap-2",children:[n.jsxs("select",{className:"px-3 py-2 border border-brand-navy/30 rounded-lg",value:j[t.id]||"",onChange:a=>{pe(i=>({...i,[t.id]:a.target.value})),ae(i=>({...i,[t.id]:""}))},children:[n.jsx("option",{value:"",children:"Select HQMC Division"}),ue.map(a=>n.jsxs("option",{value:a.code,children:[a.code," — ",a.name]},a.code))]}),n.jsxs("select",{className:"px-3 py-2 border border-brand-navy/30 rounded-lg disabled:opacity-50 disabled:cursor-not-allowed",value:O[t.id]||"",onChange:a=>ae(i=>({...i,[t.id]:a.target.value})),disabled:!j[t.id],children:[n.jsx("option",{value:"",children:"Select HQMC Section"}),be.filter(a=>String(a.division_code||"")===String(j[t.id]||"")).map(a=>n.jsx("option",{value:a.branch,children:a.branch},a.branch))]})]}),n.jsx("div",{className:"mt-2",children:n.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>we(t),disabled:f[t.id]?!(j[t.id]&&O[t.id]):S[t.id]?!A[t.id]:!0,children:"Submit"})})]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[n.jsx("input",{type:"file",multiple:!0,onChange:a=>k(i=>({...i,[t.id]:a.target.files?Array.from(a.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),n.jsx("span",{className:"text-xs text-[var(--muted)]",children:(x[t.id]||[]).length?`${(x[t.id]||[]).length} file(s) selected`:"No files selected"}),n.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>oe(t),disabled:!x[t.id]||!(x[t.id]||[]).length,children:"Save Files"})]}),n.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[n.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:()=>Se(t),children:"Send to Commander"}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2",onClick:()=>fe(t),children:"Return to Section"})]})]})})]},e))]}),C==="Previously in Command Section"&&n.jsx(H,{title:"Previously in Command Section",requests:Ne,users:w,variant:"installation",onRowClick:e=>R(t=>({...t,[e.id]:!t[e.id]})),expandedRows:$,children:e=>n.jsxs("div",{className:"p-4 bg-gray-50 space-y-3",children:[n.jsxs("div",{className:"text-xs text-gray-600",children:["Last Status: ",new Date(e.activity&&e.activity.length?e.activity[e.activity.length-1].timestamp:e.createdAt).toLocaleString()]}),n.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[n.jsxs("select",{className:"px-3 py-2 border border-brand-navy/30 rounded-lg",value:J[e.id]||"",onChange:t=>xe(a=>({...a,[e.id]:t.target.value})),children:[n.jsx("option",{value:"",children:"Select installation section"}),((m==null?void 0:m.sections)||[]).map(t=>n.jsx("option",{value:t,children:t},t))]}),n.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2",onClick:()=>Ce(e,J[e.id]),children:"Restore to Section"})]})]})})]})})}export{Be as default};
