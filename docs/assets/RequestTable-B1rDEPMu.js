import{r as T,j as t,R as ae}from"./index-CWnyyP5W.js";var B=(n=>(n.PLATOON_REVIEW="PLATOON_REVIEW",n.COMPANY_REVIEW="COMPANY_REVIEW",n.BATTALION_REVIEW="BATTALION_REVIEW",n.COMMANDER_REVIEW="COMMANDER_REVIEW",n.INSTALLATION_REVIEW="INSTALLATION_REVIEW",n.HQMC_REVIEW="HQMC_REVIEW",n.EXTERNAL_REVIEW="EXTERNAL_REVIEW",n.ORIGINATOR_REVIEW="ORIGINATOR_REVIEW",n.ARCHIVED="ARCHIVED",n))(B||{});function se(n){const r=String(n.currentStage||"PLATOON_REVIEW");return r==="PLATOON_REVIEW"?"Platoon":r==="COMPANY_REVIEW"?"Company":r==="BATTALION_REVIEW"?n.routeSection||"Battalion":r==="COMMANDER_REVIEW"?n.routeSection||"Commander":r==="INSTALLATION_REVIEW"?n.routeSection?`Installation - ${n.routeSection}`:"Installation Commander":r==="HQMC_REVIEW"?n.routeSection?`HQMC - ${n.routeSection}`:"HQMC":r==="EXTERNAL_REVIEW"?n.externalPendingUnitName||"External":r==="ARCHIVED"?"Archived":r}function re(n){const r=Array.isArray(n.activity)?n.activity:[];return r.length?r[r.length-1]:null}function oe(n){const r=re(n);return!!r&&/returned/i.test(String(r.action||""))}function j(n,r){return(n.activity||[]).some(u=>r.test(String(u.action||"")))}function C(n){return j(n,/(approved by commander|commander.*approved)/i)&&!j(n,/installation commander/i)}function O(n){return j(n,/(endorsed by commander|commander.*endorsed)/i)&&!j(n,/installation commander/i)}function me(n,r){if(!(String(n.uploadedById||"")===String(r||"")))return!1;const x=String(n.currentStage||"PLATOON_REVIEW");return x==="PLATOON_REVIEW"||x==="COMPANY_REVIEW"||x==="BATTALION_REVIEW"?!0:x==="ORIGINATOR_REVIEW"&&(C(n)||O(n))?!1:oe(n)}function pe(n,r){return String(n.uploadedById||"")===String(r||"")?String(n.currentStage||"")==="ORIGINATOR_REVIEW"&&(C(n)||O(n)):!1}function ce(n){return j(n,/installation commander.*approved/i)}function ie(n){return j(n,/installation commander.*endorsed/i)}function le(n){return j(n,/(hqmc.*approved|approved.*hqmc)/i)}function de(n){const r=n.activity||[];let u=!1;for(const x of r){const E=String(x.action||"").toLowerCase();if(/(approved|endorsed) by commander/i.test(E)&&!/installation commander/i.test(E)&&(u=!0),u&&/battalion/i.test(E)&&/(archived|sent|routed|assigned)/i.test(E))return!0}return!1}function xe(n,r){return!(!(String(n.uploadedById||"")===String(r||""))||(C(n)||O(n))&&de(n)||String(n.currentStage||"")==="ARCHIVED")}function ve(n,r){const u=String(n.currentStage||"");if(u==="ARCHIVED")return!1;switch(r.userLevel){case"originator":return u==="ORIGINATOR_REVIEW"&&(C(n)||O(n));case"unit":return u!=="BATTALION_REVIEW"||!C(n)&&!O(n)?!1:r.userUnitUic===n.unitUic;case"installation":return!ce(n)&&!ie(n)?!1:r.userInstallationId===n.installationId;case"hqmc":return le(n);case"external":return!1;default:return!1}}const Ne=({requests:n,users:r,onRowClick:u,title:x,titleActions:E,expandedRows:F,children:Q,platoonSectionMap:W,variant:q="default"})=>{const[w,L]=T.useState(null),m=q==="installation",[o,b]=T.useState({subject:"",status:"",unit:"",originator:"",company:"",platoon:"",created:"",lastStatus:""}),R=T.useMemo(()=>Object.values(r),[r]),f=e=>r[e.uploadedById]||null,_=e=>e&&e!=="N/A"?e:"—",V=e=>{var A,I;const c=N=>String(N||"").trim().replace(/^S(\d)\b/,"S-$1");if(e.routeSection)return c(e.routeSection);if(!W)return"";const a=e.unitUic||"",s=r[e.uploadedById];if(!s)return"";const i=N=>N&&N!=="N/A"?N:"",v=i(s.company),l=i(s.platoon),y=((I=(A=W[a])==null?void 0:A[v])==null?void 0:I[l])||"";return c(y)},G=e=>se(e),k=(e,c)=>{var s;const a=(s=e.activity)==null?void 0:s[e.activity.length-1];return!!a&&c.test(a.action||"")},Y=e=>k(e,/returned/i),X=e=>k(e,/rejected/i),g=(e,c)=>{var a;return((a=e.activity)==null?void 0:a.some(s=>c.test(String(s.action||""))))||!1},z=e=>g(e,/(approved by commander|commander.*approved)/i)&&!g(e,/installation commander/i),J=e=>g(e,/(endorsed by commander|commander.*endorsed)/i)&&!g(e,/installation commander/i),K=e=>g(e,/(approved by installation commander|installation commander.*approved|installation.*approved)/i),Z=e=>g(e,/(endorsed by installation commander|installation commander.*endorsed|installation.*endorsed)/i),P=e=>g(e,/hqmc.*approved/i),U=e=>{if((e.currentStage||"PLATOON_REVIEW")==="EXTERNAL_REVIEW")return e.externalPendingUnitName||"External Unit";const a=f(e);return(a==null?void 0:a.unit)||e.unitUic||"N/A"},M=e=>{const c=f(e),a=e.unitUic||(c==null?void 0:c.unitUic)||"",s=(c==null?void 0:c.unit)||"";return a&&s?`${a} • ${s}`:a||s||"N/A"},ee=e=>{switch(e.currentStage||"PLATOON_REVIEW"){case"PLATOON_REVIEW":{const a=f(e);return a?R.filter(s=>s.unitUic===e.unitUic&&s.company===a.company&&s.platoon===a.platoon):[]}case"COMPANY_REVIEW":{const a=f(e);return a?R.filter(s=>s.unitUic===e.unitUic&&s.company===a.company):[]}case"BATTALION_REVIEW":{const a=V(e);return R.filter(s=>s.unitUic===e.unitUic&&s.company===a)}case"COMMANDER_REVIEW":return e.routeSection?R.filter(a=>a.unitUic===e.unitUic&&a.company===e.routeSection):R.filter(a=>a.unitUic===e.unitUic&&(a.role==="COMMANDER"||a.company==="HQ"));case"INSTALLATION_REVIEW":{const a=V(e);return R.filter(s=>s.unitUic===e.unitUic&&s.company===a)}default:return[]}},$=e=>{const c=e.activity&&e.activity.length?e.activity[e.activity.length-1].timestamp:e.createdAt;try{return new Date(c).toLocaleDateString()}catch{return e.createdAt}},te=e=>{try{const c=localStorage.getItem("installations_cache")||"[]",a=JSON.parse(c);if(Array.isArray(a)){const s=a.find(i=>String(i.id)===String(e||""));return s?String(s.name||""):""}}catch{}return""},D=e=>{const c=e.currentStage||"PLATOON_REVIEW",a=f(e);switch(c){case"ORIGINATOR_REVIEW":return{level:"Member",scope:""};case"PLATOON_REVIEW":{const s=a!=null&&a.company&&a.company!=="N/A"?a.company:"",i=a!=null&&a.platoon&&a.platoon!=="N/A"?a.platoon:"";return s&&i?{level:"Platoon",scope:`(${s}-${i})`}:s?{level:"Platoon",scope:`(${s})`}:{level:"Platoon Review",scope:""}}case"COMPANY_REVIEW":{const s=a!=null&&a.company&&a.company!=="N/A"?a.company:"";return{level:"Company",scope:s?`(${s})`:""}}case"BATTALION_REVIEW":{const s=V(e);return{level:"Battalion",scope:s?`(${s})`:""}}case"COMMANDER_REVIEW":return{level:"Commander",scope:e.routeSection?`(${e.routeSection})`:""};case"INSTALLATION_REVIEW":{const s=te(e.installationId),i=e.routeSection||"";return s&&i?{level:s,scope:`(${i})`}:{level:s||"Installation",scope:""}}case"HQMC_REVIEW":{const s=e.routeSection||"";return{level:"HQMC",scope:s?`(${s})`:""}}case"EXTERNAL_REVIEW":{const s=e.externalPendingUnitName||"",i=e.routeSection||"";return s&&i?{level:s,scope:`(${i})`}:{level:s||"External",scope:""}}case"ARCHIVED":return{level:"Archived",scope:""};default:return{level:G(e),scope:""}}},ne=e=>{const{level:c,scope:a}=D(e);return a?`${c} ${a}`:c};return t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3 flex items-center",children:[x,E?t.jsx("span",{className:"ml-auto inline-flex items-center gap-2 align-middle",children:E}):null]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-[var(--surface)] border border-brand-navy/20",children:[t.jsx("thead",{className:"bg-brand-cream border-b border-brand-navy/20",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Subject"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Unit"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Originator"}),!m&&t.jsxs(t.Fragment,{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Platoon"})]}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Last Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Actions"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.subject,onChange:e=>b({...o,subject:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.status,onChange:e=>b({...o,status:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.unit,onChange:e=>b({...o,unit:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.originator,onChange:e=>b({...o,originator:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),!m&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.company,onChange:e=>b({...o,company:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.platoon,onChange:e=>b({...o,platoon:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})})]}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.created,onChange:e=>b({...o,created:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.lastStatus,onChange:e=>b({...o,lastStatus:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2"})]}),n.filter(e=>{const c=!o.subject||String(e.subject||"").toLowerCase().includes(o.subject.toLowerCase()),a=ne(e),s=!o.status||a.toLowerCase().includes(o.status.toLowerCase()),i=m?M(e):U(e),v=!o.unit||i.toLowerCase().includes(o.unit.toLowerCase()),l=f(e),y=l?`${l.rank||""} ${l.lastName||""} ${l.firstName||""}`.trim():"",A=!o.originator||y.toLowerCase().includes(o.originator.toLowerCase()),I=m||!o.company||(l!=null&&l.company?l.company.toLowerCase().includes(o.company.toLowerCase()):!1),N=m||!o.platoon||(l!=null&&l.platoon?l.platoon.toLowerCase().includes(o.platoon.toLowerCase()):!1),h=new Date(e.createdAt).toLocaleDateString(),S=!o.created||h.toLowerCase().includes(o.created.toLowerCase()),d=$(e),p=!o.lastStatus||d.toLowerCase().includes(o.lastStatus.toLowerCase());return c&&s&&v&&A&&I&&N&&S&&p}).map(e=>{const c=Y(e),a=X(e),s=z(e),i=J(e),v=K(e),l=Z(e),y=(e.currentStage||"")===B.HQMC_REVIEW,A=s||i||v||l,I=m?v||l:y?P(e):A,N=a||c&&!A,h=f(e),S=ee(e),d=!e.subject&&!e.uploadedById&&(e.documentIds||[]).length===0;return t.jsxs(ae.Fragment,{children:[t.jsxs("tr",{className:`border-b border-brand-navy/20 hover:bg-brand-cream/50 cursor-pointer ${N?"bg-red-100":I?"bg-green-100":""}`,onClick:()=>u(e),children:[t.jsxs("td",{className:`p-3 text-sm ${N?"text-red-700 font-bold":I?"text-green-700 font-bold":"text-[var(--text)]"}`,children:[c&&t.jsx("span",{className:"font-bold",children:"Returned: "}),a&&t.jsx("span",{className:"font-bold",children:"Rejected: "}),!d&&!m&&!y&&(s||i||v||l)&&t.jsx("span",{className:"font-bold",children:s?"Unit Approved: ":i?"Unit Endorsed: ":v?"Installation Approved: ":"Installation Endorsed: "}),!d&&m&&v&&t.jsx("span",{className:"font-bold",children:"Installation Approved: "}),!d&&m&&!v&&l&&t.jsx("span",{className:"font-bold",children:"Installation Endorsed: "}),!d&&!m&&y&&P(e)&&t.jsx("span",{className:"font-bold",children:"HQMC Approved: "}),d?t.jsx("span",{className:"inline-block w-40 h-4 bg-gray-100 animate-pulse rounded"}):e.subject]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-24 h-5 bg-gray-100 animate-pulse rounded"}):(()=>{const{level:p,scope:H}=D(e);return H?t.jsxs("span",{className:"inline-flex flex-col items-center px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-lg border border-brand-navy/30 leading-tight",children:[t.jsx("span",{children:p}),t.jsx("span",{className:"text-[10px]",children:H})]}):t.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:p})})()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):m?M(e):U(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:(()=>{const p=f(e);return d?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):p?`${p.rank} ${p.lastName}, ${p.firstName}`:"N/A"})()}),!m&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):_(h==null?void 0:h.company)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):_(h==null?void 0:h.platoon)})]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):new Date(e.createdAt).toLocaleDateString()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):$(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-24 h-6 bg-gray-100 animate-pulse rounded"}):t.jsxs("button",{onClick:p=>{p.stopPropagation(),L(S)},className:"px-2 py-1 text-xs bg-brand-navy text-brand-cream rounded hover:bg-brand-red-2",children:["Contacts (",S.length,")"]})})]}),F[e.id]&&t.jsx("tr",{children:t.jsx("td",{colSpan:m?7:9,className:"p-4 bg-gray-50",children:Q(e)})})]},e.id)}),n.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"p-3 text-sm text-center text-[var(--muted)]",children:"No requests to display."})})]})]})}),w&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",onClick:()=>L(null),children:t.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Contacts at Current Action Level"}),t.jsx("button",{onClick:()=>L(null),className:"text-[var(--muted)] hover:text-[var(--text)]",children:"✕"})]}),t.jsx("div",{className:"space-y-3",children:w.length===0?t.jsx("p",{className:"text-sm text-[var(--muted)]",children:"No contacts found at this action level."}):w.map(e=>t.jsx("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-[var(--text)]",children:[e.rank," ",e.lastName,", ",e.firstName," ",e.mi||""]}),t.jsx("div",{className:"text-sm text-[var(--muted)] mt-1",children:e.email||"No email provided"}),e.company&&e.company!=="N/A"&&t.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["Company: ",e.company,e.platoon&&e.platoon!=="N/A"&&` • Platoon: ${e.platoon}`]})]})})},e.id))})]})})]})};export{Ne as R,B as S,me as a,ve as b,xe as c,se as f,pe as o};
