import{r as S,j as t,R as ae}from"./index-MTHe0j9m.js";var D=(s=>(s.PLATOON_REVIEW="PLATOON_REVIEW",s.COMPANY_REVIEW="COMPANY_REVIEW",s.BATTALION_REVIEW="BATTALION_REVIEW",s.COMMANDER_REVIEW="COMMANDER_REVIEW",s.INSTALLATION_REVIEW="INSTALLATION_REVIEW",s.HQMC_REVIEW="HQMC_REVIEW",s.EXTERNAL_REVIEW="EXTERNAL_REVIEW",s.ORIGINATOR_REVIEW="ORIGINATOR_REVIEW",s.ARCHIVED="ARCHIVED",s))(D||{});function se(s){const c=String(s.currentStage||"PLATOON_REVIEW");return c==="PLATOON_REVIEW"?"Platoon":c==="COMPANY_REVIEW"?"Company":c==="BATTALION_REVIEW"?s.routeSection||"Battalion":c==="COMMANDER_REVIEW"?s.routeSection||"Commander":c==="INSTALLATION_REVIEW"?s.routeSection?`Installation - ${s.routeSection}`:"Installation Commander":c==="HQMC_REVIEW"?s.routeSection?`HQMC - ${s.routeSection}`:"HQMC":c==="EXTERNAL_REVIEW"?s.externalPendingUnitName||"External":c==="ARCHIVED"?"Archived":c}function re(s){const c=Array.isArray(s.activity)?s.activity:[];return c.length?c[c.length-1]:null}function oe(s){const c=re(s);return!!c&&/returned/i.test(String(c.action||""))}function R(s,c){return(s.activity||[]).some(A=>c.test(String(A.action||"")))}function H(s){return R(s,/(approved by commander|commander.*approved)/i)&&!R(s,/installation commander/i)}function F(s){return R(s,/(endorsed by commander|commander.*endorsed)/i)&&!R(s,/installation commander/i)}function le(s,c){if(!(String(s.uploadedById||"")===String(c||"")))return!1;const h=String(s.currentStage||"PLATOON_REVIEW");return h==="PLATOON_REVIEW"||h==="COMPANY_REVIEW"||h==="BATTALION_REVIEW"?!0:h==="ORIGINATOR_REVIEW"&&(H(s)||F(s))?!1:oe(s)}function ie(s,c){return String(s.uploadedById||"")===String(c||"")?String(s.currentStage||"")==="ORIGINATOR_REVIEW"&&(H(s)||F(s)):!1}const de=({requests:s,users:c,onRowClick:A,title:h,titleActions:L,expandedRows:B,children:Q,platoonSectionMap:V,variant:Y="default"})=>{const[C,O]=S.useState(null),u=Y==="installation",[r,N]=S.useState({subject:"",status:"",unit:"",originator:"",company:"",platoon:"",created:"",lastStatus:""}),j=S.useMemo(()=>Object.values(c),[c]),b=e=>c[e.uploadedById]||null,T=e=>e&&e!=="N/A"?e:"—",w=e=>{var y,f;const o=p=>String(p||"").trim().replace(/^S(\d)\b/,"S-$1");if(e.routeSection)return o(e.routeSection);if(!V)return"";const n=e.unitUic||"",a=c[e.uploadedById];if(!a)return"";const l=p=>p&&p!=="N/A"?p:"",x=l(a.company),i=l(a.platoon),g=((f=(y=V[n])==null?void 0:y[x])==null?void 0:f[i])||"";return o(g)},G=e=>se(e),W=(e,o)=>{var a;const n=(a=e.activity)==null?void 0:a[e.activity.length-1];return!!n&&o.test(n.action||"")},X=e=>W(e,/returned/i),q=e=>W(e,/rejected/i),E=(e,o)=>{var n;return((n=e.activity)==null?void 0:n.some(a=>o.test(String(a.action||""))))||!1},z=e=>E(e,/(approved by commander|commander.*approved)/i)&&!E(e,/installation commander/i),J=e=>E(e,/(endorsed by commander|commander.*endorsed)/i)&&!E(e,/installation commander/i),K=e=>E(e,/(approved by installation commander|installation commander.*approved|installation.*approved)/i),Z=e=>E(e,/(endorsed by installation commander|installation commander.*endorsed|installation.*endorsed)/i),_=e=>E(e,/hqmc.*approved/i),k=e=>{if((e.currentStage||"PLATOON_REVIEW")==="EXTERNAL_REVIEW")return e.externalPendingUnitName||"External Unit";const n=b(e);return(n==null?void 0:n.unit)||e.unitUic||"N/A"},P=e=>{const o=b(e),n=e.unitUic||(o==null?void 0:o.unitUic)||"",a=(o==null?void 0:o.unit)||"";return n&&a?`${n} • ${a}`:n||a||"N/A"},ee=e=>{switch(e.currentStage||"PLATOON_REVIEW"){case"PLATOON_REVIEW":{const n=b(e);return n?j.filter(a=>a.unitUic===e.unitUic&&a.company===n.company&&a.platoon===n.platoon):[]}case"COMPANY_REVIEW":{const n=b(e);return n?j.filter(a=>a.unitUic===e.unitUic&&a.company===n.company):[]}case"BATTALION_REVIEW":{const n=w(e);return j.filter(a=>a.unitUic===e.unitUic&&a.company===n)}case"COMMANDER_REVIEW":return e.routeSection?j.filter(n=>n.unitUic===e.unitUic&&n.company===e.routeSection):j.filter(n=>n.unitUic===e.unitUic&&(n.role==="COMMANDER"||n.company==="HQ"));case"INSTALLATION_REVIEW":{const n=w(e);return j.filter(a=>a.unitUic===e.unitUic&&a.company===n)}default:return[]}},U=e=>{const o=e.activity&&e.activity.length?e.activity[e.activity.length-1].timestamp:e.createdAt;try{return new Date(o).toLocaleDateString()}catch{return e.createdAt}},te=e=>{try{const o=localStorage.getItem("installations_cache")||"[]",n=JSON.parse(o);if(Array.isArray(n)){const a=n.find(l=>String(l.id)===String(e||""));return a?String(a.name||""):""}}catch{}return""},M=e=>{const o=e.currentStage||"PLATOON_REVIEW",n=b(e);switch(o){case"ORIGINATOR_REVIEW":return{level:"Member",scope:""};case"PLATOON_REVIEW":{const a=n!=null&&n.company&&n.company!=="N/A"?n.company:"",l=n!=null&&n.platoon&&n.platoon!=="N/A"?n.platoon:"";return a&&l?{level:"Platoon",scope:`(${a}-${l})`}:a?{level:"Platoon",scope:`(${a})`}:{level:"Platoon Review",scope:""}}case"COMPANY_REVIEW":{const a=n!=null&&n.company&&n.company!=="N/A"?n.company:"";return{level:"Company",scope:a?`(${a})`:""}}case"BATTALION_REVIEW":{const a=w(e);return{level:"Battalion",scope:a?`(${a})`:""}}case"COMMANDER_REVIEW":return{level:"Commander",scope:e.routeSection?`(${e.routeSection})`:""};case"INSTALLATION_REVIEW":{const a=te(e.installationId),l=e.routeSection||"";return a&&l?{level:a,scope:`(${l})`}:{level:a||"Installation",scope:""}}case"HQMC_REVIEW":{const a=e.routeSection||"";return{level:"HQMC",scope:a?`(${a})`:""}}case"EXTERNAL_REVIEW":{const a=e.externalPendingUnitName||"",l=e.routeSection||"";return a&&l?{level:a,scope:`(${l})`}:{level:a||"External",scope:""}}case"ARCHIVED":return{level:"Archived",scope:""};default:return{level:G(e),scope:""}}},ne=e=>{const{level:o,scope:n}=M(e);return n?`${o} ${n}`:o};return t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3 flex items-center",children:[h,L?t.jsx("span",{className:"ml-auto inline-flex items-center gap-2 align-middle",children:L}):null]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-[var(--surface)] border border-brand-navy/20",children:[t.jsx("thead",{className:"bg-brand-cream border-b border-brand-navy/20",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Subject"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Unit"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Originator"}),!u&&t.jsxs(t.Fragment,{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Platoon"})]}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Last Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Actions"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.subject,onChange:e=>N({...r,subject:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.status,onChange:e=>N({...r,status:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.unit,onChange:e=>N({...r,unit:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.originator,onChange:e=>N({...r,originator:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),!u&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.company,onChange:e=>N({...r,company:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.platoon,onChange:e=>N({...r,platoon:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})})]}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.created,onChange:e=>N({...r,created:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:r.lastStatus,onChange:e=>N({...r,lastStatus:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2"})]}),s.filter(e=>{const o=!r.subject||String(e.subject||"").toLowerCase().includes(r.subject.toLowerCase()),n=ne(e),a=!r.status||n.toLowerCase().includes(r.status.toLowerCase()),l=u?P(e):k(e),x=!r.unit||l.toLowerCase().includes(r.unit.toLowerCase()),i=b(e),g=i?`${i.rank||""} ${i.lastName||""} ${i.firstName||""}`.trim():"",y=!r.originator||g.toLowerCase().includes(r.originator.toLowerCase()),f=u||!r.company||(i!=null&&i.company?i.company.toLowerCase().includes(r.company.toLowerCase()):!1),p=u||!r.platoon||(i!=null&&i.platoon?i.platoon.toLowerCase().includes(r.platoon.toLowerCase()):!1),v=new Date(e.createdAt).toLocaleDateString(),I=!r.created||v.toLowerCase().includes(r.created.toLowerCase()),d=U(e),m=!r.lastStatus||d.toLowerCase().includes(r.lastStatus.toLowerCase());return o&&a&&x&&y&&f&&p&&I&&m}).map(e=>{const o=X(e),n=q(e),a=z(e),l=J(e),x=K(e),i=Z(e),g=(e.currentStage||"")===D.HQMC_REVIEW,y=a||l||x||i,f=u?x||i:g?_(e):y,p=n||o&&!y,v=b(e),I=ee(e),d=!e.subject&&!e.uploadedById&&(e.documentIds||[]).length===0;return t.jsxs(ae.Fragment,{children:[t.jsxs("tr",{className:`border-b border-brand-navy/20 hover:bg-brand-cream/50 cursor-pointer ${p?"bg-red-100":f?"bg-green-100":""}`,onClick:()=>A(e),children:[t.jsxs("td",{className:`p-3 text-sm ${p?"text-red-700 font-bold":f?"text-green-700 font-bold":"text-[var(--text)]"}`,children:[o&&t.jsx("span",{className:"font-bold",children:"Returned: "}),n&&t.jsx("span",{className:"font-bold",children:"Rejected: "}),!d&&!u&&!g&&(a||l||x||i)&&t.jsx("span",{className:"font-bold",children:a?"Unit Approved: ":l?"Unit Endorsed: ":x?"Installation Approved: ":"Installation Endorsed: "}),!d&&u&&x&&t.jsx("span",{className:"font-bold",children:"Installation Approved: "}),!d&&u&&!x&&i&&t.jsx("span",{className:"font-bold",children:"Installation Endorsed: "}),!d&&!u&&g&&_(e)&&t.jsx("span",{className:"font-bold",children:"HQMC Approved: "}),d?t.jsx("span",{className:"inline-block w-40 h-4 bg-gray-100 animate-pulse rounded"}):e.subject]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-24 h-5 bg-gray-100 animate-pulse rounded"}):(()=>{const{level:m,scope:$}=M(e);return $?t.jsxs("span",{className:"inline-flex flex-col items-center px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-lg border border-brand-navy/30 leading-tight",children:[t.jsx("span",{children:m}),t.jsx("span",{className:"text-[10px]",children:$})]}):t.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:m})})()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):u?P(e):k(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:(()=>{const m=b(e);return d?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):m?`${m.rank} ${m.lastName}, ${m.firstName}`:"N/A"})()}),!u&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):T(v==null?void 0:v.company)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):T(v==null?void 0:v.platoon)})]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):new Date(e.createdAt).toLocaleDateString()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):U(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-24 h-6 bg-gray-100 animate-pulse rounded"}):t.jsxs("button",{onClick:m=>{m.stopPropagation(),O(I)},className:"px-2 py-1 text-xs bg-brand-navy text-brand-cream rounded hover:bg-brand-red-2",children:["Contacts (",I.length,")"]})})]}),B[e.id]&&t.jsx("tr",{children:t.jsx("td",{colSpan:u?7:9,className:"p-4 bg-gray-50",children:Q(e)})})]},e.id)}),s.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"p-3 text-sm text-center text-[var(--muted)]",children:"No requests to display."})})]})]})}),C&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",onClick:()=>O(null),children:t.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Contacts at Current Action Level"}),t.jsx("button",{onClick:()=>O(null),className:"text-[var(--muted)] hover:text-[var(--text)]",children:"✕"})]}),t.jsx("div",{className:"space-y-3",children:C.length===0?t.jsx("p",{className:"text-sm text-[var(--muted)]",children:"No contacts found at this action level."}):C.map(e=>t.jsx("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-[var(--text)]",children:[e.rank," ",e.lastName,", ",e.firstName," ",e.mi||""]}),t.jsx("div",{className:"text-sm text-[var(--muted)] mt-1",children:e.email||"No email provided"}),e.company&&e.company!=="N/A"&&t.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["Company: ",e.company,e.platoon&&e.platoon!=="N/A"&&` • Platoon: ${e.platoon}`]})]})})},e.id))})]})})]})};export{de as R,D as S,le as c,se as f,ie as o};
