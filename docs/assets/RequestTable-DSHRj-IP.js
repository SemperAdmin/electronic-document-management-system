import{r as T,j as t,R as re}from"./index-BVJiOrCp.js";var H=(n=>(n.PLATOON_REVIEW="PLATOON_REVIEW",n.COMPANY_REVIEW="COMPANY_REVIEW",n.BATTALION_REVIEW="BATTALION_REVIEW",n.COMMANDER_REVIEW="COMMANDER_REVIEW",n.INSTALLATION_REVIEW="INSTALLATION_REVIEW",n.HQMC_REVIEW="HQMC_REVIEW",n.EXTERNAL_REVIEW="EXTERNAL_REVIEW",n.ORIGINATOR_REVIEW="ORIGINATOR_REVIEW",n.ARCHIVED="ARCHIVED",n))(H||{});function oe(n){const r=String(n.currentStage||"PLATOON_REVIEW");return r==="PLATOON_REVIEW"?"Platoon":r==="COMPANY_REVIEW"?"Company":r==="BATTALION_REVIEW"?n.routeSection||"Battalion":r==="COMMANDER_REVIEW"?n.routeSection||"Commander":r==="INSTALLATION_REVIEW"?n.routeSection?`Installation - ${n.routeSection}`:"Installation Commander":r==="HQMC_REVIEW"?n.routeSection?`HQMC - ${n.routeSection}`:"HQMC":r==="EXTERNAL_REVIEW"?n.externalPendingUnitName||"External":r==="ARCHIVED"?"Archived":r}function ce(n){const r=Array.isArray(n.activity)?n.activity:[];return r.length?r[r.length-1]:null}function le(n){const r=ce(n);return!!r&&/returned/i.test(String(r.action||""))}function y(n,r){return(n.activity||[]).some(d=>r.test(String(d.action||"")))}function R(n){return y(n,/(approved by commander|commander.*approved)/i)&&!y(n,/installation commander/i)}function j(n){return y(n,/(endorsed by commander|commander.*endorsed)/i)&&!y(n,/installation commander/i)}function ue(n,r){if(!(String(n.uploadedById||"")===String(r||"")))return!1;const E=String(n.currentStage||"PLATOON_REVIEW");return E==="PLATOON_REVIEW"||E==="COMPANY_REVIEW"||E==="BATTALION_REVIEW"?!0:E==="ORIGINATOR_REVIEW"&&(R(n)||j(n))?!1:le(n)}function me(n,r){return String(n.uploadedById||"")===String(r||"")?String(n.currentStage||"")==="ORIGINATOR_REVIEW"&&(R(n)||j(n)):!1}function F(n){return y(n,/installation commander.*approved/i)}function Q(n){return y(n,/installation commander.*endorsed/i)}function ie(n){return y(n,/(hqmc.*approved|approved.*hqmc)/i)}function pe(n,r){return!(!(String(n.uploadedById||"")===String(r||""))||R(n)||j(n)||F(n)||Q(n)||String(n.currentStage||"")==="ARCHIVED")}function xe(n,r){if(n.filedAt||!n.ssic||!R(n)&&!j(n))return!1;const d=String(n.currentStage||"");return d==="ORIGINATOR_REVIEW"&&String(n.uploadedById||"")===String(r||"")||d==="PLATOON_REVIEW"||d==="COMPANY_REVIEW"||d==="BATTALION_REVIEW"}function Ne(n){switch(n){case"BATTALION_REVIEW":return"COMPANY_REVIEW";case"COMPANY_REVIEW":return"PLATOON_REVIEW";case"PLATOON_REVIEW":return"ORIGINATOR_REVIEW";default:return null}}function Ee(n){if(n.filedAt||!R(n)&&!j(n))return!1;const r=String(n.currentStage||"");return r==="BATTALION_REVIEW"||r==="COMPANY_REVIEW"||r==="PLATOON_REVIEW"}function fe(n,r){const d=String(n.currentStage||"");if(d==="ARCHIVED")return!1;switch(r.userLevel){case"originator":return d==="ORIGINATOR_REVIEW"&&(R(n)||j(n));case"unit":return d!=="BATTALION_REVIEW"||!R(n)&&!j(n)?!1:r.userUnitUic===n.unitUic;case"installation":return!F(n)&&!Q(n)?!1:r.userInstallationId===n.installationId;case"hqmc":return ie(n);case"external":return!1;default:return!1}}const ve=({requests:n,users:r,onRowClick:d,title:E,titleActions:w,expandedRows:Y,children:q,platoonSectionMap:W,variant:G="default"})=>{const[S,L]=T.useState(null),m=G==="installation",[o,f]=T.useState({subject:"",status:"",unit:"",originator:"",company:"",platoon:"",created:"",lastStatus:""}),O=T.useMemo(()=>Object.values(r),[r]),v=e=>r[e.uploadedById]||null,_=e=>e&&e!=="N/A"?e:"—",V=e=>{var I,A;const c=N=>String(N||"").trim().replace(/^S(\d)\b/,"S-$1");if(e.routeSection)return c(e.routeSection);if(!W)return"";const a=e.unitUic||"",s=r[e.uploadedById];if(!s)return"";const l=N=>N&&N!=="N/A"?N:"",x=l(s.company),i=l(s.platoon),g=((A=(I=W[a])==null?void 0:I[x])==null?void 0:A[i])||"";return c(g)},X=e=>oe(e),P=(e,c)=>{var s;const a=(s=e.activity)==null?void 0:s[e.activity.length-1];return!!a&&c.test(a.action||"")},z=e=>P(e,/returned/i),J=e=>P(e,/rejected/i),h=(e,c)=>{var a;return((a=e.activity)==null?void 0:a.some(s=>c.test(String(s.action||""))))||!1},K=e=>h(e,/(approved by commander|commander.*approved)/i)&&!h(e,/installation commander/i),Z=e=>h(e,/(endorsed by commander|commander.*endorsed)/i)&&!h(e,/installation commander/i),ee=e=>h(e,/(approved by installation commander|installation commander.*approved|installation.*approved)/i),te=e=>h(e,/(endorsed by installation commander|installation commander.*endorsed|installation.*endorsed)/i),k=e=>h(e,/hqmc.*approved/i),M=e=>{if((e.currentStage||"PLATOON_REVIEW")==="EXTERNAL_REVIEW")return e.externalPendingUnitName||"External Unit";const a=v(e);return(a==null?void 0:a.unit)||e.unitUic||"N/A"},U=e=>{const c=v(e),a=e.unitUic||(c==null?void 0:c.unitUic)||"",s=(c==null?void 0:c.unit)||"";return a&&s?`${a} • ${s}`:a||s||"N/A"},ne=e=>{switch(e.currentStage||"PLATOON_REVIEW"){case"PLATOON_REVIEW":{const a=v(e);return a?O.filter(s=>s.unitUic===e.unitUic&&s.company===a.company&&s.platoon===a.platoon):[]}case"COMPANY_REVIEW":{const a=v(e);return a?O.filter(s=>s.unitUic===e.unitUic&&s.company===a.company):[]}case"BATTALION_REVIEW":{const a=V(e);return O.filter(s=>s.unitUic===e.unitUic&&s.company===a)}case"COMMANDER_REVIEW":return e.routeSection?O.filter(a=>a.unitUic===e.unitUic&&a.company===e.routeSection):O.filter(a=>a.unitUic===e.unitUic&&(a.role==="COMMANDER"||a.company==="HQ"));case"INSTALLATION_REVIEW":{const a=V(e);return O.filter(s=>s.unitUic===e.unitUic&&s.company===a)}default:return[]}},$=e=>{const c=e.activity&&e.activity.length?e.activity[e.activity.length-1].timestamp:e.createdAt;try{return new Date(c).toLocaleDateString()}catch{return e.createdAt}},ae=e=>{try{const c=localStorage.getItem("installations_cache")||"[]",a=JSON.parse(c);if(Array.isArray(a)){const s=a.find(l=>String(l.id)===String(e||""));return s?String(s.name||""):""}}catch{}return""},D=e=>{const c=e.currentStage||"PLATOON_REVIEW",a=v(e);switch(c){case"ORIGINATOR_REVIEW":return{level:"Member",scope:""};case"PLATOON_REVIEW":{const s=a!=null&&a.company&&a.company!=="N/A"?a.company:"",l=a!=null&&a.platoon&&a.platoon!=="N/A"?a.platoon:"";return s&&l?{level:"Platoon",scope:`(${s}-${l})`}:s?{level:"Platoon",scope:`(${s})`}:{level:"Platoon Review",scope:""}}case"COMPANY_REVIEW":{const s=a!=null&&a.company&&a.company!=="N/A"?a.company:"";return{level:"Company",scope:s?`(${s})`:""}}case"BATTALION_REVIEW":{const s=V(e);return{level:"Battalion",scope:s?`(${s})`:""}}case"COMMANDER_REVIEW":return{level:"Commander",scope:e.routeSection?`(${e.routeSection})`:""};case"INSTALLATION_REVIEW":{const s=ae(e.installationId),l=e.routeSection||"";return s&&l?{level:s,scope:`(${l})`}:{level:s||"Installation",scope:""}}case"HQMC_REVIEW":{const s=e.routeSection||"";return{level:"HQMC",scope:s?`(${s})`:""}}case"EXTERNAL_REVIEW":{const s=e.externalPendingUnitName||"",l=e.routeSection||"";return s&&l?{level:s,scope:`(${l})`}:{level:s||"External",scope:""}}case"ARCHIVED":return{level:"Archived",scope:""};default:return{level:X(e),scope:""}}},se=e=>{const{level:c,scope:a}=D(e);return a?`${c} ${a}`:c};return t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3 flex items-center",children:[E,w?t.jsx("span",{className:"ml-auto inline-flex items-center gap-2 align-middle",children:w}):null]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-[var(--surface)] border border-brand-navy/20",children:[t.jsx("thead",{className:"bg-brand-cream border-b border-brand-navy/20",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Subject"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Unit"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Originator"}),!m&&t.jsxs(t.Fragment,{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Platoon"})]}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Last Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Actions"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.subject,onChange:e=>f({...o,subject:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.status,onChange:e=>f({...o,status:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.unit,onChange:e=>f({...o,unit:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.originator,onChange:e=>f({...o,originator:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),!m&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.company,onChange:e=>f({...o,company:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.platoon,onChange:e=>f({...o,platoon:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})})]}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.created,onChange:e=>f({...o,created:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.lastStatus,onChange:e=>f({...o,lastStatus:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2"})]}),n.filter(e=>{const c=!o.subject||String(e.subject||"").toLowerCase().includes(o.subject.toLowerCase()),a=se(e),s=!o.status||a.toLowerCase().includes(o.status.toLowerCase()),l=m?U(e):M(e),x=!o.unit||l.toLowerCase().includes(o.unit.toLowerCase()),i=v(e),g=i?`${i.rank||""} ${i.lastName||""} ${i.firstName||""}`.trim():"",I=!o.originator||g.toLowerCase().includes(o.originator.toLowerCase()),A=m||!o.company||(i!=null&&i.company?i.company.toLowerCase().includes(o.company.toLowerCase()):!1),N=m||!o.platoon||(i!=null&&i.platoon?i.platoon.toLowerCase().includes(o.platoon.toLowerCase()):!1),b=new Date(e.createdAt).toLocaleDateString(),C=!o.created||b.toLowerCase().includes(o.created.toLowerCase()),u=$(e),p=!o.lastStatus||u.toLowerCase().includes(o.lastStatus.toLowerCase());return c&&s&&x&&I&&A&&N&&C&&p}).map(e=>{const c=z(e),a=J(e),s=K(e),l=Z(e),x=ee(e),i=te(e),g=(e.currentStage||"")===H.HQMC_REVIEW,I=s||l||x||i,A=m?x||i:g?k(e):I,N=a||c&&!I,b=v(e),C=ne(e),u=!e.subject&&!e.uploadedById&&(e.documentIds||[]).length===0;return t.jsxs(re.Fragment,{children:[t.jsxs("tr",{className:`border-b border-brand-navy/20 hover:bg-brand-cream/50 cursor-pointer ${N?"bg-red-100":A?"bg-green-100":""}`,onClick:()=>d(e),children:[t.jsxs("td",{className:`p-3 text-sm ${N?"text-red-700 font-bold":A?"text-green-700 font-bold":"text-[var(--text)]"}`,children:[c&&t.jsx("span",{className:"font-bold",children:"Returned: "}),a&&t.jsx("span",{className:"font-bold",children:"Rejected: "}),!u&&!m&&!g&&(s||l||x||i)&&t.jsx("span",{className:"font-bold",children:s?"Unit Approved: ":l?"Unit Endorsed: ":x?"Installation Approved: ":"Installation Endorsed: "}),!u&&m&&x&&t.jsx("span",{className:"font-bold",children:"Installation Approved: "}),!u&&m&&!x&&i&&t.jsx("span",{className:"font-bold",children:"Installation Endorsed: "}),!u&&!m&&g&&k(e)&&t.jsx("span",{className:"font-bold",children:"HQMC Approved: "}),u?t.jsx("span",{className:"inline-block w-40 h-4 bg-gray-100 animate-pulse rounded"}):e.subject]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-24 h-5 bg-gray-100 animate-pulse rounded"}):(()=>{const{level:p,scope:B}=D(e);return B?t.jsxs("span",{className:"inline-flex flex-col items-center px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-lg border border-brand-navy/30 leading-tight",children:[t.jsx("span",{children:p}),t.jsx("span",{className:"text-[10px]",children:B})]}):t.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:p})})()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):m?U(e):M(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:(()=>{const p=v(e);return u?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):p?`${p.rank} ${p.lastName}, ${p.firstName}`:"N/A"})()}),!m&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):_(b==null?void 0:b.company)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):_(b==null?void 0:b.platoon)})]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):new Date(e.createdAt).toLocaleDateString()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):$(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:u?t.jsx("span",{className:"inline-block w-24 h-6 bg-gray-100 animate-pulse rounded"}):t.jsxs("button",{onClick:p=>{p.stopPropagation(),L(C)},className:"px-2 py-1 text-xs bg-brand-navy text-brand-cream rounded hover:bg-brand-red-2",children:["Contacts (",C.length,")"]})})]}),Y[e.id]&&t.jsx("tr",{children:t.jsx("td",{colSpan:m?7:9,className:"p-4 bg-gray-50",children:q(e)})})]},e.id)}),n.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"p-3 text-sm text-center text-[var(--muted)]",children:"No requests to display."})})]})]})}),S&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",onClick:()=>L(null),children:t.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Contacts at Current Action Level"}),t.jsx("button",{onClick:()=>L(null),className:"text-[var(--muted)] hover:text-[var(--text)]",children:"✕"})]}),t.jsx("div",{className:"space-y-3",children:S.length===0?t.jsx("p",{className:"text-sm text-[var(--muted)]",children:"No contacts found at this action level."}):S.map(e=>t.jsx("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-[var(--text)]",children:[e.rank," ",e.lastName,", ",e.firstName," ",e.mi||""]}),t.jsx("div",{className:"text-sm text-[var(--muted)] mt-1",children:e.email||"No email provided"}),e.company&&e.company!=="N/A"&&t.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["Company: ",e.company,e.platoon&&e.platoon!=="N/A"&&` • Platoon: ${e.platoon}`]})]})})},e.id))})]})})]})};export{ve as R,H as S,xe as a,Ee as b,ue as c,pe as d,j as e,oe as f,Ne as g,fe as h,R as i,me as o};
