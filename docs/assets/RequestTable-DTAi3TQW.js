import{r as V,j as t,R as re}from"./index-B4eXSaOw.js";var B=(n=>(n.PLATOON_REVIEW="PLATOON_REVIEW",n.COMPANY_REVIEW="COMPANY_REVIEW",n.BATTALION_REVIEW="BATTALION_REVIEW",n.COMMANDER_REVIEW="COMMANDER_REVIEW",n.INSTALLATION_REVIEW="INSTALLATION_REVIEW",n.HQMC_REVIEW="HQMC_REVIEW",n.EXTERNAL_REVIEW="EXTERNAL_REVIEW",n.ORIGINATOR_REVIEW="ORIGINATOR_REVIEW",n.ARCHIVED="ARCHIVED",n))(B||{});function oe(n){const r=String(n.currentStage||"PLATOON_REVIEW");return r==="PLATOON_REVIEW"?"Platoon":r==="COMPANY_REVIEW"?"Company":r==="BATTALION_REVIEW"?n.routeSection||"Battalion":r==="COMMANDER_REVIEW"?n.routeSection||"Commander":r==="INSTALLATION_REVIEW"?n.routeSection?`Installation - ${n.routeSection}`:"Installation Commander":r==="HQMC_REVIEW"?n.routeSection?`HQMC - ${n.routeSection}`:"HQMC":r==="EXTERNAL_REVIEW"?n.externalPendingUnitName||"External":r==="ARCHIVED"?"Archived":r}function ce(n){const r=Array.isArray(n.activity)?n.activity:[];return r.length?r[r.length-1]:null}function le(n){const r=ce(n);return!!r&&/returned/i.test(String(r.action||""))}function A(n,r){return(n.activity||[]).some(p=>r.test(String(p.action||"")))}function R(n){return A(n,/(approved by commander|commander.*approved)/i)&&!A(n,/installation commander/i)}function C(n){return A(n,/(endorsed by commander|commander.*endorsed)/i)&&!A(n,/installation commander/i)}function ue(n,r){if(!(String(n.uploadedById||"")===String(r||"")))return!1;const v=String(n.currentStage||"PLATOON_REVIEW");return v==="PLATOON_REVIEW"||v==="COMPANY_REVIEW"||v==="BATTALION_REVIEW"?!0:v==="ORIGINATOR_REVIEW"&&(R(n)||C(n))?!1:le(n)}function me(n,r){return String(n.uploadedById||"")===String(r||"")?String(n.currentStage||"")==="ORIGINATOR_REVIEW"&&(R(n)||C(n)):!1}function F(n){return A(n,/installation commander.*approved/i)}function Q(n){return A(n,/installation commander.*endorsed/i)}function ie(n){return A(n,/(hqmc.*approved|approved.*hqmc)/i)}function pe(n,r){return!(!(String(n.uploadedById||"")===String(r||""))||R(n)||C(n)||F(n)||Q(n)||String(n.currentStage||"")==="ARCHIVED")}function xe(n,r){const p=String(n.currentStage||"");if(p==="ARCHIVED")return!1;switch(r.userLevel){case"originator":return p==="ORIGINATOR_REVIEW"&&(R(n)||C(n));case"unit":return p!=="BATTALION_REVIEW"||!R(n)&&!C(n)?!1:r.userUnitUic===n.unitUic;case"installation":return!F(n)&&!Q(n)?!1:r.userInstallationId===n.installationId;case"hqmc":return ie(n);case"external":return!1;default:return!1}}const Ne=({requests:n,users:r,onRowClick:p,title:v,titleActions:T,expandedRows:q,children:G,platoonSectionMap:W,variant:Y="default"})=>{const[S,w]=V.useState(null),u=Y==="installation",[o,b]=V.useState({subject:"",status:"",unit:"",originator:"",company:"",platoon:"",created:"",lastStatus:""}),j=V.useMemo(()=>Object.values(r),[r]),h=e=>r[e.uploadedById]||null,_=e=>e&&e!=="N/A"?e:"—",L=e=>{var y,I;const c=N=>String(N||"").trim().replace(/^S(\d)\b/,"S-$1");if(e.routeSection)return c(e.routeSection);if(!W)return"";const a=e.unitUic||"",s=r[e.uploadedById];if(!s)return"";const l=N=>N&&N!=="N/A"?N:"",x=l(s.company),i=l(s.platoon),g=((I=(y=W[a])==null?void 0:y[x])==null?void 0:I[i])||"";return c(g)},X=e=>oe(e),k=(e,c)=>{var s;const a=(s=e.activity)==null?void 0:s[e.activity.length-1];return!!a&&c.test(a.action||"")},z=e=>k(e,/returned/i),J=e=>k(e,/rejected/i),E=(e,c)=>{var a;return((a=e.activity)==null?void 0:a.some(s=>c.test(String(s.action||""))))||!1},K=e=>E(e,/(approved by commander|commander.*approved)/i)&&!E(e,/installation commander/i),Z=e=>E(e,/(endorsed by commander|commander.*endorsed)/i)&&!E(e,/installation commander/i),ee=e=>E(e,/(approved by installation commander|installation commander.*approved|installation.*approved)/i),te=e=>E(e,/(endorsed by installation commander|installation commander.*endorsed|installation.*endorsed)/i),P=e=>E(e,/hqmc.*approved/i),U=e=>{if((e.currentStage||"PLATOON_REVIEW")==="EXTERNAL_REVIEW")return e.externalPendingUnitName||"External Unit";const a=h(e);return(a==null?void 0:a.unit)||e.unitUic||"N/A"},M=e=>{const c=h(e),a=e.unitUic||(c==null?void 0:c.unitUic)||"",s=(c==null?void 0:c.unit)||"";return a&&s?`${a} • ${s}`:a||s||"N/A"},ne=e=>{switch(e.currentStage||"PLATOON_REVIEW"){case"PLATOON_REVIEW":{const a=h(e);return a?j.filter(s=>s.unitUic===e.unitUic&&s.company===a.company&&s.platoon===a.platoon):[]}case"COMPANY_REVIEW":{const a=h(e);return a?j.filter(s=>s.unitUic===e.unitUic&&s.company===a.company):[]}case"BATTALION_REVIEW":{const a=L(e);return j.filter(s=>s.unitUic===e.unitUic&&s.company===a)}case"COMMANDER_REVIEW":return e.routeSection?j.filter(a=>a.unitUic===e.unitUic&&a.company===e.routeSection):j.filter(a=>a.unitUic===e.unitUic&&(a.role==="COMMANDER"||a.company==="HQ"));case"INSTALLATION_REVIEW":{const a=L(e);return j.filter(s=>s.unitUic===e.unitUic&&s.company===a)}default:return[]}},$=e=>{const c=e.activity&&e.activity.length?e.activity[e.activity.length-1].timestamp:e.createdAt;try{return new Date(c).toLocaleDateString()}catch{return e.createdAt}},ae=e=>{try{const c=localStorage.getItem("installations_cache")||"[]",a=JSON.parse(c);if(Array.isArray(a)){const s=a.find(l=>String(l.id)===String(e||""));return s?String(s.name||""):""}}catch{}return""},D=e=>{const c=e.currentStage||"PLATOON_REVIEW",a=h(e);switch(c){case"ORIGINATOR_REVIEW":return{level:"Member",scope:""};case"PLATOON_REVIEW":{const s=a!=null&&a.company&&a.company!=="N/A"?a.company:"",l=a!=null&&a.platoon&&a.platoon!=="N/A"?a.platoon:"";return s&&l?{level:"Platoon",scope:`(${s}-${l})`}:s?{level:"Platoon",scope:`(${s})`}:{level:"Platoon Review",scope:""}}case"COMPANY_REVIEW":{const s=a!=null&&a.company&&a.company!=="N/A"?a.company:"";return{level:"Company",scope:s?`(${s})`:""}}case"BATTALION_REVIEW":{const s=L(e);return{level:"Battalion",scope:s?`(${s})`:""}}case"COMMANDER_REVIEW":return{level:"Commander",scope:e.routeSection?`(${e.routeSection})`:""};case"INSTALLATION_REVIEW":{const s=ae(e.installationId),l=e.routeSection||"";return s&&l?{level:s,scope:`(${l})`}:{level:s||"Installation",scope:""}}case"HQMC_REVIEW":{const s=e.routeSection||"";return{level:"HQMC",scope:s?`(${s})`:""}}case"EXTERNAL_REVIEW":{const s=e.externalPendingUnitName||"",l=e.routeSection||"";return s&&l?{level:s,scope:`(${l})`}:{level:s||"External",scope:""}}case"ARCHIVED":return{level:"Archived",scope:""};default:return{level:X(e),scope:""}}},se=e=>{const{level:c,scope:a}=D(e);return a?`${c} ${a}`:c};return t.jsxs("div",{children:[t.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3 flex items-center",children:[v,T?t.jsx("span",{className:"ml-auto inline-flex items-center gap-2 align-middle",children:T}):null]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-[var(--surface)] border border-brand-navy/20",children:[t.jsx("thead",{className:"bg-brand-cream border-b border-brand-navy/20",children:t.jsxs("tr",{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Subject"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Unit"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Originator"}),!u&&t.jsxs(t.Fragment,{children:[t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Company"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Platoon"})]}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Created"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Last Status"}),t.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Actions"})]})}),t.jsxs("tbody",{children:[t.jsxs("tr",{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.subject,onChange:e=>b({...o,subject:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.status,onChange:e=>b({...o,status:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.unit,onChange:e=>b({...o,unit:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.originator,onChange:e=>b({...o,originator:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),!u&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.company,onChange:e=>b({...o,company:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.platoon,onChange:e=>b({...o,platoon:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})})]}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.created,onChange:e=>b({...o,created:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2",children:t.jsx("input",{value:o.lastStatus,onChange:e=>b({...o,lastStatus:e.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),t.jsx("td",{className:"p-2"})]}),n.filter(e=>{const c=!o.subject||String(e.subject||"").toLowerCase().includes(o.subject.toLowerCase()),a=se(e),s=!o.status||a.toLowerCase().includes(o.status.toLowerCase()),l=u?M(e):U(e),x=!o.unit||l.toLowerCase().includes(o.unit.toLowerCase()),i=h(e),g=i?`${i.rank||""} ${i.lastName||""} ${i.firstName||""}`.trim():"",y=!o.originator||g.toLowerCase().includes(o.originator.toLowerCase()),I=u||!o.company||(i!=null&&i.company?i.company.toLowerCase().includes(o.company.toLowerCase()):!1),N=u||!o.platoon||(i!=null&&i.platoon?i.platoon.toLowerCase().includes(o.platoon.toLowerCase()):!1),f=new Date(e.createdAt).toLocaleDateString(),O=!o.created||f.toLowerCase().includes(o.created.toLowerCase()),d=$(e),m=!o.lastStatus||d.toLowerCase().includes(o.lastStatus.toLowerCase());return c&&s&&x&&y&&I&&N&&O&&m}).map(e=>{const c=z(e),a=J(e),s=K(e),l=Z(e),x=ee(e),i=te(e),g=(e.currentStage||"")===B.HQMC_REVIEW,y=s||l||x||i,I=u?x||i:g?P(e):y,N=a||c&&!y,f=h(e),O=ne(e),d=!e.subject&&!e.uploadedById&&(e.documentIds||[]).length===0;return t.jsxs(re.Fragment,{children:[t.jsxs("tr",{className:`border-b border-brand-navy/20 hover:bg-brand-cream/50 cursor-pointer ${N?"bg-red-100":I?"bg-green-100":""}`,onClick:()=>p(e),children:[t.jsxs("td",{className:`p-3 text-sm ${N?"text-red-700 font-bold":I?"text-green-700 font-bold":"text-[var(--text)]"}`,children:[c&&t.jsx("span",{className:"font-bold",children:"Returned: "}),a&&t.jsx("span",{className:"font-bold",children:"Rejected: "}),!d&&!u&&!g&&(s||l||x||i)&&t.jsx("span",{className:"font-bold",children:s?"Unit Approved: ":l?"Unit Endorsed: ":x?"Installation Approved: ":"Installation Endorsed: "}),!d&&u&&x&&t.jsx("span",{className:"font-bold",children:"Installation Approved: "}),!d&&u&&!x&&i&&t.jsx("span",{className:"font-bold",children:"Installation Endorsed: "}),!d&&!u&&g&&P(e)&&t.jsx("span",{className:"font-bold",children:"HQMC Approved: "}),d?t.jsx("span",{className:"inline-block w-40 h-4 bg-gray-100 animate-pulse rounded"}):e.subject]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-24 h-5 bg-gray-100 animate-pulse rounded"}):(()=>{const{level:m,scope:H}=D(e);return H?t.jsxs("span",{className:"inline-flex flex-col items-center px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-lg border border-brand-navy/30 leading-tight",children:[t.jsx("span",{children:m}),t.jsx("span",{className:"text-[10px]",children:H})]}):t.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:m})})()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):u?M(e):U(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:(()=>{const m=h(e);return d?t.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):m?`${m.rank} ${m.lastName}, ${m.firstName}`:"N/A"})()}),!u&&t.jsxs(t.Fragment,{children:[t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):_(f==null?void 0:f.company)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):_(f==null?void 0:f.platoon)})]}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):new Date(e.createdAt).toLocaleDateString()}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):$(e)}),t.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:d?t.jsx("span",{className:"inline-block w-24 h-6 bg-gray-100 animate-pulse rounded"}):t.jsxs("button",{onClick:m=>{m.stopPropagation(),w(O)},className:"px-2 py-1 text-xs bg-brand-navy text-brand-cream rounded hover:bg-brand-red-2",children:["Contacts (",O.length,")"]})})]}),q[e.id]&&t.jsx("tr",{children:t.jsx("td",{colSpan:u?7:9,className:"p-4 bg-gray-50",children:G(e)})})]},e.id)}),n.length===0&&t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"p-3 text-sm text-center text-[var(--muted)]",children:"No requests to display."})})]})]})}),S&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",onClick:()=>w(null),children:t.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Contacts at Current Action Level"}),t.jsx("button",{onClick:()=>w(null),className:"text-[var(--muted)] hover:text-[var(--text)]",children:"✕"})]}),t.jsx("div",{className:"space-y-3",children:S.length===0?t.jsx("p",{className:"text-sm text-[var(--muted)]",children:"No contacts found at this action level."}):S.map(e=>t.jsx("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:t.jsx("div",{className:"flex items-start justify-between",children:t.jsxs("div",{children:[t.jsxs("div",{className:"font-semibold text-[var(--text)]",children:[e.rank," ",e.lastName,", ",e.firstName," ",e.mi||""]}),t.jsx("div",{className:"text-sm text-[var(--muted)] mt-1",children:e.email||"No email provided"}),e.company&&e.company!=="N/A"&&t.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["Company: ",e.company,e.platoon&&e.platoon!=="N/A"&&` • Platoon: ${e.platoon}`]})]})})},e.id))})]})})]})};export{Ne as R,B as S,ue as a,xe as b,pe as c,oe as f,me as o};
