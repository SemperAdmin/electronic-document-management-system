import{r as w,j as e,R as et}from"./index-DS4fb1BX.js";var $=(s=>(s.PLATOON_REVIEW="PLATOON_REVIEW",s.COMPANY_REVIEW="COMPANY_REVIEW",s.BATTALION_REVIEW="BATTALION_REVIEW",s.COMMANDER_REVIEW="COMMANDER_REVIEW",s.INSTALLATION_REVIEW="INSTALLATION_REVIEW",s.HQMC_REVIEW="HQMC_REVIEW",s.EXTERNAL_REVIEW="EXTERNAL_REVIEW",s.ORIGINATOR_REVIEW="ORIGINATOR_REVIEW",s.ARCHIVED="ARCHIVED",s))($||{});function nt(s){const c=String(s.currentStage||"PLATOON_REVIEW");return c==="PLATOON_REVIEW"?"Platoon":c==="COMPANY_REVIEW"?"Company":c==="BATTALION_REVIEW"?s.routeSection||"Battalion":c==="COMMANDER_REVIEW"?s.routeSection||"Commander":c==="INSTALLATION_REVIEW"?s.routeSection?`Installation - ${s.routeSection}`:"Installation Commander":c==="HQMC_REVIEW"?s.routeSection?`HQMC - ${s.routeSection}`:"HQMC":c==="EXTERNAL_REVIEW"?s.externalPendingUnitName||"External":c==="ARCHIVED"?"Archived":c}function at(s){const c=Array.isArray(s.activity)?s.activity:[];return c.length?c[c.length-1]:null}function st(s){const c=at(s);return!!c&&/returned/i.test(String(c.action||""))}function R(s,c){return(s.activity||[]).some(A=>c.test(String(A.action||"")))}function D(s){return R(s,/(approved by commander|commander.*approved)/i)&&!R(s,/installation commander/i)}function H(s){return R(s,/(endorsed by commander|commander.*endorsed)/i)&&!R(s,/installation commander/i)}function ot(s,c){if(!(String(s.uploadedById||"")===String(c||"")))return!1;const E=String(s.currentStage||"PLATOON_REVIEW");return E==="PLATOON_REVIEW"||E==="COMPANY_REVIEW"||E==="BATTALION_REVIEW"?!0:E==="ORIGINATOR_REVIEW"&&(D(s)||H(s))?!1:st(s)}function ct(s,c){return String(s.uploadedById||"")===String(c||"")?String(s.currentStage||"")==="ORIGINATOR_REVIEW"&&(D(s)||H(s)):!1}const it=({requests:s,users:c,onRowClick:A,title:E,titleActions:L,expandedRows:F,children:B,platoonSectionMap:V,variant:Q="default"})=>{const[C,O]=w.useState(null),d=Q==="installation",[o,N]=w.useState({subject:"",status:"",unit:"",originator:"",company:"",platoon:"",created:"",lastStatus:""}),j=w.useMemo(()=>Object.values(c),[c]),p=t=>c[t.uploadedById]||null,T=t=>t&&t!=="N/A"?t:"—",S=t=>{var g,y;const r=x=>String(x||"").trim().replace(/^S(\d)\b/,"S-$1");if(t.routeSection)return r(t.routeSection);if(!V)return"";const n=t.unitUic||"",a=c[t.uploadedById];if(!a)return"";const u=x=>x&&x!=="N/A"?x:"",m=u(a.company),i=u(a.platoon),f=((y=(g=V[n])==null?void 0:g[m])==null?void 0:y[i])||"";return r(f)},Y=t=>nt(t),W=(t,r)=>{var a;const n=(a=t.activity)==null?void 0:a[t.activity.length-1];return!!n&&r.test(n.action||"")},G=t=>W(t,/returned/i),X=t=>W(t,/rejected/i),v=(t,r)=>{var n;return((n=t.activity)==null?void 0:n.some(a=>r.test(String(a.action||""))))||!1},q=t=>v(t,/(approved by commander|commander.*approved)/i)&&!v(t,/installation commander/i),z=t=>v(t,/(endorsed by commander|commander.*endorsed)/i)&&!v(t,/installation commander/i),J=t=>v(t,/(approved by installation commander|installation commander.*approved|installation.*approved)/i),K=t=>v(t,/(endorsed by installation commander|installation commander.*endorsed|installation.*endorsed)/i),_=t=>v(t,/hqmc.*approved/i),k=t=>{if((t.currentStage||"PLATOON_REVIEW")==="EXTERNAL_REVIEW")return t.externalPendingUnitName||"External Unit";const n=p(t);return(n==null?void 0:n.unit)||t.unitUic||"N/A"},P=t=>{const r=p(t),n=t.unitUic||(r==null?void 0:r.unitUic)||"",a=(r==null?void 0:r.unit)||"";return n&&a?`${n} • ${a}`:n||a||"N/A"},Z=t=>{switch(t.currentStage||"PLATOON_REVIEW"){case"PLATOON_REVIEW":{const n=p(t);return n?j.filter(a=>a.unitUic===t.unitUic&&a.company===n.company&&a.platoon===n.platoon):[]}case"COMPANY_REVIEW":{const n=p(t);return n?j.filter(a=>a.unitUic===t.unitUic&&a.company===n.company):[]}case"BATTALION_REVIEW":{const n=S(t);return j.filter(a=>a.unitUic===t.unitUic&&a.company===n)}case"COMMANDER_REVIEW":return t.routeSection?j.filter(n=>n.unitUic===t.unitUic&&n.company===t.routeSection):j.filter(n=>n.unitUic===t.unitUic&&(n.role==="COMMANDER"||n.company==="HQ"));case"INSTALLATION_REVIEW":{const n=S(t);return j.filter(a=>a.unitUic===t.unitUic&&a.company===n)}default:return[]}},M=t=>{const r=t.activity&&t.activity.length?t.activity[t.activity.length-1].timestamp:t.createdAt;try{return new Date(r).toLocaleDateString()}catch{return t.createdAt}},tt=t=>{try{const r=localStorage.getItem("installations_cache")||"[]",n=JSON.parse(r);if(Array.isArray(n)){const a=n.find(u=>String(u.id)===String(t||""));return a?String(a.name||""):""}}catch{}return""},U=t=>{const r=t.currentStage||"PLATOON_REVIEW";if(r==="ORIGINATOR_REVIEW")return"Member";if(r==="PLATOON_REVIEW"){const n=p(t),a=n!=null&&n.company&&n.company!=="N/A"?n.company:"",u=n!=null&&n.platoon&&n.platoon!=="N/A"?n.platoon:"";return a&&u?`${a}-${u}`:a||"Platoon"}if(r==="COMPANY_REVIEW"){const n=p(t),a=n!=null&&n.company&&n.company!=="N/A"?n.company:"";return a?`Company ${a}`:"Company"}if(r==="BATTALION_REVIEW")return S(t)||"Battalion";if(r==="COMMANDER_REVIEW")return t.routeSection?t.routeSection:"Commander";if(r==="INSTALLATION_REVIEW"){const n=tt(t.installationId),a=t.routeSection||"";return n&&a?`${n} - ${a}`:n||"Installation"}if(r==="HQMC_REVIEW"){const n=t.routeSection||"";return n?`HQMC - ${n}`:"HQMC"}if(r==="EXTERNAL_REVIEW"){const n=t.externalPendingUnitName||"",a=t.routeSection||"";return n&&a?`${n} - ${a}`:n||"External"}return r==="ARCHIVED"?"Archived":Y(t)};return e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-[var(--text)] mb-3 flex items-center",children:[E,L?e.jsx("span",{className:"ml-auto inline-flex items-center gap-2 align-middle",children:L}):null]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full bg-[var(--surface)] border border-brand-navy/20",children:[e.jsx("thead",{className:"bg-brand-cream border-b border-brand-navy/20",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Subject"}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Unit"}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Originator"}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Company"}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Platoon"})]}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Created"}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Last Status"}),e.jsx("th",{className:"p-3 text-left text-xs font-semibold text-brand-navy uppercase tracking-wider",children:"Actions"})]})}),e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.subject,onChange:t=>N({...o,subject:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.status,onChange:t=>N({...o,status:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.unit,onChange:t=>N({...o,unit:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.originator,onChange:t=>N({...o,originator:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.company,onChange:t=>N({...o,company:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.platoon,onChange:t=>N({...o,platoon:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})})]}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.created,onChange:t=>N({...o,created:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),e.jsx("td",{className:"p-2",children:e.jsx("input",{value:o.lastStatus,onChange:t=>N({...o,lastStatus:t.target.value}),placeholder:"Filter",className:"w-full px-2 py-1 border border-brand-navy/20 rounded text-xs"})}),e.jsx("td",{className:"p-2"})]}),s.filter(t=>{const r=!o.subject||String(t.subject||"").toLowerCase().includes(o.subject.toLowerCase()),n=U(t),a=!o.status||n.toLowerCase().includes(o.status.toLowerCase()),u=d?P(t):k(t),m=!o.unit||u.toLowerCase().includes(o.unit.toLowerCase()),i=p(t),f=i?`${i.rank||""} ${i.lastName||""} ${i.firstName||""}`.trim():"",g=!o.originator||f.toLowerCase().includes(o.originator.toLowerCase()),y=d||!o.company||(i!=null&&i.company?i.company.toLowerCase().includes(o.company.toLowerCase()):!1),x=d||!o.platoon||(i!=null&&i.platoon?i.platoon.toLowerCase().includes(o.platoon.toLowerCase()):!1),b=new Date(t.createdAt).toLocaleDateString(),I=!o.created||b.toLowerCase().includes(o.created.toLowerCase()),l=M(t),h=!o.lastStatus||l.toLowerCase().includes(o.lastStatus.toLowerCase());return r&&a&&m&&g&&y&&x&&I&&h}).map(t=>{const r=G(t),n=X(t),a=q(t),u=z(t),m=J(t),i=K(t),f=(t.currentStage||"")===$.HQMC_REVIEW,g=a||u||m||i,y=d?m||i:f?_(t):g,x=n||r&&!g,b=p(t),I=Z(t),l=!t.subject&&!t.uploadedById&&(t.documentIds||[]).length===0;return e.jsxs(et.Fragment,{children:[e.jsxs("tr",{className:`border-b border-brand-navy/20 hover:bg-brand-cream/50 cursor-pointer ${x?"bg-red-100":y?"bg-green-100":""}`,onClick:()=>A(t),children:[e.jsxs("td",{className:`p-3 text-sm ${x?"text-red-700 font-bold":y?"text-green-700 font-bold":"text-[var(--text)]"}`,children:[r&&e.jsx("span",{className:"font-bold",children:"Returned: "}),n&&e.jsx("span",{className:"font-bold",children:"Rejected: "}),!l&&!d&&!f&&(a||u||m||i)&&e.jsx("span",{className:"font-bold",children:a?"Unit Approved: ":u?"Unit Endorsed: ":m?"Installation Approved: ":"Installation Endorsed: "}),!l&&d&&m&&e.jsx("span",{className:"font-bold",children:"Installation Approved: "}),!l&&d&&!m&&i&&e.jsx("span",{className:"font-bold",children:"Installation Endorsed: "}),!l&&!d&&f&&_(t)&&e.jsx("span",{className:"font-bold",children:"HQMC Approved: "}),l?e.jsx("span",{className:"inline-block w-40 h-4 bg-gray-100 animate-pulse rounded"}):t.subject]}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-24 h-5 bg-gray-100 animate-pulse rounded"}):e.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:U(t)})}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):d?P(t):k(t)}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:(()=>{const h=p(t);return l?e.jsx("span",{className:"inline-block w-28 h-4 bg-gray-100 animate-pulse rounded"}):h?`${h.rank} ${h.lastName}, ${h.firstName}`:"N/A"})()}),!d&&e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):T(b==null?void 0:b.company)}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-16 h-4 bg-gray-100 animate-pulse rounded"}):T(b==null?void 0:b.platoon)})]}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-20 h-4 bg-gray-100 animate-pulse rounded"}):M(t)}),e.jsx("td",{className:"p-3 text-sm text-[var(--text)]",children:l?e.jsx("span",{className:"inline-block w-24 h-6 bg-gray-100 animate-pulse rounded"}):e.jsxs("button",{onClick:h=>{h.stopPropagation(),O(I)},className:"px-2 py-1 text-xs bg-brand-navy text-brand-cream rounded hover:bg-brand-red-2",children:["Contacts (",I.length,")"]})})]}),F[t.id]&&e.jsx("tr",{children:e.jsx("td",{colSpan:d?7:9,className:"p-4 bg-gray-50",children:B(t)})})]},t.id)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"p-3 text-sm text-center text-[var(--muted)]",children:"No requests to display."})})]})]})}),C&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50",onClick:()=>O(null),children:e.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Contacts at Current Action Level"}),e.jsx("button",{onClick:()=>O(null),className:"text-[var(--muted)] hover:text-[var(--text)]",children:"✕"})]}),e.jsx("div",{className:"space-y-3",children:C.length===0?e.jsx("p",{className:"text-sm text-[var(--muted)]",children:"No contacts found at this action level."}):C.map(t=>e.jsx("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{children:[e.jsxs("div",{className:"font-semibold text-[var(--text)]",children:[t.rank," ",t.lastName,", ",t.firstName," ",t.mi||""]}),e.jsx("div",{className:"text-sm text-[var(--muted)] mt-1",children:t.email||"No email provided"}),t.company&&t.company!=="N/A"&&e.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["Company: ",t.company,t.platoon&&t.platoon!=="N/A"&&` • Platoon: ${t.platoon}`]})]})})},t.id))})]})})]})};export{it as R,$ as S,ot as c,nt as f,ct as o};
