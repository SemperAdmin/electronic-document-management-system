import{r,j as a}from"./index-xHn_P-Bz.js";import{l as Xe}from"./unitStructure-QC5qYuxv.js";import{U as Je}from"./units-CaNgy_2U.js";import{w as Ke,k as ze,p as Ge,c as Ye,l as Ze,e as et,f as tt,u as w}from"./db-DSOMgj82.js";import{R as he,b as nt}from"./RequestTable-BQRvpxUP.js";import{S as it}from"./SearchableUnitSelector-C9x1_GpY.js";import{a as ye}from"./DocumentListItem-B5mLtxnR.js";function U(c,k="Unknown"){if(!c)return k;const{rank:v="",lastName:p="",firstName:W="",mi:h}=c;return`${v} ${p}, ${W}${h?` ${h}`:""}`.trim()||k}const at="REVIEW";function vt(){const[c,k]=r.useState(null),[v,p]=r.useState([]),[W,h]=r.useState([]),[C,ee]=r.useState({}),[R,Se]=r.useState({}),[V,fe]=r.useState({}),[je,Ne]=r.useState({}),[b,Ae]=r.useState(""),[g,y]=r.useState({}),[I,te]=r.useState({}),[Ee,we]=r.useState({}),[ne,ie]=r.useState({}),[ae,se]=r.useState({}),[st,ot]=r.useState({}),[ct,dt]=r.useState({}),[Q,Ue]=r.useState({}),[Ce,X]=r.useState({}),[_,J]=r.useState({}),[oe,O]=r.useState({}),[ce,de]=r.useState({}),[x,S]=r.useState({}),[D,f]=r.useState(null),L=r.useRef(null),[T,re]=r.useState("Pending"),[K,Re]=r.useState([]),[j,P]=r.useState({}),[le,Ie]=r.useState({}),[z,q]=r.useState({}),[N,B]=r.useState({}),[De,ue]=r.useState([]),[$e,me]=r.useState([]),[$,Me]=r.useState({}),[G,xe]=r.useState({});r.useEffect(()=>{Ke().then(e=>Re(e)),ze().then(ue).catch(()=>ue([])),Ge().then(me).catch(()=>me([]))},[]),r.useEffect(()=>{const e=t=>{D&&L.current&&!L.current.contains(t.target)&&(S(n=>({...n,[D]:!1})),f(null))},i=t=>{t.key==="Escape"&&D&&(S(n=>({...n,[D]:!1})),f(null))};return document.addEventListener("mousedown",e),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",i)}},[D]),r.useEffect(()=>{try{const e=localStorage.getItem("currentUser");e&&k(JSON.parse(e))}catch{}},[]),r.useEffect(()=>{var e,i;try{const t=(c==null?void 0:c.unitUic)||"",n=c!=null&&c.company&&c.company!=="N/A"?c.company:"",o=c!=null&&c.platoon&&c.platoon!=="N/A"?c.platoon:"",d=((i=(e=R[t])==null?void 0:e[n])==null?void 0:i[o])||"";Ae(d)}catch{}},[c,R]),r.useEffect(()=>{Ye().then(e=>{p(e)}).catch(()=>p([]))},[]),r.useEffect(()=>{Ze().then(e=>{h(e)}).catch(()=>h([]))},[]),r.useEffect(()=>{et().then(e=>{const i={};for(const t of e)i[t.id]=t;ee(i)}).catch(()=>ee({}))},[]),r.useEffect(()=>{try{const e=localStorage.getItem("unit_structure"),i={},t={},n={};if(e){const o=JSON.parse(e);for(const d of Object.keys(o||{})){const s=o[d];s&&s._platoonSectionMap&&typeof s._platoonSectionMap=="object"&&(i[d]=s._platoonSectionMap),s&&Array.isArray(s._sections)&&(t[d]=s._sections),s&&Array.isArray(s._commandSections)&&(n[d]=s._commandSections)}}else(async()=>{try{const o=await Xe();for(const d of Object.keys(o||{})){const s=o[d];s&&s._platoonSectionMap&&typeof s._platoonSectionMap=="object"&&(i[d]=s._platoonSectionMap),s&&Array.isArray(s._sections)&&(t[d]=s._sections),s&&Array.isArray(s._commandSections)&&(n[d]=s._commandSections)}}catch{}})();Se(i),Ne(t),we(n)}catch{}},[]);const pe=r.useMemo(()=>{const e=(c==null?void 0:c.unitUic)||"";return v.filter(i=>{const n=(i.currentStage||"")==="EXTERNAL_REVIEW"?i.externalPendingUnitUic||i.unitUic||"":i.unitUic||"";return!!A(i)&&(e?n===e:!0)})},[v,c,A]),be=r.useMemo(()=>{const e=i=>String(i||"").trim().replace(/^S(\d)\b/,"S-$1");return pe.filter(i=>{const t=e(A(i)),n=e(b);return b?t===n:!0})},[pe,b,A]),ve=r.useMemo(()=>be.filter(e=>(e.currentStage||"")==="BATTALION_REVIEW"),[be]),ge=r.useMemo(()=>{const e=t=>String(t||"").trim().replace(/^S(\d)\b/,"S-$1"),i=e(b);return i?v.filter(t=>{var l,m;const n=t.currentStage||"",o=(c==null?void 0:c.unitUic)||"",d=n==="EXTERNAL_REVIEW"?t.externalPendingUnitUic||t.unitUic||"":t.unitUic||"";if(o&&d!==o||n==="BATTALION_REVIEW"&&e(A(t))===i)return!1;const s=(l=t.activity)==null?void 0:l.some(E=>{const M=String(E.action||"");return M.includes(i)||M.includes(b)}),u=(m=t.activity)==null?void 0:m.some(E=>{const M=String(E.action||"");return M.includes(`routed to ${i}`)||M.includes(`routed to ${b}`)});return s||u}):[]},[v,c,b]);function A(e){var u,l;const i=m=>String(m||"").trim().replace(/^S(\d)\b/,"S-$1");if(e.routeSection)return i(e.routeSection);const t=e.unitUic||"",n=C[e.uploadedById],o=n!=null&&n.company&&n.company!=="N/A"?n.company:"",d=n!=null&&n.platoon&&n.platoon!=="N/A"?n.platoon:"",s=((l=(u=R[t])==null?void 0:u[o])==null?void 0:l[d])||"";return i(s)}const ke=e=>{const i=C[e.uploadedById];return i?[i.rank,i.lastName+",",i.firstName,i.mi?i.mi:""].filter(Boolean).join(" ").trim():"—"},Y=e=>W.filter(i=>i.requestId===e),_e=e=>`"${String(e??"").replace(/"/g,'""')}"`,Oe=e=>{const t=[["Request ID","Subject","Stage","Battalion Section","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const n of e){const o=Y(n.id).map(d=>d.name).join(" | ");t.push([n.id,n.subject,n.currentStage||"",A(n)||"",n.routeSection||"",ke(n),n.unitUic||"",new Date(n.createdAt).toLocaleString(),o])}return t.map(n=>n.map(_e).join(",")).join(`\r
`)},Le=(e,i)=>{const t=new Blob([i],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)},Te=()=>Le("battalion_all.csv",Oe([...ve,...ge])),Pe=async e=>{const i=I[e.id]||[];if(!i.length||!(c!=null&&c.id))return;const t=Date.now(),n=i.map((l,m)=>({id:`${t}-${m}`,name:l.name,type:l.type,size:l.size,uploadedAt:new Date().toISOString(),subject:e.subject,requestId:e.id})),o=U(c,"Reviewer"),d=F(),s={actor:o,actorRole:d,timestamp:new Date().toISOString(),action:`Reviewer added ${n.length} document(s)`,comment:(g[e.id]||"").trim()},u={...e,documentIds:[...e.documentIds||[],...n.map(l=>l.id)],activity:Array.isArray(e.activity)?[...e.activity,s]:[s]};try{await tt(n),await w(u),h(l=>[...l,...n]),p(l=>l.map(m=>m.id===u.id?u:m))}catch(l){console.error("Failed to add files to request:",l)}te(l=>({...l,[e.id]:[]})),y(l=>({...l,[e.id]:""}))},F=()=>{const e=b||"";return e?`Battalion (${e})`:"Battalion"},H=e=>{const i=e==null?void 0:e.trim();return i?K.some(t=>{const n=t.unit_uics||t.unitUics||[];return Array.isArray(n)&&n.includes(i)}):!1},qe=e=>{const i=(e.activity||[]).slice().reverse().find(t=>/Commander/i.test(String(t.action||"")));return!!i&&/(Approved|Endorsed)/i.test(String(i.action||""))},Be=async e=>{const i=ne[e.id]||"COMMANDER",t=U(c,"Battalion"),n=F(),o=i==="COMMANDER"?"Approved to COMMANDER":`Approved and routed to ${i}`,d={actor:t,actorRole:n,timestamp:new Date().toISOString(),action:o,comment:(g[e.id]||"").trim()},s={...e,currentStage:"COMMANDER_REVIEW",routeSection:i==="COMMANDER"?"":i,activity:Array.isArray(e.activity)?[...e.activity,d]:[d]};try{await w({...s,unitUic:e.unitUic||""}),p(u=>u.map(l=>l.id===s.id?s:l)),y(u=>({...u,[e.id]:""})),ie(u=>({...u,[e.id]:""}))}catch(u){console.error("Failed to approve request:",u)}},Fe=async e=>{const i=U(c,"Battalion"),t=F(),n={actor:i,actorRole:t,timestamp:new Date().toISOString(),action:"Returned to previous stage",comment:(g[e.id]||"").trim()},o={...e,currentStage:"COMPANY_REVIEW",activity:Array.isArray(e.activity)?[...e.activity,n]:[n]};try{await w(o),p(d=>d.map(s=>s.id===o.id?o:s)),y(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to reject request:",d)}},He=async e=>{const i=U(c,"Battalion"),t=F(),n={actor:i,actorRole:t,timestamp:new Date().toISOString(),action:"Archived",comment:(g[e.id]||"").trim()},o={...e,currentStage:"ARCHIVED",finalStatus:"Archived",activity:Array.isArray(e.activity)?[...e.activity,n]:[n]};try{await w(o),p(d=>d.map(s=>s.id===o.id?o:s)),y(d=>({...d,[e.id]:""}))}catch(d){console.error("Failed to archive request:",d)}},We=(e,i)=>{if(!i){J(o=>({...o,[e]:""})),X(o=>({...o,[e]:""})),de(o=>({...o,[e]:[]})),O(o=>({...o,[e]:""}));return}const t=i.uic;J(o=>({...o,[e]:t})),X(o=>({...o,[e]:i.unitName}));let n=[];try{const o=localStorage.getItem("unit_structure");if(o){const s=JSON.parse(o)[t],u=s!=null&&s._sections&&Array.isArray(s._sections)?s._sections:[],l=s!=null&&s._commandSections&&Array.isArray(s._commandSections)?s._commandSections:[];n=[...u,...l]}}catch(o){console.error("Failed to load or parse unit sections from localStorage:",o)}de(o=>({...o,[e]:n})),O(o=>({...o,[e]:""}))},Ve=async e=>{const i=_[e.id]||"",t=Ce[e.id]||"",n=oe[e.id]||"",o=U(c,"Battalion");let d;if(j[e.id]){const s=K.find(m=>{const E=m.unit_uics||m.unitUics||[];return Array.isArray(E)&&E.includes(e.unitUic||"")});if(!s){alert("The selected unit is not part of any installation.");return}const u=`Sent to installation: ${s.name}`,l={actor:o,timestamp:new Date().toISOString(),action:u,comment:(g[e.id]||"").trim()};d={...e,currentStage:"INSTALLATION_REVIEW",installationId:s.id,externalPendingUnitName:void 0,externalPendingUnitUic:void 0,externalPendingStage:void 0,routeSection:le[e.id]||"",activity:[...e.activity||[],l]}}else if(N[e.id]){const s=$[e.id]||"",u=G[e.id]||"";if(!s||!u){alert("Select HQMC division and section");return}const l=`Sent to HQMC: ${s} - ${u}`,m={actor:o,timestamp:new Date().toISOString(),action:l,comment:(g[e.id]||"").trim()};d={...e,routeSection:u,externalPendingUnitName:void 0,externalPendingUnitUic:void 0,externalPendingStage:void 0,activity:[...e.activity||[],m]}}else{if(!i.trim()){alert("Please select an external unit");return}const s=n?`Sent to external unit: ${t} - ${n}`:`Sent to external unit: ${t}`,u={actor:o,timestamp:new Date().toISOString(),action:s,comment:(g[e.id]||"").trim()};d={...e,currentStage:"EXTERNAL_REVIEW",externalPendingUnitName:t,externalPendingUnitUic:i,externalPendingStage:n||at,routeSection:n||"",activity:[...e.activity||[],u]}}try{await w(d),p(s=>s.map(u=>u.id===d.id?d:u)),y(s=>({...s,[e.id]:""})),X(s=>({...s,[e.id]:""})),J(s=>({...s,[e.id]:""})),O(s=>({...s,[e.id]:""})),P(s=>({...s,[e.id]:!1})),B(s=>({...s,[e.id]:!1})),q(s=>({...s,[e.id]:!1}))}catch(s){console.error("Failed to send request to external unit:",s),alert("Failed to send request to external unit. Please try again.")}},Z=r.useMemo(()=>{const e=(c==null?void 0:c.unitUic)||"";return v.filter(i=>{if((i.currentStage||"")!=="EXTERNAL_REVIEW")return!1;const n=i.externalPendingUnitUic||i.unitUic||"";return e?n===e:!0})},[v,c]),Qe=async e=>{const i=Q[e.id];if(!i)return;const t=U(c,"Battalion"),n={...e,currentStage:"BATTALION_REVIEW",unitUic:(c==null?void 0:c.unitUic)||e.externalPendingUnitUic||e.unitUic,routeSection:i,externalPendingUnitUic:void 0,externalPendingUnitName:void 0,externalPendingStage:void 0,activity:Array.isArray(e.activity)?[...e.activity,{actor:t,timestamp:new Date().toISOString(),action:`Battalion assigned external request to section ${i}`}]:[{actor:t,timestamp:new Date().toISOString(),action:`Battalion assigned external request to section ${i}`}]};try{await w(n),p(o=>o.map(d=>d.id===n.id?n:d))}catch(o){console.error("Failed to assign external request to section:",o)}};return a.jsx("div",{className:"max-w-7xl mx-auto p-6",children:a.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Battalion Section Dashboard"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:b||"—"}),a.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:Te,children:"Export All"})]})]}),a.jsxs("div",{className:"space-y-8",children:[Z.length>0&&a.jsxs("div",{className:"p-4 border border-brand-gold rounded-lg bg-brand-cream",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Pending Assignment (External Requests)"}),a.jsxs("span",{className:"text-xs px-2 py-1 bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:[Z.length," item(s)"]})]}),a.jsx("div",{className:"flex flex-col gap-4",children:Z.map(e=>a.jsxs("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-[var(--surface)] transition-all duration-300",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-[var(--text)]",children:e.subject}),a.jsxs("div",{className:"text-sm text-[var(--muted)]",children:["Submitted ",new Date(e.createdAt).toLocaleString()]}),a.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["From ",e.externalPendingUnitName||"External Unit"]})]}),a.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:"EXTERNAL_REVIEW"})]}),a.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[a.jsx("label",{className:"text-sm text-[var(--text)]",children:"Assign to Section"}),a.jsxs("select",{value:Q[e.id]||"",onChange:i=>Ue(t=>({...t,[e.id]:i.target.value})),className:"px-3 py-2 border border-brand-navy/30 rounded-lg",children:[a.jsx("option",{value:"",children:"Select section"}),(je[(c==null?void 0:c.unitUic)||""]||[]).map(i=>a.jsx("option",{value:i,children:i},i))]}),a.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",disabled:!Q[e.id],onClick:()=>Qe(e),children:"Assign"})]})]},e.id))})]}),a.jsx("div",{className:"border-b border-gray-200",children:a.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[a.jsx("button",{onClick:()=>re("Pending"),className:`${T==="Pending"?"border-brand-navy text-brand-navy":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"Pending"}),a.jsx("button",{onClick:()=>re("Previously in Section"),className:`${T==="Previously in Section"?"border-brand-navy text-brand-navy":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"Previously in Section"})]})}),a.jsxs("div",{className:"mt-4",children:[T==="Pending"&&a.jsx(he,{title:"Pending",requests:ve,users:C,onRowClick:e=>se(i=>({...i,[e.id]:!i[e.id]})),expandedRows:ae,platoonSectionMap:R,children:e=>{var i;return a.jsxs("div",{id:`details-sec-${e.id}`,className:"p-4 bg-gray-50",children:[a.jsx("div",{className:"mt-3",children:a.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!x[e.id],"aria-controls":`docs-sec-${e.id}`,onClick:()=>{S(t=>({...t,[e.id]:!t[e.id]})),f(t=>x[e.id]?null:e.id)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),S(n=>({...n,[e.id]:!n[e.id]})),f(n=>x[e.id]?null:e.id))},children:[a.jsx("span",{children:"Show Documents"}),a.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${x[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:a.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),a.jsx("div",{id:`docs-sec-${e.id}`,ref:x[e.id]?L:void 0,className:`${x[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:a.jsx(ye,{documents:Y(e.id).map(t=>({...t,fileUrl:t.fileUrl}))})}),a.jsxs("div",{className:"mt-3",children:[a.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>fe(t=>({...t,[e.id]:!t[e.id]})),"aria-expanded":!!V[e.id],"aria-controls":`logs-sec-${e.id}`,children:[V[e.id]?"Hide":"Show"," Activity Log"]}),a.jsx("div",{id:`logs-sec-${e.id}`,className:V[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((t,n)=>a.jsxs("div",{className:"text-xs text-gray-700",children:[a.jsxs("div",{className:"font-medium",children:[t.actor,t.actorRole?` • ${t.actorRole}`:""," • ",new Date(t.timestamp).toLocaleString()," • ",t.action]}),t.comment&&a.jsx("div",{className:"text-gray-600",children:t.comment})]},n)):a.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),a.jsx("textarea",{rows:2,value:g[e.id]||"",onChange:t=>y(n=>({...n,[e.id]:t.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),a.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[a.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[a.jsx("input",{type:"file",multiple:!0,onChange:t=>te(n=>({...n,[e.id]:t.target.files?Array.from(t.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),a.jsx("span",{className:"text-xs text-[var(--muted)]",children:(I[e.id]||[]).length?`${(I[e.id]||[]).length} file(s) selected`:"No files selected"}),a.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>Pe(e),disabled:!I[e.id]||!(I[e.id]||[]).length,children:"Save Files"})]}),e.currentStage==="BATTALION_REVIEW"&&!qe(e)&&a.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[a.jsxs("select",{value:ne[e.id]||"COMMANDER",onChange:t=>ie(n=>({...n,[e.id]:t.target.value})),className:"px-3 py-2 border border-brand-navy/30 rounded-lg",children:[a.jsx("option",{value:"COMMANDER",children:"Commander"}),(Ee[(c==null?void 0:c.unitUic)||""]||[]).map(t=>a.jsx("option",{value:t,children:t},t))]}),a.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>Be(e),children:"Approve"}),a.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>Fe(e),children:"Return"})]}),nt(e,{userLevel:"unit",userUnitUic:c==null?void 0:c.unitUic})&&a.jsx("div",{className:"mt-3 flex items-center justify-end gap-2",children:a.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>He(e),children:"Archive"})}),((i=e.activity)==null?void 0:i.some(t=>/(endorsed by commander|commander.*endorsed)/i.test(String(t.action||""))))&&a.jsxs("div",{className:"mt-3 p-3 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:[a.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Send Options"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:`send-to-external-${e.id}`,checked:z[e.id]||!1,onChange:()=>{const t=!z[e.id];q(n=>({...n,[e.id]:t})),t&&(P(n=>({...n,[e.id]:!1})),B(n=>({...n,[e.id]:!1})))}}),a.jsx("label",{htmlFor:`send-to-external-${e.id}`,children:"Send to External Unit"}),a.jsx("input",{type:"checkbox",id:`submit-to-installation-${e.id}`,checked:j[e.id]||!1,onChange:()=>{const t=!j[e.id];P(n=>({...n,[e.id]:t})),t&&(q(n=>({...n,[e.id]:!1})),B(n=>({...n,[e.id]:!1})))},disabled:!H(e.unitUic)}),a.jsx("label",{htmlFor:`submit-to-installation-${e.id}`,children:"Submit to Installation"}),a.jsx("input",{type:"checkbox",id:`submit-to-hqmc-${e.id}`,checked:N[e.id]||!1,onChange:()=>{const t=!N[e.id];B(n=>({...n,[e.id]:t})),t&&(q(n=>({...n,[e.id]:!1})),P(n=>({...n,[e.id]:!1})))}}),a.jsx("label",{htmlFor:`submit-to-hqmc-${e.id}`,children:"Submit to HQMC"})]}),z[e.id]&&a.jsxs(a.Fragment,{children:[a.jsx(it,{onUnitSelect:t=>We(e.id,t),selectedUnit:Je.find(t=>t.uic===_[e.id]),placeholder:"Search by UIC, RUC, MCC, or Unit Name"}),a.jsxs("select",{value:oe[e.id]||"",onChange:t=>O(n=>({...n,[e.id]:t.target.value})),disabled:!_[e.id]||!(ce[e.id]||[]).length,className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx("option",{value:"",children:"Select Section/Office (optional)"}),(ce[e.id]||[]).map(t=>a.jsx("option",{value:t,children:t},t))]})]}),a.jsx("div",{className:"flex items-center gap-2",children:!H(e.unitUic)&&a.jsx("p",{className:"text-xs text-gray-500",children:"Not assigned to installation."})}),j[e.id]&&H(e.unitUic)&&a.jsxs("select",{value:le[e.id]||"",onChange:t=>Ie(n=>({...n,[e.id]:t.target.value})),className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm",children:[a.jsx("option",{value:"",children:"Select Installation Section/Office (optional)"}),(()=>{const t=K.find(o=>{const d=o.unit_uics||o.unitUics||[];return Array.isArray(d)&&d.includes(e.unitUic||"")});return((t==null?void 0:t.sections)||[]).map(o=>a.jsx("option",{value:o,children:o},o))})()]}),N[e.id]&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[a.jsxs("select",{value:$[e.id]||"",onChange:t=>{Me(n=>({...n,[e.id]:t.target.value})),xe(n=>({...n,[e.id]:""}))},className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm",children:[a.jsx("option",{value:"",children:"Select HQMC Division"}),De.map(t=>a.jsxs("option",{value:t.code,children:[t.code," — ",t.name]},t.code))]}),a.jsxs("select",{value:G[e.id]||"",onChange:t=>xe(n=>({...n,[e.id]:t.target.value})),disabled:!$[e.id],className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx("option",{value:"",children:"Select HQMC Section"}),$e.filter(t=>String(t.division_code||"")===String($[e.id]||"")).map(t=>a.jsx("option",{value:t.branch,children:t.branch},t.branch))]})]}),a.jsx("div",{className:"mt-2",children:a.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>Ve(e),disabled:j[e.id]?!H(e.unitUic):N[e.id]?!($[e.id]&&G[e.id]):!_[e.id],children:j[e.id]?"Submit to Installation":N[e.id]?"Submit to HQMC":"Submit to External"})})]})]})]})}}),T==="Previously in Section"&&a.jsx(he,{title:"Previously in Section",requests:ge,users:C,onRowClick:e=>se(i=>({...i,[e.id]:!i[e.id]})),expandedRows:ae,platoonSectionMap:R,children:e=>a.jsxs("div",{id:`details-sec-${e.id}`,className:"p-4 bg-gray-50",children:[a.jsx("div",{className:"mt-3",children:a.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!x[e.id],"aria-controls":`docs-sec-${e.id}`,onClick:()=>{S(i=>({...i,[e.id]:!i[e.id]})),f(i=>x[e.id]?null:e.id)},onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),S(t=>({...t,[e.id]:!t[e.id]})),f(t=>x[e.id]?null:e.id))},children:[a.jsx("span",{children:"Show Documents"}),a.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${x[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:a.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),a.jsx("div",{id:`docs-sec-${e.id}`,ref:x[e.id]?L:void 0,className:`${x[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:a.jsx(ye,{documents:Y(e.id).map(i=>({...i,fileUrl:i.fileUrl}))})})]})})]})]})]})})}export{vt as default};
