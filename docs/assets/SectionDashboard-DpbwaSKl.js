import{r as l,j as a}from"./index-V_bzRzYG.js";import{l as Xe}from"./unitStructure-QC5qYuxv.js";import{U as Je}from"./units-CaNgy_2U.js";import{w as Ke,k as ze,p as Ge,c as Ye,l as Ze,e as et,f as tt,u as E}from"./db-DMsND6qo.js";import{R as ve,b as nt}from"./RequestTable-DvqHDpPc.js";import{S as it}from"./SearchableUnitSelector-C6zfXsjl.js";import{a as ge}from"./DocumentListItem-bm8d6cy7.js";import{f as w}from"./utils-CLmukD0c.js";const at="REVIEW";function gt(){const[d,he]=l.useState(null),[g,b]=l.useState([]),[ye,F]=l.useState([]),[M,Y]=l.useState({}),[U,Se]=l.useState({}),[H,fe]=l.useState({}),[je,Ne]=l.useState({}),[p,Ae]=l.useState(""),[v,h]=l.useState({}),[C,Z]=l.useState({}),[Ee,we]=l.useState({}),[ee,te]=l.useState({}),[ne,ie]=l.useState({}),[st,ot]=l.useState({}),[ct,dt]=l.useState({}),[W,Ue]=l.useState({}),[Ce,V]=l.useState({}),[k,Q]=l.useState({}),[ae,_]=l.useState({}),[se,oe]=l.useState({}),[x,y]=l.useState({}),[R,S]=l.useState(null),$=l.useRef(null),[O,ce]=l.useState("Pending"),[X,Re]=l.useState([]),[f,L]=l.useState({}),[de,Ie]=l.useState({}),[J,T]=l.useState({}),[j,P]=l.useState({}),[De,le]=l.useState([]),[Me,re]=l.useState([]),[I,ke]=l.useState({}),[K,ue]=l.useState({});l.useEffect(()=>{Ke().then(e=>Re(e)),ze().then(le).catch(()=>le([])),Ge().then(re).catch(()=>re([]))},[]),l.useEffect(()=>{const e=t=>{R&&$.current&&!$.current.contains(t.target)&&(y(n=>({...n,[R]:!1})),S(null))},i=t=>{t.key==="Escape"&&R&&(y(n=>({...n,[R]:!1})),S(null))};return document.addEventListener("mousedown",e),document.addEventListener("keydown",i),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("keydown",i)}},[R]),l.useEffect(()=>{try{const e=localStorage.getItem("currentUser");e&&he(JSON.parse(e))}catch{}},[]),l.useEffect(()=>{var e,i;try{const t=(d==null?void 0:d.unitUic)||"",n=d!=null&&d.company&&d.company!=="N/A"?d.company:"",o=d!=null&&d.platoon&&d.platoon!=="N/A"?d.platoon:"",c=((i=(e=U[t])==null?void 0:e[n])==null?void 0:i[o])||"";Ae(c)}catch{}},[d,U]),l.useEffect(()=>{Ye().then(e=>{b(e)}).catch(()=>b([]))},[]),l.useEffect(()=>{Ze().then(e=>{F(e)}).catch(()=>F([]))},[]),l.useEffect(()=>{et().then(e=>{const i={};for(const t of e)i[t.id]=t;Y(i)}).catch(()=>Y({}))},[]),l.useEffect(()=>{try{const e=localStorage.getItem("unit_structure"),i={},t={},n={};if(e){const o=JSON.parse(e);for(const c of Object.keys(o||{})){const s=o[c];s&&s._platoonSectionMap&&typeof s._platoonSectionMap=="object"&&(i[c]=s._platoonSectionMap),s&&Array.isArray(s._sections)&&(t[c]=s._sections),s&&Array.isArray(s._commandSections)&&(n[c]=s._commandSections)}}else(async()=>{try{const o=await Xe();for(const c of Object.keys(o||{})){const s=o[c];s&&s._platoonSectionMap&&typeof s._platoonSectionMap=="object"&&(i[c]=s._platoonSectionMap),s&&Array.isArray(s._sections)&&(t[c]=s._sections),s&&Array.isArray(s._commandSections)&&(n[c]=s._commandSections)}}catch{}})();Se(i),Ne(t),we(n)}catch{}},[]);const me=l.useMemo(()=>{const e=(d==null?void 0:d.unitUic)||"";return g.filter(i=>{const n=(i.currentStage||"")==="EXTERNAL_REVIEW"?i.externalPendingUnitUic||i.unitUic||"":i.unitUic||"";return!!N(i)&&(e?n===e:!0)})},[g,d,N]),xe=l.useMemo(()=>{const e=i=>String(i||"").trim().replace(/^S(\d)\b/,"S-$1");return me.filter(i=>{const t=e(N(i)),n=e(p);return p?t===n:!0})},[me,p,N]),pe=l.useMemo(()=>xe.filter(e=>(e.currentStage||"")==="BATTALION_REVIEW"),[xe]),be=l.useMemo(()=>{const e=t=>String(t||"").trim().replace(/^S(\d)\b/,"S-$1"),i=e(p);return i?g.filter(t=>{var r,m;const n=t.currentStage||"",o=(d==null?void 0:d.unitUic)||"",c=n==="EXTERNAL_REVIEW"?t.externalPendingUnitUic||t.unitUic||"":t.unitUic||"";if(o&&c!==o||n==="BATTALION_REVIEW"&&e(N(t))===i)return!1;const s=(r=t.activity)==null?void 0:r.some(A=>{const D=String(A.action||"");return D.includes(i)||D.includes(p)}),u=(m=t.activity)==null?void 0:m.some(A=>{const D=String(A.action||"");return D.includes(`routed to ${i}`)||D.includes(`routed to ${p}`)});return s||u}):[]},[g,d,p]);function N(e){var u,r;const i=m=>String(m||"").trim().replace(/^S(\d)\b/,"S-$1");if(e.routeSection)return i(e.routeSection);const t=e.unitUic||"",n=M[e.uploadedById],o=n!=null&&n.company&&n.company!=="N/A"?n.company:"",c=n!=null&&n.platoon&&n.platoon!=="N/A"?n.platoon:"",s=((r=(u=U[t])==null?void 0:u[o])==null?void 0:r[c])||"";return i(s)}const _e=e=>{const i=M[e.uploadedById];return i?[i.rank,i.lastName+",",i.firstName,i.mi?i.mi:""].filter(Boolean).join(" ").trim():"—"},z=e=>ye.filter(i=>i.requestId===e),$e=e=>`"${String(e??"").replace(/"/g,'""')}"`,Oe=e=>{const t=[["Request ID","Subject","Stage","Battalion Section","Route Section","Originator","Unit UIC","Created At","Documents"]];for(const n of e){const o=z(n.id).map(c=>c.name).join(" | ");t.push([n.id,n.subject,n.currentStage||"",N(n)||"",n.routeSection||"",_e(n),n.unitUic||"",new Date(n.createdAt).toLocaleString(),o])}return t.map(n=>n.map($e).join(",")).join(`\r
`)},Le=(e,i)=>{const t=new Blob([i],{type:"text/csv;charset=utf-8;"}),n=URL.createObjectURL(t),o=document.createElement("a");o.href=n,o.download=e,document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(n)},Te=()=>Le("battalion_all.csv",Oe([...pe,...be])),Pe=async e=>{const i=C[e.id]||[];if(!i.length||!(d!=null&&d.id))return;const t=Date.now(),n=i.map((r,m)=>({id:`${t}-${m}`,name:r.name,type:r.type,size:r.size,uploadedAt:new Date().toISOString(),subject:e.subject,requestId:e.id})),o=w(d,"Reviewer"),c=q(),s={actor:o,actorRole:c,timestamp:new Date().toISOString(),action:`Reviewer added ${n.length} document(s)`,comment:(v[e.id]||"").trim()},u={...e,documentIds:[...e.documentIds||[],...n.map(r=>r.id)],activity:Array.isArray(e.activity)?[...e.activity,s]:[s]};try{await tt(n),await E(u),F(r=>[...r,...n]),b(r=>r.map(m=>m.id===u.id?u:m))}catch(r){console.error("Failed to add files to request:",r)}Z(r=>({...r,[e.id]:[]})),h(r=>({...r,[e.id]:""}))},q=()=>{const e=p||"";return e?`Battalion (${e})`:"Battalion"},B=e=>{const i=e==null?void 0:e.trim();return i?X.some(t=>{const n=t.unit_uics||t.unitUics||[];return Array.isArray(n)&&n.includes(i)}):!1},qe=e=>{const i=(e.activity||[]).slice().reverse().find(t=>/Commander/i.test(String(t.action||"")));return!!i&&/(Approved|Endorsed)/i.test(String(i.action||""))},Be=async e=>{const i=ee[e.id]||"COMMANDER",t=w(d,"Battalion"),n=q(),o=i==="COMMANDER"?"Approved to COMMANDER":`Approved and routed to ${i}`,c={actor:t,actorRole:n,timestamp:new Date().toISOString(),action:o,comment:(v[e.id]||"").trim()},s={...e,currentStage:"COMMANDER_REVIEW",routeSection:i==="COMMANDER"?"":i,activity:Array.isArray(e.activity)?[...e.activity,c]:[c]};try{await E({...s,unitUic:e.unitUic||""}),b(u=>u.map(r=>r.id===s.id?s:r)),h(u=>({...u,[e.id]:""})),te(u=>({...u,[e.id]:""}))}catch(u){console.error("Failed to approve request:",u)}},Fe=async e=>{const i=w(d,"Battalion"),t=q(),n={actor:i,actorRole:t,timestamp:new Date().toISOString(),action:"Returned to previous stage",comment:(v[e.id]||"").trim()},o={...e,currentStage:"COMPANY_REVIEW",activity:Array.isArray(e.activity)?[...e.activity,n]:[n]};try{await E(o),b(c=>c.map(s=>s.id===o.id?o:s)),h(c=>({...c,[e.id]:""}))}catch(c){console.error("Failed to reject request:",c)}},He=async e=>{const i=w(d,"Battalion"),t=q(),n={actor:i,actorRole:t,timestamp:new Date().toISOString(),action:"Archived",comment:(v[e.id]||"").trim()},o={...e,currentStage:"ARCHIVED",finalStatus:"Archived",activity:Array.isArray(e.activity)?[...e.activity,n]:[n]};try{await E(o),b(c=>c.map(s=>s.id===o.id?o:s)),h(c=>({...c,[e.id]:""}))}catch(c){console.error("Failed to archive request:",c)}},We=(e,i)=>{if(!i){Q(o=>({...o,[e]:""})),V(o=>({...o,[e]:""})),oe(o=>({...o,[e]:[]})),_(o=>({...o,[e]:""}));return}const t=i.uic;Q(o=>({...o,[e]:t})),V(o=>({...o,[e]:i.unitName}));let n=[];try{const o=localStorage.getItem("unit_structure");if(o){const s=JSON.parse(o)[t],u=s!=null&&s._sections&&Array.isArray(s._sections)?s._sections:[],r=s!=null&&s._commandSections&&Array.isArray(s._commandSections)?s._commandSections:[];n=[...u,...r]}}catch(o){console.error("Failed to load or parse unit sections from localStorage:",o)}oe(o=>({...o,[e]:n})),_(o=>({...o,[e]:""}))},Ve=async e=>{const i=k[e.id]||"",t=Ce[e.id]||"",n=ae[e.id]||"",o=w(d,"Battalion");let c;if(f[e.id]){const s=X.find(m=>{const A=m.unit_uics||m.unitUics||[];return Array.isArray(A)&&A.includes(e.unitUic||"")});if(!s){alert("The selected unit is not part of any installation.");return}const u=`Sent to installation: ${s.name}`,r={actor:o,timestamp:new Date().toISOString(),action:u,comment:(v[e.id]||"").trim()};c={...e,currentStage:"INSTALLATION_REVIEW",installationId:s.id,externalPendingUnitName:void 0,externalPendingUnitUic:void 0,externalPendingStage:void 0,routeSection:de[e.id]||"",activity:[...e.activity||[],r]}}else if(j[e.id]){const s=I[e.id]||"",u=K[e.id]||"";if(!s||!u){alert("Select HQMC division and section");return}const r=`Sent to HQMC: ${s} - ${u}`,m={actor:o,timestamp:new Date().toISOString(),action:r,comment:(v[e.id]||"").trim()};c={...e,routeSection:u,externalPendingUnitName:void 0,externalPendingUnitUic:void 0,externalPendingStage:void 0,activity:[...e.activity||[],m]}}else{if(!i.trim()){alert("Please select an external unit");return}const s=n?`Sent to external unit: ${t} - ${n}`:`Sent to external unit: ${t}`,u={actor:o,timestamp:new Date().toISOString(),action:s,comment:(v[e.id]||"").trim()};c={...e,currentStage:"EXTERNAL_REVIEW",externalPendingUnitName:t,externalPendingUnitUic:i,externalPendingStage:n||at,routeSection:n||"",activity:[...e.activity||[],u]}}try{await E(c),b(s=>s.map(u=>u.id===c.id?c:u)),h(s=>({...s,[e.id]:""})),V(s=>({...s,[e.id]:""})),Q(s=>({...s,[e.id]:""})),_(s=>({...s,[e.id]:""})),L(s=>({...s,[e.id]:!1})),P(s=>({...s,[e.id]:!1})),T(s=>({...s,[e.id]:!1}))}catch(s){console.error("Failed to send request to external unit:",s),alert("Failed to send request to external unit. Please try again.")}},G=l.useMemo(()=>{const e=(d==null?void 0:d.unitUic)||"";return g.filter(i=>{if((i.currentStage||"")!=="EXTERNAL_REVIEW")return!1;const n=i.externalPendingUnitUic||i.unitUic||"";return e?n===e:!0})},[g,d]),Qe=async e=>{const i=W[e.id];if(!i)return;const t=w(d,"Battalion"),n={...e,currentStage:"BATTALION_REVIEW",unitUic:(d==null?void 0:d.unitUic)||e.externalPendingUnitUic||e.unitUic,routeSection:i,externalPendingUnitUic:void 0,externalPendingUnitName:void 0,externalPendingStage:void 0,activity:Array.isArray(e.activity)?[...e.activity,{actor:t,timestamp:new Date().toISOString(),action:`Battalion assigned external request to section ${i}`}]:[{actor:t,timestamp:new Date().toISOString(),action:`Battalion assigned external request to section ${i}`}]};try{await E(n),b(o=>o.map(c=>c.id===n.id?n:c))}catch(o){console.error("Failed to assign external request to section:",o)}};return a.jsx("div",{className:"max-w-7xl mx-auto p-6",children:a.jsxs("div",{className:"bg-[var(--surface)] rounded-lg shadow p-6",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-xl font-semibold text-[var(--text)]",children:"Battalion Section Dashboard"}),a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:p||"—"}),a.jsx("button",{className:"px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2",onClick:Te,children:"Export All"})]})]}),a.jsxs("div",{className:"space-y-8",children:[G.length>0&&a.jsxs("div",{className:"p-4 border border-brand-gold rounded-lg bg-brand-cream",children:[a.jsxs("div",{className:"flex items-center justify-between mb-3",children:[a.jsx("h3",{className:"text-lg font-semibold text-[var(--text)]",children:"Pending Assignment (External Requests)"}),a.jsxs("span",{className:"text-xs px-2 py-1 bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:[G.length," item(s)"]})]}),a.jsx("div",{className:"flex flex-col gap-4",children:G.map(e=>a.jsxs("div",{className:"p-4 border border-brand-navy/20 rounded-lg bg-[var(--surface)] transition-all duration-300",children:[a.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-2",children:[a.jsxs("div",{children:[a.jsx("div",{className:"font-medium text-[var(--text)]",children:e.subject}),a.jsxs("div",{className:"text-sm text-[var(--muted)]",children:["Submitted ",new Date(e.createdAt).toLocaleString()]}),a.jsxs("div",{className:"text-xs text-[var(--muted)] mt-1",children:["From ",e.externalPendingUnitName||"External Unit"]})]}),a.jsx("span",{className:"px-2 py-1 text-xs bg-brand-cream text-brand-navy rounded-full border border-brand-navy/30",children:"EXTERNAL_REVIEW"})]}),a.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[a.jsx("label",{className:"text-sm text-[var(--text)]",children:"Assign to Section"}),a.jsxs("select",{value:W[e.id]||"",onChange:i=>Ue(t=>({...t,[e.id]:i.target.value})),className:"px-3 py-2 border border-brand-navy/30 rounded-lg",children:[a.jsx("option",{value:"",children:"Select section"}),(je[(d==null?void 0:d.unitUic)||""]||[]).map(i=>a.jsx("option",{value:i,children:i},i))]}),a.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",disabled:!W[e.id],onClick:()=>Qe(e),children:"Assign"})]})]},e.id))})]}),a.jsx("div",{className:"border-b border-gray-200",children:a.jsxs("nav",{className:"-mb-px flex space-x-8","aria-label":"Tabs",children:[a.jsx("button",{onClick:()=>ce("Pending"),className:`${O==="Pending"?"border-brand-navy text-brand-navy":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"Pending"}),a.jsx("button",{onClick:()=>ce("Previously in Section"),className:`${O==="Previously in Section"?"border-brand-navy text-brand-navy":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm`,children:"Previously in Section"})]})}),a.jsxs("div",{className:"mt-4",children:[O==="Pending"&&a.jsx(ve,{title:"Pending",requests:pe,users:M,onRowClick:e=>ie(i=>({...i,[e.id]:!i[e.id]})),expandedRows:ne,platoonSectionMap:U,children:e=>{var i;return a.jsxs("div",{id:`details-sec-${e.id}`,className:"p-4 bg-gray-50",children:[a.jsx("div",{className:"mt-3",children:a.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!x[e.id],"aria-controls":`docs-sec-${e.id}`,onClick:()=>{y(t=>({...t,[e.id]:!t[e.id]})),S(t=>x[e.id]?null:e.id)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),y(n=>({...n,[e.id]:!n[e.id]})),S(n=>x[e.id]?null:e.id))},children:[a.jsx("span",{children:"Show Documents"}),a.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${x[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:a.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),a.jsx("div",{id:`docs-sec-${e.id}`,ref:x[e.id]?$:void 0,className:`${x[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:a.jsx(ge,{documents:z(e.id).map(t=>({...t,fileUrl:t.fileUrl}))})}),a.jsxs("div",{className:"mt-3",children:[a.jsxs("button",{className:"px-3 py-1 text-xs rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>fe(t=>({...t,[e.id]:!t[e.id]})),"aria-expanded":!!H[e.id],"aria-controls":`logs-sec-${e.id}`,children:[H[e.id]?"Hide":"Show"," Activity Log"]}),a.jsx("div",{id:`logs-sec-${e.id}`,className:H[e.id]?"mt-2 space-y-2":"hidden",children:e.activity&&e.activity.length?e.activity.map((t,n)=>a.jsxs("div",{className:"text-xs text-gray-700",children:[a.jsxs("div",{className:"font-medium",children:[t.actor,t.actorRole?` • ${t.actorRole}`:""," • ",new Date(t.timestamp).toLocaleString()," • ",t.action]}),t.comment&&a.jsx("div",{className:"text-gray-600",children:t.comment})]},n)):a.jsx("div",{className:"text-xs text-gray-500",children:"No activity"})})]}),a.jsxs("div",{className:"mt-3",children:[a.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-1",children:"Reviewer Comment"}),a.jsx("textarea",{rows:2,value:v[e.id]||"",onChange:t=>h(n=>({...n,[e.id]:t.target.value})),className:"w-full px-3 py-2 border border-brand-navy/30 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-gold",placeholder:"Optional notes"})]}),a.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[a.jsxs("label",{className:"bg-brand-navy text-brand-cream px-3 py-1 rounded hover:bg-brand-red-2 cursor-pointer inline-block",children:[a.jsx("input",{type:"file",multiple:!0,onChange:t=>Z(n=>({...n,[e.id]:t.target.files?Array.from(t.target.files):[]})),className:"hidden",accept:".pdf,.doc,.docx,.txt,.jpg,.jpeg,.png"}),"Add Files"]}),a.jsx("span",{className:"text-xs text-[var(--muted)]",children:(C[e.id]||[]).length?`${(C[e.id]||[]).length} file(s) selected`:"No files selected"}),a.jsx("button",{className:"px-3 py-1 text-xs bg-brand-gold text-brand-charcoal rounded hover:bg-brand-gold-2",onClick:()=>Pe(e),disabled:!C[e.id]||!(C[e.id]||[]).length,children:"Save Files"})]}),e.currentStage==="BATTALION_REVIEW"&&!qe(e)&&a.jsxs("div",{className:"mt-3 flex items-center justify-end gap-2",children:[a.jsxs("select",{value:ee[e.id]||"COMMANDER",onChange:t=>te(n=>({...n,[e.id]:t.target.value})),className:"px-3 py-2 border border-brand-navy/30 rounded-lg",children:[a.jsx("option",{value:"COMMANDER",children:"Commander"}),(Ee[(d==null?void 0:d.unitUic)||""]||[]).map(t=>a.jsx("option",{value:t,children:t},t))]}),a.jsx("button",{className:"px-3 py-2 rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>Be(e),children:"Approve"}),a.jsx("button",{className:"px-3 py-2 rounded bg-brand-navy text-brand-cream hover:bg-brand-red-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>Fe(e),children:"Return"})]}),nt(e,{userLevel:"unit",userUnitUic:d==null?void 0:d.unitUic})&&a.jsx("div",{className:"mt-3 flex items-center justify-end gap-2",children:a.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-brand-gold",onClick:()=>He(e),children:"Archive"})}),((i=e.activity)==null?void 0:i.some(t=>/(endorsed by commander|commander.*endorsed)/i.test(String(t.action||""))))&&a.jsxs("div",{className:"mt-3 p-3 border border-brand-navy/20 rounded-lg bg-brand-cream/30",children:[a.jsx("label",{className:"block text-sm font-medium text-[var(--text)] mb-2",children:"Send Options"}),a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsxs("div",{className:"flex items-center gap-3",children:[a.jsx("input",{type:"checkbox",id:`send-to-external-${e.id}`,checked:J[e.id]||!1,onChange:()=>{const t=!J[e.id];T(n=>({...n,[e.id]:t})),t&&(L(n=>({...n,[e.id]:!1})),P(n=>({...n,[e.id]:!1})))}}),a.jsx("label",{htmlFor:`send-to-external-${e.id}`,children:"Send to External Unit"}),a.jsx("input",{type:"checkbox",id:`submit-to-installation-${e.id}`,checked:f[e.id]||!1,onChange:()=>{const t=!f[e.id];L(n=>({...n,[e.id]:t})),t&&(T(n=>({...n,[e.id]:!1})),P(n=>({...n,[e.id]:!1})))},disabled:!B(e.unitUic)}),a.jsx("label",{htmlFor:`submit-to-installation-${e.id}`,children:"Submit to Installation"}),a.jsx("input",{type:"checkbox",id:`submit-to-hqmc-${e.id}`,checked:j[e.id]||!1,onChange:()=>{const t=!j[e.id];P(n=>({...n,[e.id]:t})),t&&(T(n=>({...n,[e.id]:!1})),L(n=>({...n,[e.id]:!1})))}}),a.jsx("label",{htmlFor:`submit-to-hqmc-${e.id}`,children:"Submit to HQMC"})]}),J[e.id]&&a.jsxs(a.Fragment,{children:[a.jsx(it,{onUnitSelect:t=>We(e.id,t),selectedUnit:Je.find(t=>t.uic===k[e.id]),placeholder:"Search by UIC, RUC, MCC, or Unit Name"}),a.jsxs("select",{value:ae[e.id]||"",onChange:t=>_(n=>({...n,[e.id]:t.target.value})),disabled:!k[e.id]||!(se[e.id]||[]).length,className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx("option",{value:"",children:"Select Section/Office (optional)"}),(se[e.id]||[]).map(t=>a.jsx("option",{value:t,children:t},t))]})]}),a.jsx("div",{className:"flex items-center gap-2",children:!B(e.unitUic)&&a.jsx("p",{className:"text-xs text-gray-500",children:"Not assigned to installation."})}),f[e.id]&&B(e.unitUic)&&a.jsxs("select",{value:de[e.id]||"",onChange:t=>Ie(n=>({...n,[e.id]:t.target.value})),className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm",children:[a.jsx("option",{value:"",children:"Select Installation Section/Office (optional)"}),(()=>{const t=X.find(o=>{const c=o.unit_uics||o.unitUics||[];return Array.isArray(c)&&c.includes(e.unitUic||"")});return((t==null?void 0:t.sections)||[]).map(o=>a.jsx("option",{value:o,children:o},o))})()]}),j[e.id]&&a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:[a.jsxs("select",{value:I[e.id]||"",onChange:t=>{ke(n=>({...n,[e.id]:t.target.value})),ue(n=>({...n,[e.id]:""}))},className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm",children:[a.jsx("option",{value:"",children:"Select HQMC Division"}),De.map(t=>a.jsxs("option",{value:t.code,children:[t.code," — ",t.name]},t.code))]}),a.jsxs("select",{value:K[e.id]||"",onChange:t=>ue(n=>({...n,[e.id]:t.target.value})),disabled:!I[e.id],className:"px-3 py-2 border border-brand-navy/30 rounded-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed",children:[a.jsx("option",{value:"",children:"Select HQMC Section"}),Me.filter(t=>String(t.division_code||"")===String(I[e.id]||"")).map(t=>a.jsx("option",{value:t.branch,children:t.branch},t.branch))]})]}),a.jsx("div",{className:"mt-2",children:a.jsx("button",{className:"px-3 py-2 rounded bg-brand-gold text-brand-charcoal hover:bg-brand-gold-2 disabled:opacity-50 disabled:cursor-not-allowed",onClick:()=>Ve(e),disabled:f[e.id]?!B(e.unitUic):j[e.id]?!(I[e.id]&&K[e.id]):!k[e.id],children:f[e.id]?"Submit to Installation":j[e.id]?"Submit to HQMC":"Submit to External"})})]})]})]})}}),O==="Previously in Section"&&a.jsx(ve,{title:"Previously in Section",requests:be,users:M,onRowClick:e=>ie(i=>({...i,[e.id]:!i[e.id]})),expandedRows:ne,platoonSectionMap:U,children:e=>a.jsxs("div",{id:`details-sec-${e.id}`,className:"p-4 bg-gray-50",children:[a.jsx("div",{className:"mt-3",children:a.jsxs("button",{className:"inline-flex items-center gap-1 px-3 py-1 text-xs rounded bg-brand-cream text-brand-navy border border-brand-navy/30 hover:bg-brand-gold-2","aria-expanded":!!x[e.id],"aria-controls":`docs-sec-${e.id}`,onClick:()=>{y(i=>({...i,[e.id]:!i[e.id]})),S(i=>x[e.id]?null:e.id)},onKeyDown:i=>{(i.key==="Enter"||i.key===" ")&&(i.preventDefault(),y(t=>({...t,[e.id]:!t[e.id]})),S(t=>x[e.id]?null:e.id))},children:[a.jsx("span",{children:"Show Documents"}),a.jsx("svg",{width:"10",height:"10",viewBox:"0 0 20 20",className:`transition-transform ${x[e.id]?"rotate-180":"rotate-0"}`,"aria-hidden":"true",children:a.jsx("path",{d:"M5 7l5 5 5-5",fill:"none",stroke:"currentColor",strokeWidth:"2"})})]})}),a.jsx("div",{id:`docs-sec-${e.id}`,ref:x[e.id]?$:void 0,className:`${x[e.id]?"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-[50vh] opacity-100":"mt-2 space-y-2 overflow-hidden transition-all duration-300 max-h-0 opacity-0"}`,children:a.jsx(ge,{documents:z(e.id).map(i=>({...i,fileUrl:i.fileUrl}))})})]})})]})]})]})})}export{gt as default};
